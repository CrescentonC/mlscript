:NewParser
:ParseOnly


// Initial program, not immediately fusable:
fun count(c, xs) = if xs is
    C(h, t) then count(add(c, 1), t)
    N then c
fun rev(a, ys) = if ys is
    C(h1, t1) then rev(C(h1, a), t1)
    N then a
count(0, rev(N, N))
//│ |#fun| |count|(|c|,| |xs|)| |#=| |#if| |xs| |is|→|C|(|h|,| |t|)| |#then| |count|(|add|(|c|,| |1|)|,| |t|)|↵|N| |#then| |c|←|↵|#fun| |rev|(|a|,| |ys|)| |#=| |#if| |ys| |is|→|C|(|h1|,| |t1|)| |#then| |rev|(|C|(|h1|,| |a|)|,| |t1|)|↵|N| |#then| |a|←|↵|count|(|0|,| |rev|(|N|,| |N|)|)|
//│ Parsed: {fun count = c, xs, => if xs is ‹(C (h, t,)) then count (add (c, 1,), t,); (N) then c›; fun rev = a, ys, => if ys is ‹(C (h1, t1,)) then rev (C (h1, a,), t1,); (N) then a›; count (0, rev (N, N,),)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ ((count:6^27 0) ((rev:7^30 [N]) [N]))
//│ def count:6 = (fun c:8 -> (fun xs:9 -> case xs:9^1 of {
//│ 	C h:10 t:11 => ((count:6^2 ((add:4^3 c:8^4) 1)) t:11^9)
//│ 	| N => c:8^11}))
//│ def rev:7 = (fun a:12 -> (fun ys:13 -> case ys:13^15 of {
//│ 	C h1:14 t1:15 => ((rev:7^16 [C h1:14^17 a:12^18]) t1:15^21)
//│ 	| N => a:12^23}))
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ >>>>>>> knots >>>>>>>
//│ C(13'h1, 11'a) <: 3'xs
//│ 	[+rev:7^16 · +rev:7^16 · +rev:7^16 · -rev:7^16 · -rev:7^30 · +count:6^27 · +count:6^2 · +count:6^2]  --->  [+rev:7^16 · +rev:7^16 · -rev:7^16 · -rev:7^30 · +count:6^27 · +count:6^2]
//│ 	[+rev:7^16 · +rev:7^16 · +rev:7^16 · -rev:7^30 · +count:6^27 · +count:6^2 · +count:6^2]  --->  [+rev:7^16 · +rev:7^16 · -rev:7^30 · +count:6^27 · +count:6^2]
//│ NoProd <: 3'xs
//│ 	[+rev:7^30 · -rev:7^16 · -rev:7^30 · +count:6^27 · +count:6^2 · +count:6^2]  --->  [+rev:7^30 · -rev:7^16 · -rev:7^30 · +count:6^27 · +count:6^2]
//│ 	[+rev:7^30 · -rev:7^30 · +count:6^27 · +count:6^2 · +count:6^2]  --->  [+rev:7^30 · -rev:7^30 · +count:6^27 · +count:6^2]
//│ NoProd <: 12'ys
//│ 	[+rev:7^30 · +rev:7^16 · +rev:7^16]  --->  [+rev:7^30 · +rev:7^16]
//│ NoProd <: 5't
//│ 	[+rev:7^30 · +rev:7^16 · +rev:7^16 · -rev:7^16 · -rev:7^30 · +count:6^27 · +count:6^2 · +count:6^2 · +count:6^2]  --->  [+rev:7^30 · +rev:7^16 · +rev:7^16 · -rev:7^16 · -rev:7^30 · +count:6^27 · +count:6^2 · +count:6^2]
//│ 	[+rev:7^30 · +rev:7^16 · +rev:7^16 · -rev:7^30 · +count:6^27 · +count:6^2 · +count:6^2 · +count:6^2]  --->  [+rev:7^30 · +rev:7^16 · +rev:7^16 · -rev:7^30 · +count:6^27 · +count:6^2 · +count:6^2]
//│ 	[+rev:7^30 · +rev:7^16 · -rev:7^16 · -rev:7^30 · +count:6^27 · +count:6^2 · +count:6^2]  --->  [+rev:7^30 · +rev:7^16 · -rev:7^16 · -rev:7^30 · +count:6^27 · +count:6^2]
//│ 	[+rev:7^30 · +rev:7^16 · -rev:7^30 · +count:6^27 · +count:6^2 · +count:6^2]  --->  [+rev:7^30 · +rev:7^16 · -rev:7^30 · +count:6^27 · +count:6^2]
//│ <<<<<<< knots <<<<<<<
//│ 
//│ >>>>>>> splitted knots >>>>>>>
//│ [count:6^27 · count:6^2 · count:6^2] --> [count:6^27 · count:6^2]
//│ [rev:7^30 · rev:7^16 · rev:7^16] --> [rev:7^30 · rev:7^16]
//│ [rev:7^30 · rev:7^16] --> [rev:7^30 · rev:7^16]
//│ [rev:7^30] --> [rev:7^30]
//│ [] --> []
//│ <<<<<<< splitted knots <<<<<<<
//│ 
//│ >>>>>>> expansion >>>>>>>
//│ [count:6^27]
//│ 	[count:6^27 · count:6^2]
//│ 		[count:6^27 · count:6^2 · count:6^2] ---> [count:6^27 · count:6^2] (only one)
//│ [rev:7^30]
//│ 	[rev:7^30 · rev:7^16]
//│ 		[rev:7^30 · rev:7^16 · rev:7^16] ---> [rev:7^30 · rev:7^16] (only one)
//│ <<<<<<< expansion <<<<<<<
//│ 
//│ >>>>>>> expanded program >>>>>>>
//│ (([count:6^27]:18^88 0) (([rev:7^30]:16^91 [N]) [N]))
//│ def [count:6^27 · count:6^2]:19 = (fun c:34 -> (fun xs:35 -> case xs:35^60 of {
//│ 	C h:36 t:37 => (([count:6^27 · count:6^2]:19^61 ((add:24^62 c:34^63) 1)) t:37^68)
//│ 	| N => c:34^70}))
//│ def [count:6^27]:18 = (fun c:38 -> (fun xs:39 -> case xs:39^74 of {
//│ 	C h:40 t:41 => (([count:6^27 · count:6^2]:19^75 ((add:24^76 c:38^77) 1)) t:41^82)
//│ 	| N => c:38^84}))
//│ def [rev:7^30 · rev:7^16]:17 = (fun a:26 -> (fun ys:27 -> case ys:27^36 of {
//│ 	C h1:28 t1:29 => (([rev:7^30 · rev:7^16]:17^37 [C h1:28^38 a:26^39]) t1:29^42)
//│ 	| N => a:26^44}))
//│ def [rev:7^30]:16 = (fun a:30 -> (fun ys:31 -> case ys:31^48 of {
//│ 	C h1:32 t1:33 => (([rev:7^30 · rev:7^16]:17^49 [C h1:32^50 a:30^51]) t1:33^54)
//│ 	| N => a:30^56}))
//│ def count:6 = (fun c:8 -> (fun xs:9 -> case xs:9^10 of {
//│ 	C h:10 t:11 => ((count:6^11 ((add:4^12 c:8^13) 1)) t:11^18)
//│ 	| N => c:8^20}))
//│ def rev:7 = (fun a:12 -> (fun ys:13 -> case ys:13^24 of {
//│ 	C h1:14 t1:15 => ((rev:7^25 [C h1:14^26 a:12^27]) t1:15^30)
//│ 	| N => a:12^32}))
//│ <<<<<<< expanded program <<<<<<<
//│ 
//│ >>>>>>> fusion matches >>>>>>>
//│ 40: [C 38: h1:28^38 39: a:26^39]
//│ [C h1:28^38 a:26^39] --->
//│ 	case xs:35^60 of {C h:36 t:37 => (([count:6^27 · count:6^2]:19^61 ((add:24^62 c:34^63) 1)) t:37^68) | N => c:34^70}
//│ 	case xs:39^74 of {C h:40 t:41 => (([count:6^27 · count:6^2]:19^75 ((add:24^76 c:38^77) 1)) t:41^82) | N => c:38^84}
//│ 	 MORE THAN ONE MATCH EXPR
//│ 52: [C 50: h1:32^50 51: a:30^51]
//│ [C h1:32^50 a:30^51] --->
//│ 	case xs:35^60 of {C h:36 t:37 => (([count:6^27 · count:6^2]:19^61 ((add:24^62 c:34^63) 1)) t:37^68) | N => c:34^70}
//│ 	case xs:39^74 of {C h:40 t:41 => (([count:6^27 · count:6^2]:19^75 ((add:24^76 c:38^77) 1)) t:41^82) | N => c:38^84}
//│ 	 MORE THAN ONE MATCH EXPR
//│ 92: [N]
//│ [N] --->
//│ 	case xs:35^60 of {C h:36 t:37 => (([count:6^27 · count:6^2]:19^61 ((add:24^62 c:34^63) 1)) t:37^68) | N => c:34^70}
//│ 	case xs:39^74 of {C h:40 t:41 => (([count:6^27 · count:6^2]:19^75 ((add:24^76 c:38^77) 1)) t:41^82) | N => c:38^84}
//│ 	 MORE THAN ONE MATCH EXPR
//│ 94: [N]
//│ [N] --->
//│ 	case ys:31^48 of {C h1:32 t1:33 => (([rev:7^30 · rev:7^16]:17^49 [C h1:32^50 a:30^51]) t1:33^54) | N => a:30^56}
//│ <<<<<<< fusion matches <<<<<<<
//│ 
//│ >>>>>>> after fusion >>>>>>>
//│ (([count:6^27]:18^97 0) (([rev:7^30]:16^100 c:34^101) a:30^103))
//│ def [count:6^27 · count:6^2]:19 = (fun c:34 -> (fun xs:35 -> xs:35^131))
//│ def [count:6^27]:18 = (fun c:38 -> (fun xs:39 -> xs:39^160))
//│ def [rev:7^30 · rev:7^16]:17 = (fun a:26 -> (fun ys:27 -> case ys:27^106 of {
//│ 	C h1:28 t1:29 => (([rev:7^30 · rev:7^16]:17^107 let h:40 = h1:28^119
//│ 	in let t:41 = a:26^117
//│ 	in (([count:6^27 · count:6^2]:19^108 ((add:24^109 c:38^110) 1)) t:41^115)) t1:29^122)
//│ 	| N => a:26^124}))
//│ def [rev:7^30]:16 = (fun a:30 -> (fun ys:31 -> ys:31^128))
//│ def count:6 = (fun c:8 -> (fun xs:9 -> case xs:9^146 of {
//│ 	C h:10 t:11 => ((count:6^147 ((add:4^148 c:8^149) 1)) t:11^154)
//│ 	| N => c:8^156}))
//│ def rev:7 = (fun a:12 -> (fun ys:13 -> case ys:13^134 of {
//│ 	C h1:14 t1:15 => ((rev:7^135 [C h1:14^136 a:12^137]) t1:15^140)
//│ 	| N => a:12^142}))
//│ <<<<<<< after fusion <<<<<<<


// Fusablified program:
fun count(xs) = if xs is
    C(h, t) then c => count(t)(add(c, 1))
    N then c => c
fun rev(a, ys) = if ys is
    C(h1, t1) then rev(C(h1, a), t1)
    N then a
fun init = N
count(rev(N, init))(0)
//│ |#fun| |count|(|xs|)| |#=| |#if| |xs| |is|→|C|(|h|,| |t|)| |#then| |c| |=>| |count|(|t|)|(|add|(|c|,| |1|)|)|↵|N| |#then| |c| |=>| |c|←|↵|#fun| |rev|(|a|,| |ys|)| |#=| |#if| |ys| |is|→|C|(|h1|,| |t1|)| |#then| |rev|(|C|(|h1|,| |a|)|,| |t1|)|↵|N| |#then| |a|←|↵|#fun| |init| |#=| |N|↵|count|(|rev|(|N|,| |init|)|)|(|0|)|
//│ Parsed: {fun count = xs, => if xs is ‹(C (h, t,)) then c, => count (t,) (add (c, 1,),); (N) then c, => c›; fun rev = a, ys, => if ys is ‹(C (h1, t1,)) then rev (C (h1, a,), t1,); (N) then a›; fun init = N; count (rev (N, init,),) (0,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ ((count:6^29 ((rev:7^30 [N]) init:8^33)) 0)
//│ def count:6 = (fun xs:9 -> case xs:9^1 of {
//│ 	C h:10 t:11 => (fun c:12 -> ((count:6^2 t:11^3) ((add:4^5 c:12^6) 1)))
//│ 	| N => (fun c:13 -> c:13^12)})
//│ def init:8 = [N]
//│ def rev:7 = (fun a:14 -> (fun ys:15 -> case ys:15^16 of {
//│ 	C h1:16 t1:17 => ((rev:7^17 [C h1:16^18 a:14^19]) t1:17^22)
//│ 	| N => a:14^24}))
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ >>>>>>> knots >>>>>>>
//│ C(15'h1, 13'a) <: 3'xs
//│ 	[+rev:7^17 · +rev:7^17 · +rev:7^17 · -rev:7^17 · -rev:7^30 · +count:6^29 · +count:6^2 · +count:6^2]  --->  [+rev:7^17 · +rev:7^17 · -rev:7^17 · -rev:7^30 · +count:6^29 · +count:6^2]
//│ 	[+rev:7^17 · +rev:7^17 · +rev:7^17 · -rev:7^30 · +count:6^29 · +count:6^2 · +count:6^2]  --->  [+rev:7^17 · +rev:7^17 · -rev:7^30 · +count:6^29 · +count:6^2]
//│ NoProd <: 3'xs
//│ 	[+rev:7^30 · -rev:7^17 · -rev:7^30 · +count:6^29 · +count:6^2 · +count:6^2]  --->  [+rev:7^30 · -rev:7^17 · -rev:7^30 · +count:6^29 · +count:6^2]
//│ 	[+rev:7^30 · -rev:7^30 · +count:6^29 · +count:6^2 · +count:6^2]  --->  [+rev:7^30 · -rev:7^30 · +count:6^29 · +count:6^2]
//│ NoProd <: 14'ys
//│ 	[-init:8^33 · +rev:7^30 · +rev:7^17 · +rev:7^17]  --->  [-init:8^33 · +rev:7^30 · +rev:7^17]
//│ NoProd <: 5't
//│ 	[+rev:7^30 · +rev:7^17 · +rev:7^17 · -rev:7^17 · -rev:7^30 · +count:6^29 · +count:6^2 · +count:6^2 · +count:6^2]  --->  [+rev:7^30 · +rev:7^17 · +rev:7^17 · -rev:7^17 · -rev:7^30 · +count:6^29 · +count:6^2 · +count:6^2]
//│ 	[+rev:7^30 · +rev:7^17 · +rev:7^17 · -rev:7^30 · +count:6^29 · +count:6^2 · +count:6^2 · +count:6^2]  --->  [+rev:7^30 · +rev:7^17 · +rev:7^17 · -rev:7^30 · +count:6^29 · +count:6^2 · +count:6^2]
//│ 	[+rev:7^30 · +rev:7^17 · -rev:7^17 · -rev:7^30 · +count:6^29 · +count:6^2 · +count:6^2]  --->  [+rev:7^30 · +rev:7^17 · -rev:7^17 · -rev:7^30 · +count:6^29 · +count:6^2]
//│ 	[+rev:7^30 · +rev:7^17 · -rev:7^30 · +count:6^29 · +count:6^2 · +count:6^2]  --->  [+rev:7^30 · +rev:7^17 · -rev:7^30 · +count:6^29 · +count:6^2]
//│ <<<<<<< knots <<<<<<<
//│ 
//│ >>>>>>> splitted knots >>>>>>>
//│ [count:6^29 · count:6^2 · count:6^2] --> [count:6^29 · count:6^2]
//│ [rev:7^30 · rev:7^17 · rev:7^17] --> [rev:7^30 · rev:7^17]
//│ [init:8^33] --> [init:8^33]
//│ [rev:7^30 · rev:7^17] --> [rev:7^30 · rev:7^17]
//│ [rev:7^30] --> [rev:7^30]
//│ [] --> []
//│ <<<<<<< splitted knots <<<<<<<
//│ 
//│ >>>>>>> expansion >>>>>>>
//│ [count:6^29]
//│ 	[count:6^29 · count:6^2]
//│ 		[count:6^29 · count:6^2 · count:6^2] ---> [count:6^29 · count:6^2] (only one)
//│ [init:8^33]
//│ 
//│ [rev:7^30]
//│ 	[rev:7^30 · rev:7^17]
//│ 		[rev:7^30 · rev:7^17 · rev:7^17] ---> [rev:7^30 · rev:7^17] (only one)
//│ <<<<<<< expansion <<<<<<<
//│ 
//│ >>>>>>> expanded program >>>>>>>
//│ (([count:6^29]:21^93 (([rev:7^30]:19^94 [N]) [init:8^33]:18^97)) 0)
//│ def [count:6^29 · count:6^2]:22 = (fun xs:38 -> case xs:38^66 of {
//│ 	C h:39 t:40 => (fun c:41 -> (([count:6^29 · count:6^2]:22^67 t:40^68) ((add:27^70 c:41^71) 1)))
//│ 	| N => (fun c:42 -> c:42^77)})
//│ def [count:6^29]:21 = (fun xs:29 -> case xs:29^38 of {
//│ 	C h:30 t:31 => (fun c:32 -> (([count:6^29 · count:6^2]:22^39 t:31^40) ((add:27^42 c:32^43) 1)))
//│ 	| N => (fun c:33 -> c:33^49)})
//│ def [init:8^33]:18 = [N]
//│ def [rev:7^30 · rev:7^17]:20 = (fun a:43 -> (fun ys:44 -> case ys:44^81 of {
//│ 	C h1:45 t1:46 => (([rev:7^30 · rev:7^17]:20^82 [C h1:45^83 a:43^84]) t1:46^87)
//│ 	| N => a:43^89}))
//│ def [rev:7^30]:19 = (fun a:34 -> (fun ys:35 -> case ys:35^54 of {
//│ 	C h1:36 t1:37 => (([rev:7^30 · rev:7^17]:20^55 [C h1:36^56 a:34^57]) t1:37^60)
//│ 	| N => a:34^62}))
//│ def count:6 = (fun xs:9 -> case xs:9^10 of {
//│ 	C h:10 t:11 => (fun c:12 -> ((count:6^11 t:11^12) ((add:4^14 c:12^15) 1)))
//│ 	| N => (fun c:13 -> c:13^21)})
//│ def init:8 = [N]
//│ def rev:7 = (fun a:14 -> (fun ys:15 -> case ys:15^25 of {
//│ 	C h1:16 t1:17 => ((rev:7^26 [C h1:16^27 a:14^28]) t1:17^31)
//│ 	| N => a:14^33}))
//│ <<<<<<< expanded program <<<<<<<
//│ 
//│ >>>>>>> fusion matches >>>>>>>
//│ 53: [N]
//│ [N] --->
//│ 	case ys:35^54 of {C h1:36 t1:37 => (([rev:7^30 · rev:7^17]:20^55 [C h1:36^56 a:34^57]) t1:37^60) | N => a:34^62}
//│ 58: [C 56: h1:36^56 57: a:34^57]
//│ [C h1:36^56 a:34^57] --->
//│ 	case xs:29^38 of {C h:30 t:31 => (fun c:32 -> (([count:6^29 · count:6^2]:22^39 t:31^40) ((add:27^42 c:32^43) 1))) | N => (fun c:33 -> c:33^49)}
//│ 	case xs:38^66 of {C h:39 t:40 => (fun c:41 -> (([count:6^29 · count:6^2]:22^67 t:40^68) ((add:27^70 c:41^71) 1))) | N => (fun c:42 -> c:42^77)}
//│ 	 MORE THAN ONE MATCH EXPR
//│ 85: [C 83: h1:45^83 84: a:43^84]
//│ [C h1:45^83 a:43^84] --->
//│ 	case xs:29^38 of {C h:30 t:31 => (fun c:32 -> (([count:6^29 · count:6^2]:22^39 t:31^40) ((add:27^42 c:32^43) 1))) | N => (fun c:33 -> c:33^49)}
//│ 	case xs:38^66 of {C h:39 t:40 => (fun c:41 -> (([count:6^29 · count:6^2]:22^67 t:40^68) ((add:27^70 c:41^71) 1))) | N => (fun c:42 -> c:42^77)}
//│ 	 MORE THAN ONE MATCH EXPR
//│ 95: [N]
//│ [N] --->
//│ 	case xs:29^38 of {C h:30 t:31 => (fun c:32 -> (([count:6^29 · count:6^2]:22^39 t:31^40) ((add:27^42 c:32^43) 1))) | N => (fun c:33 -> c:33^49)}
//│ 	case xs:38^66 of {C h:39 t:40 => (fun c:41 -> (([count:6^29 · count:6^2]:22^67 t:40^68) ((add:27^70 c:41^71) 1))) | N => (fun c:42 -> c:42^77)}
//│ 	 MORE THAN ONE MATCH EXPR
//│ <<<<<<< fusion matches <<<<<<<
//│ 
//│ >>>>>>> after fusion >>>>>>>
//│ (([count:6^29]:21^102 (([rev:7^30]:19^103 (fun c:33 -> c:33^104)) [init:8^33]:18^107)) 0)
//│ def [count:6^29 · count:6^2]:22 = (fun xs:38 -> xs:38^165)
//│ def [count:6^29]:21 = (fun xs:29 -> xs:29^128)
//│ def [init:8^33]:18 = a:34^112
//│ def [rev:7^30 · rev:7^17]:20 = (fun a:43 -> (fun ys:44 -> case ys:44^130 of {
//│ 	C h1:45 t1:46 => (([rev:7^30 · rev:7^17]:20^131 let h:30 = h1:45^144
//│ 	in let t:31 = a:43^142
//│ 	in (fun c:32 -> (([count:6^29 · count:6^2]:22^132 t:31^133) ((add:27^135 c:32^136) 1)))) t1:46^147)
//│ 	| N => a:43^149}))
//│ def [rev:7^30]:19 = (fun a:34 -> (fun ys:35 -> ys:35^167))
//│ def count:6 = (fun xs:9 -> case xs:9^113 of {
//│ 	C h:10 t:11 => (fun c:12 -> ((count:6^114 t:11^115) ((add:4^117 c:12^118) 1)))
//│ 	| N => (fun c:13 -> c:13^124)})
//│ def init:8 = [N]
//│ def rev:7 = (fun a:14 -> (fun ys:15 -> case ys:15^153 of {
//│ 	C h1:16 t1:17 => ((rev:7^154 [C h1:16^155 a:14^156]) t1:17^159)
//│ 	| N => a:14^161}))
//│ <<<<<<< after fusion <<<<<<<


// FIXME
// Paper example (original)
fun idxSum(i, xs) = if xs is
    C(h, t) then add(i, idxSum(add(i, 1), t))
    N then 0
fun rev(a, ys) = if ys is
    C(h1, t1) then rev(C(h1, a), t1)
    N then a
idxSum(0, rev(N, N))
//│ |#fun| |idxSum|(|i|,| |xs|)| |#=| |#if| |xs| |is|→|C|(|h|,| |t|)| |#then| |add|(|i|,| |idxSum|(|add|(|i|,| |1|)|,| |t|)|)|↵|N| |#then| |0|←|↵|#fun| |rev|(|a|,| |ys|)| |#=| |#if| |ys| |is|→|C|(|h1|,| |t1|)| |#then| |rev|(|C|(|h1|,| |a|)|,| |t1|)|↵|N| |#then| |a|←|↵|idxSum|(|0|,| |rev|(|N|,| |N|)|)|
//│ Parsed: {fun idxSum = i, xs, => if xs is ‹(C (h, t,)) then add (i, idxSum (add (i, 1,), t,),); (N) then 0›; fun rev = a, ys, => if ys is ‹(C (h1, t1,)) then rev (C (h1, a,), t1,); (N) then a›; idxSum (0, rev (N, N,),)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ ((idxSum:6^31 0) ((rev:7^34 [N]) [N]))
//│ def idxSum:6 = (fun i:8 -> (fun xs:9 -> case xs:9^1 of {
//│ 	C h:10 t:11 => ((add:4^2 i:8^3) ((idxSum:6^5 ((add:4^6 i:8^7) 1)) t:11^12))
//│ 	| N => 0}))
//│ def rev:7 = (fun a:12 -> (fun ys:13 -> case ys:13^19 of {
//│ 	C h1:14 t1:15 => ((rev:7^20 [C h1:14^21 a:12^22]) t1:15^25)
//│ 	| N => a:12^27}))
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ >>>>>>> knots >>>>>>>
//│ C(15'h1, 13'a) <: 3'xs
//│ 	[+rev:7^20 · +rev:7^20 · +rev:7^20 · -rev:7^20 · -rev:7^34 · +idxSum:6^31 · +idxSum:6^5 · +idxSum:6^5]  --->  [+rev:7^20 · +rev:7^20 · -rev:7^20 · -rev:7^34 · +idxSum:6^31 · +idxSum:6^5]
//│ 	[+rev:7^20 · +rev:7^20 · +rev:7^20 · -rev:7^34 · +idxSum:6^31 · +idxSum:6^5 · +idxSum:6^5]  --->  [+rev:7^20 · +rev:7^20 · -rev:7^34 · +idxSum:6^31 · +idxSum:6^5]
//│ NoProd <: 3'xs
//│ 	[+rev:7^34 · -rev:7^20 · -rev:7^34 · +idxSum:6^31 · +idxSum:6^5 · +idxSum:6^5]  --->  [+rev:7^34 · -rev:7^20 · -rev:7^34 · +idxSum:6^31 · +idxSum:6^5]
//│ 	[+rev:7^34 · -rev:7^34 · +idxSum:6^31 · +idxSum:6^5 · +idxSum:6^5]  --->  [+rev:7^34 · -rev:7^34 · +idxSum:6^31 · +idxSum:6^5]
//│ NoProd <: 14'ys
//│ 	[+rev:7^34 · +rev:7^20 · +rev:7^20]  --->  [+rev:7^34 · +rev:7^20]
//│ NoProd <: 5't
//│ 	[+rev:7^34 · +rev:7^20 · +rev:7^20 · -rev:7^20 · -rev:7^34 · +idxSum:6^31 · +idxSum:6^5 · +idxSum:6^5 · +idxSum:6^5]  --->  [+rev:7^34 · +rev:7^20 · +rev:7^20 · -rev:7^20 · -rev:7^34 · +idxSum:6^31 · +idxSum:6^5 · +idxSum:6^5]
//│ 	[+rev:7^34 · +rev:7^20 · +rev:7^20 · -rev:7^34 · +idxSum:6^31 · +idxSum:6^5 · +idxSum:6^5 · +idxSum:6^5]  --->  [+rev:7^34 · +rev:7^20 · +rev:7^20 · -rev:7^34 · +idxSum:6^31 · +idxSum:6^5 · +idxSum:6^5]
//│ 	[+rev:7^34 · +rev:7^20 · -rev:7^20 · -rev:7^34 · +idxSum:6^31 · +idxSum:6^5 · +idxSum:6^5]  --->  [+rev:7^34 · +rev:7^20 · -rev:7^20 · -rev:7^34 · +idxSum:6^31 · +idxSum:6^5]
//│ 	[+rev:7^34 · +rev:7^20 · -rev:7^34 · +idxSum:6^31 · +idxSum:6^5 · +idxSum:6^5]  --->  [+rev:7^34 · +rev:7^20 · -rev:7^34 · +idxSum:6^31 · +idxSum:6^5]
//│ <<<<<<< knots <<<<<<<
//│ 
//│ >>>>>>> splitted knots >>>>>>>
//│ [idxSum:6^31 · idxSum:6^5 · idxSum:6^5] --> [idxSum:6^31 · idxSum:6^5]
//│ [rev:7^34 · rev:7^20 · rev:7^20] --> [rev:7^34 · rev:7^20]
//│ [rev:7^34 · rev:7^20] --> [rev:7^34 · rev:7^20]
//│ [rev:7^34] --> [rev:7^34]
//│ [] --> []
//│ <<<<<<< splitted knots <<<<<<<
//│ 
//│ >>>>>>> expansion >>>>>>>
//│ [idxSum:6^31]
//│ 	[idxSum:6^31 · idxSum:6^5]
//│ 		[idxSum:6^31 · idxSum:6^5 · idxSum:6^5] ---> [idxSum:6^31 · idxSum:6^5] (only one)
//│ [rev:7^34]
//│ 	[rev:7^34 · rev:7^20]
//│ 		[rev:7^34 · rev:7^20 · rev:7^20] ---> [rev:7^34 · rev:7^20] (only one)
//│ <<<<<<< expansion <<<<<<<
//│ 
//│ >>>>>>> expanded program >>>>>>>
//│ (([idxSum:6^31]:18^100 0) (([rev:7^34]:16^103 [N]) [N]))
//│ def [idxSum:6^31 · idxSum:6^5]:19 = (fun i:34 -> (fun xs:35 -> case xs:35^70 of {
//│ 	C h:36 t:37 => ((add:24^71 i:34^72) (([idxSum:6^31 · idxSum:6^5]:19^74 ((add:24^75 i:34^76) 1)) t:37^81))
//│ 	| N => 0}))
//│ def [idxSum:6^31]:18 = (fun i:26 -> (fun xs:27 -> case xs:27^40 of {
//│ 	C h:28 t:29 => ((add:24^41 i:26^42) (([idxSum:6^31 · idxSum:6^5]:19^44 ((add:24^45 i:26^46) 1)) t:29^51))
//│ 	| N => 0}))
//│ def [rev:7^34 · rev:7^20]:17 = (fun a:38 -> (fun ys:39 -> case ys:39^88 of {
//│ 	C h1:40 t1:41 => (([rev:7^34 · rev:7^20]:17^89 [C h1:40^90 a:38^91]) t1:41^94)
//│ 	| N => a:38^96}))
//│ def [rev:7^34]:16 = (fun a:30 -> (fun ys:31 -> case ys:31^58 of {
//│ 	C h1:32 t1:33 => (([rev:7^34 · rev:7^20]:17^59 [C h1:32^60 a:30^61]) t1:33^64)
//│ 	| N => a:30^66}))
//│ def idxSum:6 = (fun i:8 -> (fun xs:9 -> case xs:9^10 of {
//│ 	C h:10 t:11 => ((add:4^11 i:8^12) ((idxSum:6^14 ((add:4^15 i:8^16) 1)) t:11^21))
//│ 	| N => 0}))
//│ def rev:7 = (fun a:12 -> (fun ys:13 -> case ys:13^28 of {
//│ 	C h1:14 t1:15 => ((rev:7^29 [C h1:14^30 a:12^31]) t1:15^34)
//│ 	| N => a:12^36}))
//│ <<<<<<< expanded program <<<<<<<
//│ 
//│ >>>>>>> fusion matches >>>>>>>
//│ 104: [N]
//│ [N] --->
//│ 	case xs:27^40 of {C h:28 t:29 => ((add:24^41 i:26^42) (([idxSum:6^31 · idxSum:6^5]:19^44 ((add:24^45 i:26^46) 1)) t:29^51)) | N => 0}
//│ 	case xs:35^70 of {C h:36 t:37 => ((add:24^71 i:34^72) (([idxSum:6^31 · idxSum:6^5]:19^74 ((add:24^75 i:34^76) 1)) t:37^81)) | N => 0}
//│ 	 MORE THAN ONE MATCH EXPR
//│ 106: [N]
//│ [N] --->
//│ 	case ys:31^58 of {C h1:32 t1:33 => (([rev:7^34 · rev:7^20]:17^59 [C h1:32^60 a:30^61]) t1:33^64) | N => a:30^66}
//│ 62: [C 60: h1:32^60 61: a:30^61]
//│ [C h1:32^60 a:30^61] --->
//│ 	case xs:27^40 of {C h:28 t:29 => ((add:24^41 i:26^42) (([idxSum:6^31 · idxSum:6^5]:19^44 ((add:24^45 i:26^46) 1)) t:29^51)) | N => 0}
//│ 	case xs:35^70 of {C h:36 t:37 => ((add:24^71 i:34^72) (([idxSum:6^31 · idxSum:6^5]:19^74 ((add:24^75 i:34^76) 1)) t:37^81)) | N => 0}
//│ 	 MORE THAN ONE MATCH EXPR
//│ 92: [C 90: h1:40^90 91: a:38^91]
//│ [C h1:40^90 a:38^91] --->
//│ 	case xs:27^40 of {C h:28 t:29 => ((add:24^41 i:26^42) (([idxSum:6^31 · idxSum:6^5]:19^44 ((add:24^45 i:26^46) 1)) t:29^51)) | N => 0}
//│ 	case xs:35^70 of {C h:36 t:37 => ((add:24^71 i:34^72) (([idxSum:6^31 · idxSum:6^5]:19^74 ((add:24^75 i:34^76) 1)) t:37^81)) | N => 0}
//│ 	 MORE THAN ONE MATCH EXPR
//│ <<<<<<< fusion matches <<<<<<<
//│ 
//│ >>>>>>> after fusion >>>>>>>
//│ (([idxSum:6^31]:18^109 0) (([rev:7^34]:16^112 0) a:30^115))
//│ def [idxSum:6^31 · idxSum:6^5]:19 = (fun i:34 -> (fun xs:35 -> xs:35^168))
//│ def [idxSum:6^31]:18 = (fun i:26 -> (fun xs:27 -> xs:27^118))
//│ def [rev:7^34 · rev:7^20]:17 = (fun a:38 -> (fun ys:39 -> case ys:39^142 of {
//│ 	C h1:40 t1:41 => (([rev:7^34 · rev:7^20]:17^143 let h:28 = h1:40^159
//│ 	in let t:29 = a:38^157
//│ 	in ((add:24^144 i:26^145) (([idxSum:6^31 · idxSum:6^5]:19^147 ((add:24^148 i:26^149) 1)) t:29^154))) t1:41^162)
//│ 	| N => a:38^164}))
//│ def [rev:7^34]:16 = (fun a:30 -> (fun ys:31 -> ys:31^121))
//│ def idxSum:6 = (fun i:8 -> (fun xs:9 -> case xs:9^124 of {
//│ 	C h:10 t:11 => ((add:4^125 i:8^126) ((idxSum:6^128 ((add:4^129 i:8^130) 1)) t:11^135))
//│ 	| N => 0}))
//│ def rev:7 = (fun a:12 -> (fun ys:13 -> case ys:13^171 of {
//│ 	C h1:14 t1:15 => ((rev:7^172 [C h1:14^173 a:12^174]) t1:15^177)
//│ 	| N => a:12^179}))
//│ <<<<<<< after fusion <<<<<<<




fun count(xs) = if xs is
    C(h, t) then add(1, count(t))
    N then 0
fun rev(a, ys) = if ys is
    C(h1, t1) then rev(C(h1, a), t1)
    N then a
fun init = N
count(rev(N, init))
//│ |#fun| |count|(|xs|)| |#=| |#if| |xs| |is|→|C|(|h|,| |t|)| |#then| |add|(|1|,| |count|(|t|)|)|↵|N| |#then| |0|←|↵|#fun| |rev|(|a|,| |ys|)| |#=| |#if| |ys| |is|→|C|(|h1|,| |t1|)| |#then| |rev|(|C|(|h1|,| |a|)|,| |t1|)|↵|N| |#then| |a|←|↵|#fun| |init| |#=| |N|↵|count|(|rev|(|N|,| |init|)|)|
//│ Parsed: {fun count = xs, => if xs is ‹(C (h, t,)) then add (1, count (t,),); (N) then 0›; fun rev = a, ys, => if ys is ‹(C (h1, t1,)) then rev (C (h1, a,), t1,); (N) then a›; fun init = N; count (rev (N, init,),)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ (count:6^25 ((rev:7^26 [N]) init:8^29))
//│ def count:6 = (fun xs:9 -> case xs:9^1 of {
//│ 	C h:10 t:11 => ((add:4^2 1) (count:6^5 t:11^6))
//│ 	| N => 0})
//│ def init:8 = [N]
//│ def rev:7 = (fun a:12 -> (fun ys:13 -> case ys:13^12 of {
//│ 	C h1:14 t1:15 => ((rev:7^13 [C h1:14^14 a:12^15]) t1:15^18)
//│ 	| N => a:12^20}))
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ >>>>>>> knots >>>>>>>
//│ C(12'h1, 10'a) <: 3'xs
//│ 	[+rev:7^13 · +rev:7^13 · +rev:7^13 · -rev:7^13 · -rev:7^26 · +count:6^25 · +count:6^5 · +count:6^5]  --->  [+rev:7^13 · +rev:7^13 · -rev:7^13 · -rev:7^26 · +count:6^25 · +count:6^5]
//│ 	[+rev:7^13 · +rev:7^13 · +rev:7^13 · -rev:7^26 · +count:6^25 · +count:6^5 · +count:6^5]  --->  [+rev:7^13 · +rev:7^13 · -rev:7^26 · +count:6^25 · +count:6^5]
//│ NoProd <: 3'xs
//│ 	[+rev:7^26 · -rev:7^13 · -rev:7^26 · +count:6^25 · +count:6^5 · +count:6^5]  --->  [+rev:7^26 · -rev:7^13 · -rev:7^26 · +count:6^25 · +count:6^5]
//│ 	[+rev:7^26 · -rev:7^26 · +count:6^25 · +count:6^5 · +count:6^5]  --->  [+rev:7^26 · -rev:7^26 · +count:6^25 · +count:6^5]
//│ NoProd <: 11'ys
//│ 	[-init:8^29 · +rev:7^26 · +rev:7^13 · +rev:7^13]  --->  [-init:8^29 · +rev:7^26 · +rev:7^13]
//│ NoProd <: 5't
//│ 	[+rev:7^26 · +rev:7^13 · +rev:7^13 · -rev:7^13 · -rev:7^26 · +count:6^25 · +count:6^5 · +count:6^5 · +count:6^5]  --->  [+rev:7^26 · +rev:7^13 · +rev:7^13 · -rev:7^13 · -rev:7^26 · +count:6^25 · +count:6^5 · +count:6^5]
//│ 	[+rev:7^26 · +rev:7^13 · +rev:7^13 · -rev:7^26 · +count:6^25 · +count:6^5 · +count:6^5 · +count:6^5]  --->  [+rev:7^26 · +rev:7^13 · +rev:7^13 · -rev:7^26 · +count:6^25 · +count:6^5 · +count:6^5]
//│ 	[+rev:7^26 · +rev:7^13 · -rev:7^13 · -rev:7^26 · +count:6^25 · +count:6^5 · +count:6^5]  --->  [+rev:7^26 · +rev:7^13 · -rev:7^13 · -rev:7^26 · +count:6^25 · +count:6^5]
//│ 	[+rev:7^26 · +rev:7^13 · -rev:7^26 · +count:6^25 · +count:6^5 · +count:6^5]  --->  [+rev:7^26 · +rev:7^13 · -rev:7^26 · +count:6^25 · +count:6^5]
//│ <<<<<<< knots <<<<<<<
//│ 
//│ >>>>>>> splitted knots >>>>>>>
//│ [count:6^25 · count:6^5 · count:6^5] --> [count:6^25 · count:6^5]
//│ [rev:7^26 · rev:7^13 · rev:7^13] --> [rev:7^26 · rev:7^13]
//│ [init:8^29] --> [init:8^29]
//│ [rev:7^26 · rev:7^13] --> [rev:7^26 · rev:7^13]
//│ [rev:7^26] --> [rev:7^26]
//│ [] --> []
//│ <<<<<<< splitted knots <<<<<<<
//│ 
//│ >>>>>>> expansion >>>>>>>
//│ [count:6^25]
//│ 	[count:6^25 · count:6^5]
//│ 		[count:6^25 · count:6^5 · count:6^5] ---> [count:6^25 · count:6^5] (only one)
//│ [init:8^29]
//│ 
//│ [rev:7^26]
//│ 	[rev:7^26 · rev:7^13]
//│ 		[rev:7^26 · rev:7^13 · rev:7^13] ---> [rev:7^26 · rev:7^13] (only one)
//│ <<<<<<< expansion <<<<<<<
//│ 
//│ >>>>>>> expanded program >>>>>>>
//│ ([count:6^25]:19^79 (([rev:7^26]:16^80 [N]) [init:8^29]:18^83))
//│ def [count:6^25 · count:6^5]:20 = (fun xs:35 -> case xs:35^56 of {
//│ 	C h:36 t:37 => ((add:25^57 1) ([count:6^25 · count:6^5]:20^60 t:37^61))
//│ 	| N => 0})
//│ def [count:6^25]:19 = (fun xs:38 -> case xs:38^68 of {
//│ 	C h:39 t:40 => ((add:25^69 1) ([count:6^25 · count:6^5]:20^72 t:40^73))
//│ 	| N => 0})
//│ def [init:8^29]:18 = [N]
//│ def [rev:7^26 · rev:7^13]:17 = (fun a:27 -> (fun ys:28 -> case ys:28^32 of {
//│ 	C h1:29 t1:30 => (([rev:7^26 · rev:7^13]:17^33 [C h1:29^34 a:27^35]) t1:30^38)
//│ 	| N => a:27^40}))
//│ def [rev:7^26]:16 = (fun a:31 -> (fun ys:32 -> case ys:32^44 of {
//│ 	C h1:33 t1:34 => (([rev:7^26 · rev:7^13]:17^45 [C h1:33^46 a:31^47]) t1:34^50)
//│ 	| N => a:31^52}))
//│ def count:6 = (fun xs:9 -> case xs:9^8 of {
//│ 	C h:10 t:11 => ((add:4^9 1) (count:6^12 t:11^13))
//│ 	| N => 0})
//│ def init:8 = [N]
//│ def rev:7 = (fun a:12 -> (fun ys:13 -> case ys:13^19 of {
//│ 	C h1:14 t1:15 => ((rev:7^20 [C h1:14^21 a:12^22]) t1:15^25)
//│ 	| N => a:12^27}))
//│ <<<<<<< expanded program <<<<<<<
//│ 
//│ >>>>>>> fusion matches >>>>>>>
//│ 36: [C 34: h1:29^34 35: a:27^35]
//│ [C h1:29^34 a:27^35] --->
//│ 	case xs:35^56 of {C h:36 t:37 => ((add:25^57 1) ([count:6^25 · count:6^5]:20^60 t:37^61)) | N => 0}
//│ 	case xs:38^68 of {C h:39 t:40 => ((add:25^69 1) ([count:6^25 · count:6^5]:20^72 t:40^73)) | N => 0}
//│ 	 MORE THAN ONE MATCH EXPR
//│ 48: [C 46: h1:33^46 47: a:31^47]
//│ [C h1:33^46 a:31^47] --->
//│ 	case xs:35^56 of {C h:36 t:37 => ((add:25^57 1) ([count:6^25 · count:6^5]:20^60 t:37^61)) | N => 0}
//│ 	case xs:38^68 of {C h:39 t:40 => ((add:25^69 1) ([count:6^25 · count:6^5]:20^72 t:40^73)) | N => 0}
//│ 	 MORE THAN ONE MATCH EXPR
//│ 67: [N]
//│ [N] --->
//│ 	case ys:32^44 of {C h1:33 t1:34 => (([rev:7^26 · rev:7^13]:17^45 [C h1:33^46 a:31^47]) t1:34^50) | N => a:31^52}
//│ 81: [N]
//│ [N] --->
//│ 	case xs:35^56 of {C h:36 t:37 => ((add:25^57 1) ([count:6^25 · count:6^5]:20^60 t:37^61)) | N => 0}
//│ 	case xs:38^68 of {C h:39 t:40 => ((add:25^69 1) ([count:6^25 · count:6^5]:20^72 t:40^73)) | N => 0}
//│ 	 MORE THAN ONE MATCH EXPR
//│ <<<<<<< fusion matches <<<<<<<
//│ 
//│ >>>>>>> after fusion >>>>>>>
//│ ([count:6^25]:19^86 (([rev:7^26]:16^87 0) [init:8^29]:18^90))
//│ def [count:6^25 · count:6^5]:20 = (fun xs:35 -> case xs:35^143 of {
//│ 	C h:36 t:37 => ((add:25^144 1) ([count:6^25 · count:6^5]:20^147 t:37^148))
//│ 	| N => 0})
//│ def [count:6^25]:19 = (fun xs:38 -> xs:38^140)
//│ def [init:8^29]:18 = a:31^142
//│ def [rev:7^26 · rev:7^13]:17 = (fun a:27 -> (fun ys:28 -> case ys:28^120 of {
//│ 	C h1:29 t1:30 => (([rev:7^26 · rev:7^13]:17^121 let h:39 = h1:29^131
//│ 	in let t:40 = a:27^129
//│ 	in ((add:25^122 1) ([count:6^25 · count:6^5]:20^125 t:40^126))) t1:30^134)
//│ 	| N => a:27^136}))
//│ def [rev:7^26]:16 = (fun a:31 -> (fun ys:32 -> ys:32^105))
//│ def count:6 = (fun xs:9 -> case xs:9^93 of {
//│ 	C h:10 t:11 => ((add:4^94 1) (count:6^97 t:11^98))
//│ 	| N => 0})
//│ def init:8 = [N]
//│ def rev:7 = (fun a:12 -> (fun ys:13 -> case ys:13^108 of {
//│ 	C h1:14 t1:15 => ((rev:7^109 [C h1:14^110 a:12^111]) t1:15^114)
//│ 	| N => a:12^116}))
//│ <<<<<<< after fusion <<<<<<<


fun rev(a, ys) = if ys is
    C(h1, t1) then rev(C(h1, a), t1)
    N then a
fun init = C(0, init)
rev(N, init)
//│ |#fun| |rev|(|a|,| |ys|)| |#=| |#if| |ys| |is|→|C|(|h1|,| |t1|)| |#then| |rev|(|C|(|h1|,| |a|)|,| |t1|)|↵|N| |#then| |a|←|↵|#fun| |init| |#=| |C|(|0|,| |init|)|↵|rev|(|N|,| |init|)|
//│ Parsed: {fun rev = a, ys, => if ys is ‹(C (h1, t1,)) then rev (C (h1, a,), t1,); (N) then a›; fun init = C (0, init,); rev (N, init,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ ((rev:6^16 [N]) init:7^19)
//│ def init:7 = [C 0 init:7^14]
//│ def rev:6 = (fun a:8 -> (fun ys:9 -> case ys:9^1 of {
//│ 	C h1:10 t1:11 => ((rev:6^2 [C h1:10^3 a:8^4]) t1:11^7)
//│ 	| N => a:8^9}))
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ >>>>>>> knots >>>>>>>
//│ C(Int, 1'init_7^14) <: 3'ys
//│ 	[-init:7^14 · -init:7^14 · -init:7^19 · +rev:6^16 · +rev:6^2 · +rev:6^2]  --->  [-init:7^14 · -init:7^19 · +rev:6^16 · +rev:6^2]
//│ <<<<<<< knots <<<<<<<
//│ 
//│ >>>>>>> splitted knots >>>>>>>
//│ [rev:6^16 · rev:6^2 · rev:6^2] --> [rev:6^16 · rev:6^2]
//│ [init:7^19 · init:7^14 · init:7^14] --> [init:7^19 · init:7^14]
//│ <<<<<<< splitted knots <<<<<<<
//│ 
//│ >>>>>>> expansion >>>>>>>
//│ [init:7^19]
//│ 	[init:7^19 · init:7^14]
//│ 		[init:7^19 · init:7^14 · init:7^14] ---> [init:7^19 · init:7^14] (only one)
//│ [rev:6^16]
//│ 	[rev:6^16 · rev:6^2]
//│ 		[rev:6^16 · rev:6^2 · rev:6^2] ---> [rev:6^16 · rev:6^2] (only one)
//│ <<<<<<< expansion <<<<<<<
//│ 
//│ >>>>>>> expanded program >>>>>>>
//│ (([rev:6^16]:12^51 [N]) [init:7^19]:14^54)
//│ def [init:7^19 · init:7^14]:15 = [C 0 [init:7^19 · init:7^14]:15^22]
//│ def [init:7^19]:14 = [C 0 [init:7^19 · init:7^14]:15^49]
//│ def [rev:6^16 · rev:6^2]:13 = (fun a:22 -> (fun ys:23 -> case ys:23^24 of {
//│ 	C h1:24 t1:25 => (([rev:6^16 · rev:6^2]:13^25 [C h1:24^26 a:22^27]) t1:25^30)
//│ 	| N => a:22^32}))
//│ def [rev:6^16]:12 = (fun a:26 -> (fun ys:27 -> case ys:27^36 of {
//│ 	C h1:28 t1:29 => (([rev:6^16 · rev:6^2]:13^37 [C h1:28^38 a:26^39]) t1:29^42)
//│ 	| N => a:26^44}))
//│ def init:7 = [C 0 init:7^19]
//│ def rev:6 = (fun a:8 -> (fun ys:9 -> case ys:9^6 of {
//│ 	C h1:10 t1:11 => ((rev:6^7 [C h1:10^8 a:8^9]) t1:11^12)
//│ 	| N => a:8^14}))
//│ <<<<<<< expanded program <<<<<<<
//│ 
//│ >>>>>>> fusion matches >>>>>>>
//│ 23: [C 21: 0 22: [init:7^19 · init:7^14]:15^22]
//│ [C 0 [init:7^19 · init:7^14]:15^22] --->
//│ 	case ys:23^24 of {C h1:24 t1:25 => (([rev:6^16 · rev:6^2]:13^25 [C h1:24^26 a:22^27]) t1:25^30) | N => a:22^32}
//│ 50: [C 48: 0 49: [init:7^19 · init:7^14]:15^49]
//│ [C 0 [init:7^19 · init:7^14]:15^49] --->
//│ 	case ys:27^36 of {C h1:28 t1:29 => (([rev:6^16 · rev:6^2]:13^37 [C h1:28^38 a:26^39]) t1:29^42) | N => a:26^44}
//│ <<<<<<< fusion matches <<<<<<<
//│ 
//│ >>>>>>> after fusion >>>>>>>
//│ (([rev:6^16]:12^56 [N]) [init:7^19]:14^59)
//│ def [init:7^19 · init:7^14]:15 = let h1:24 = 0
//│ in let t1:25 = [init:7^19 · init:7^14]:15^68
//│ in (([rev:6^16 · rev:6^2]:13^61 [C h1:24^62 a:22^63]) t1:25^66)
//│ def [init:7^19]:14 = let h1:28 = 0
//│ in let t1:29 = [init:7^19 · init:7^14]:15^94
//│ in (([rev:6^16 · rev:6^2]:13^87 [C h1:28^88 a:26^89]) t1:29^92)
//│ def [rev:6^16 · rev:6^2]:13 = (fun a:22 -> (fun ys:23 -> ys:23^98))
//│ def [rev:6^16]:12 = (fun a:26 -> (fun ys:27 -> ys:27^84))
//│ def init:7 = [C 0 init:7^102]
//│ def rev:6 = (fun a:8 -> (fun ys:9 -> case ys:9^72 of {
//│ 	C h1:10 t1:11 => ((rev:6^73 [C h1:10^74 a:8^75]) t1:11^78)
//│ 	| N => a:8^80}))
//│ <<<<<<< after fusion <<<<<<<

fun rev(a, ys) = if ys is
    C(h1, t1) then rev(C(h1, a), t1)
fun init = C(0, init)
rev(N, init)
//│ |#fun| |rev|(|a|,| |ys|)| |#=| |#if| |ys| |is|→|C|(|h1|,| |t1|)| |#then| |rev|(|C|(|h1|,| |a|)|,| |t1|)|←|↵|#fun| |init| |#=| |C|(|0|,| |init|)|↵|rev|(|N|,| |init|)|
//│ Parsed: {fun rev = a, ys, => if ys is ‹(C (h1, t1,)) then rev (C (h1, a,), t1,)›; fun init = C (0, init,); rev (N, init,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ ((rev:6^15 [N]) init:7^18)
//│ def init:7 = [C 0 init:7^13]
//│ def rev:6 = (fun a:8 -> (fun ys:9 -> case ys:9^1 of {
//│ 	C h1:10 t1:11 => ((rev:6^2 [C h1:10^3 a:8^4]) t1:11^7)}))
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ >>>>>>> knots >>>>>>>
//│ C(Int, 1'init_7^13) <: 3'ys
//│ 	[-init:7^13 · -init:7^13 · -init:7^18 · +rev:6^15 · +rev:6^2 · +rev:6^2]  --->  [-init:7^13 · -init:7^18 · +rev:6^15 · +rev:6^2]
//│ <<<<<<< knots <<<<<<<
//│ 
//│ >>>>>>> splitted knots >>>>>>>
//│ [rev:6^15 · rev:6^2 · rev:6^2] --> [rev:6^15 · rev:6^2]
//│ [init:7^18 · init:7^13 · init:7^13] --> [init:7^18 · init:7^13]
//│ <<<<<<< splitted knots <<<<<<<
//│ 
//│ >>>>>>> expansion >>>>>>>
//│ [init:7^18]
//│ 	[init:7^18 · init:7^13]
//│ 		[init:7^18 · init:7^13 · init:7^13] ---> [init:7^18 · init:7^13] (only one)
//│ [rev:6^15]
//│ 	[rev:6^15 · rev:6^2]
//│ 		[rev:6^15 · rev:6^2 · rev:6^2] ---> [rev:6^15 · rev:6^2] (only one)
//│ <<<<<<< expansion <<<<<<<
//│ 
//│ >>>>>>> expanded program >>>>>>>
//│ (([rev:6^15]:14^48 [N]) [init:7^18]:12^51)
//│ def [init:7^18 · init:7^13]:13 = [C 0 [init:7^18 · init:7^13]:13^46]
//│ def [init:7^18]:12 = [C 0 [init:7^18 · init:7^13]:13^43]
//│ def [rev:6^15 · rev:6^2]:15 = (fun a:22 -> (fun ys:23 -> case ys:23^20 of {
//│ 	C h1:24 t1:25 => (([rev:6^15 · rev:6^2]:15^21 [C h1:24^22 a:22^23]) t1:25^26)}))
//│ def [rev:6^15]:14 = (fun a:26 -> (fun ys:27 -> case ys:27^31 of {
//│ 	C h1:28 t1:29 => (([rev:6^15 · rev:6^2]:15^32 [C h1:28^33 a:26^34]) t1:29^37)}))
//│ def init:7 = [C 0 init:7^18]
//│ def rev:6 = (fun a:8 -> (fun ys:9 -> case ys:9^6 of {
//│ 	C h1:10 t1:11 => ((rev:6^7 [C h1:10^8 a:8^9]) t1:11^12)}))
//│ <<<<<<< expanded program <<<<<<<
//│ 
//│ >>>>>>> fusion matches >>>>>>>
//│ 44: [C 42: 0 43: [init:7^18 · init:7^13]:13^43]
//│ [C 0 [init:7^18 · init:7^13]:13^43] --->
//│ 	case ys:27^31 of {C h1:28 t1:29 => (([rev:6^15 · rev:6^2]:15^32 [C h1:28^33 a:26^34]) t1:29^37)}
//│ 47: [C 45: 0 46: [init:7^18 · init:7^13]:13^46]
//│ [C 0 [init:7^18 · init:7^13]:13^46] --->
//│ 	case ys:23^20 of {C h1:24 t1:25 => (([rev:6^15 · rev:6^2]:15^21 [C h1:24^22 a:22^23]) t1:25^26)}
//│ <<<<<<< fusion matches <<<<<<<
//│ 
//│ >>>>>>> after fusion >>>>>>>
//│ (([rev:6^15]:14^53 [N]) [init:7^18]:12^56)
//│ def [init:7^18 · init:7^13]:13 = let h1:24 = 0
//│ in let t1:25 = [init:7^18 · init:7^13]:13^93
//│ in (([rev:6^15 · rev:6^2]:15^86 [C h1:24^87 a:22^88]) t1:25^91)
//│ def [init:7^18]:12 = let h1:28 = 0
//│ in let t1:29 = [init:7^18 · init:7^13]:13^82
//│ in (([rev:6^15 · rev:6^2]:15^75 [C h1:28^76 a:26^77]) t1:29^80)
//│ def [rev:6^15 · rev:6^2]:15 = (fun a:22 -> (fun ys:23 -> ys:23^61))
//│ def [rev:6^15]:14 = (fun a:26 -> (fun ys:27 -> ys:27^58))
//│ def init:7 = [C 0 init:7^98]
//│ def rev:6 = (fun a:8 -> (fun ys:9 -> case ys:9^64 of {
//│ 	C h1:10 t1:11 => ((rev:6^65 [C h1:10^66 a:8^67]) t1:11^70)}))
//│ <<<<<<< after fusion <<<<<<<

fun c(x) = if x is
    C(a) then c(a)
    N then N
//│ |#fun| |c|(|x|)| |#=| |#if| |x| |is|→|C|(|a|)| |#then| |c|(|a|)|↵|N| |#then| |N|←|
//│ Parsed: {fun c = x, => if x is ‹(C (a,)) then c (a,); (N) then N›}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def c:6 = (fun x:7 -> case x:7^1 of {
//│ 	C a:8 => (c:6^2 a:8^3)
//│ 	| N => [N]})
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ >>>>>>> knots >>>>>>>
//│ <<<<<<< knots <<<<<<<
//│ 
//│ >>>>>>> splitted knots >>>>>>>
//│ <<<<<<< splitted knots <<<<<<<
//│ 
//│ >>>>>>> expansion >>>>>>>
//│ 
//│ <<<<<<< expansion <<<<<<<
//│ 
//│ >>>>>>> expanded program >>>>>>>
//│ def c:6 = (fun x:7 -> case x:7^1 of {
//│ 	C a:8 => (c:6^2 a:8^3)
//│ 	| N => [N]})
//│ <<<<<<< expanded program <<<<<<<
//│ 
//│ >>>>>>> fusion matches >>>>>>>
//│ 
//│ <<<<<<< fusion matches <<<<<<<
//│ 
//│ >>>>>>> after fusion >>>>>>>
//│ def c:6 = (fun x:7 -> case x:7^8 of {
//│ 	C a:8 => (c:6^9 a:8^10)
//│ 	| N => [N]})
//│ <<<<<<< after fusion <<<<<<<


fun rev(a, ys) = if ys is
    C(h1, t1) then rev(a, t1)
    N then a
fun rev2(a2, ys2) = if ys2 is
    C(h12, t12) then rev2(a2, t12)
    N then a2
fun init = C(0, init)
fun init2 = C(0, init2)
rev(rev2, init)(1, init2)
//│ |#fun| |rev|(|a|,| |ys|)| |#=| |#if| |ys| |is|→|C|(|h1|,| |t1|)| |#then| |rev|(|a|,| |t1|)|↵|N| |#then| |a|←|↵|#fun| |rev2|(|a2|,| |ys2|)| |#=| |#if| |ys2| |is|→|C|(|h12|,| |t12|)| |#then| |rev2|(|a2|,| |t12|)|↵|N| |#then| |a2|←|↵|#fun| |init| |#=| |C|(|0|,| |init|)|↵|#fun| |init2| |#=| |C|(|0|,| |init2|)|↵|rev|(|rev2|,| |init|)|(|1|,| |init2|)|
//│ Parsed: {fun rev = a, ys, => if ys is ‹(C (h1, t1,)) then rev (a, t1,); (N) then a›; fun rev2 = a2, ys2, => if ys2 is ‹(C (h12, t12,)) then rev2 (a2, t12,); (N) then a2›; fun init = C (0, init,); fun init2 = C (0, init2,); rev (rev2, init,) (1, init2,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ ((((rev:6^27 rev2:7^28) init:8^30) 1) init2:9^34)
//│ def init:8 = [C 0 init:8^22]
//│ def init2:9 = [C 0 init2:9^25]
//│ def rev:6 = (fun a:10 -> (fun ys:11 -> case ys:11^1 of {
//│ 	C h1:12 t1:13 => ((rev:6^2 a:10^3) t1:13^5)
//│ 	| N => a:10^7}))
//│ def rev2:7 = (fun a2:14 -> (fun ys2:15 -> case ys2:15^11 of {
//│ 	C h12:16 t12:17 => ((rev2:7^12 a2:14^13) t12:17^15)
//│ 	| N => a2:14^17}))
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ >>>>>>> knots >>>>>>>
//│ C(Int, 2'init_8^22) <: 5'ys
//│ 	[-init:8^22 · -init:8^22 · -init:8^30 · +rev:6^27 · +rev:6^2 · +rev:6^2]  --->  [-init:8^22 · -init:8^30 · +rev:6^27 · +rev:6^2]
//│ C(Int, 3'init2_9^25) <: 12'ys2
//│ 	[-init2:9^25 · -init2:9^34 · +rev:6^27 · +rev:6^2 · -rev:6^27 · +rev2:7^28 · +rev2:7^12]  --->  [-init2:9^34 · +rev:6^27 · +rev:6^2 · -rev:6^27 · +rev2:7^28]
//│ 	[-init2:9^25 · -init2:9^34 · +rev:6^27 · -rev:6^27 · +rev2:7^28 · +rev2:7^12]  --->  [-init2:9^34 · +rev:6^27 · -rev:6^27 · +rev2:7^28]
//│ <<<<<<< knots <<<<<<<
//│ 
//│ >>>>>>> splitted knots >>>>>>>
//│ [rev2:7^28 · rev2:7^12] --> [rev2:7^28]
//│ [rev:6^27 · rev:6^2 · rev:6^2] --> [rev:6^27 · rev:6^2]
//│ [init2:9^34 · init2:9^25] --> [init2:9^34]
//│ [init:8^30 · init:8^22 · init:8^22] --> [init:8^30 · init:8^22]
//│ <<<<<<< splitted knots <<<<<<<
//│ 
//│ >>>>>>> expansion >>>>>>>
//│ [init2:9^34]
//│ 	[init2:9^34 · init2:9^25] ---> [init2:9^34] (only one)
//│ [init:8^30]
//│ 	[init:8^30 · init:8^22]
//│ 		[init:8^30 · init:8^22 · init:8^22] ---> [init:8^30 · init:8^22] (only one)
//│ [rev2:7^28]
//│ 	[rev2:7^28 · rev2:7^12] ---> [rev2:7^28] (only one)
//│ [rev:6^27]
//│ 	[rev:6^27 · rev:6^2]
//│ 		[rev:6^27 · rev:6^2 · rev:6^2] ---> [rev:6^27 · rev:6^2] (only one)
//│ <<<<<<< expansion <<<<<<<
//│ 
//│ >>>>>>> expanded program >>>>>>>
//│ (((([rev:6^27]:19^75 [rev2:7^28]:18^76) [init:8^30]:22^78) 1) [init2:9^34]:21^82)
//│ def [init2:9^34]:21 = [C 0 [init2:9^34]:21^53]
//│ def [init:8^30 · init:8^22]:23 = [C 0 [init:8^30 · init:8^22]:23^40]
//│ def [init:8^30]:22 = [C 0 [init:8^30 · init:8^22]:23^37]
//│ def [rev2:7^28]:18 = (fun a2:30 -> (fun ys2:31 -> case ys2:31^42 of {
//│ 	C h12:32 t12:33 => (([rev2:7^28]:18^43 a2:30^44) t12:33^46)
//│ 	| N => a2:30^48}))
//│ def [rev:6^27 · rev:6^2]:20 = (fun a:34 -> (fun ys:35 -> case ys:35^55 of {
//│ 	C h1:36 t1:37 => (([rev:6^27 · rev:6^2]:20^56 a:34^57) t1:37^59)
//│ 	| N => a:34^61}))
//│ def [rev:6^27]:19 = (fun a:38 -> (fun ys:39 -> case ys:39^65 of {
//│ 	C h1:40 t1:41 => (([rev:6^27 · rev:6^2]:20^66 a:38^67) t1:41^69)
//│ 	| N => a:38^71}))
//│ def init:8 = [C 0 init:8^31]
//│ def init2:9 = [C 0 init2:9^34]
//│ def rev:6 = (fun a:10 -> (fun ys:11 -> case ys:11^10 of {
//│ 	C h1:12 t1:13 => ((rev:6^11 a:10^12) t1:13^14)
//│ 	| N => a:10^16}))
//│ def rev2:7 = (fun a2:14 -> (fun ys2:15 -> case ys2:15^20 of {
//│ 	C h12:16 t12:17 => ((rev2:7^21 a2:14^22) t12:17^24)
//│ 	| N => a2:14^26}))
//│ <<<<<<< expanded program <<<<<<<
//│ 
//│ >>>>>>> fusion matches >>>>>>>
//│ 38: [C 36: 0 37: [init:8^30 · init:8^22]:23^37]
//│ [C 0 [init:8^30 · init:8^22]:23^37] --->
//│ 	case ys:39^65 of {C h1:40 t1:41 => (([rev:6^27 · rev:6^2]:20^66 a:38^67) t1:41^69) | N => a:38^71}
//│ 41: [C 39: 0 40: [init:8^30 · init:8^22]:23^40]
//│ [C 0 [init:8^30 · init:8^22]:23^40] --->
//│ 	case ys:35^55 of {C h1:36 t1:37 => (([rev:6^27 · rev:6^2]:20^56 a:34^57) t1:37^59) | N => a:34^61}
//│ 54: [C 52: 0 53: [init2:9^34]:21^53]
//│ [C 0 [init2:9^34]:21^53] --->
//│ 	case ys2:31^42 of {C h12:32 t12:33 => (([rev2:7^28]:18^43 a2:30^44) t12:33^46) | N => a2:30^48}
//│ <<<<<<< fusion matches <<<<<<<
//│ 
//│ >>>>>>> after fusion >>>>>>>
//│ (((([rev:6^27]:19^84 [rev2:7^28]:18^85) [init:8^30]:22^87) 1) [init2:9^34]:21^91)
//│ def [init2:9^34]:21 = let h12:32 = 0
//│ in let t12:33 = [init2:9^34]:21^124
//│ in (([rev2:7^28]:18^119 a2:30^120) t12:33^122)
//│ def [init:8^30 · init:8^22]:23 = let h1:36 = 0
//│ in let t1:37 = [init:8^30 · init:8^22]:23^148
//│ in (([rev:6^27 · rev:6^2]:20^143 a:34^144) t1:37^146)
//│ def [init:8^30]:22 = let h1:40 = 0
//│ in let t1:41 = [init:8^30 · init:8^22]:23^133
//│ in (([rev:6^27 · rev:6^2]:20^128 a:38^129) t1:41^131)
//│ def [rev2:7^28]:18 = (fun a2:30 -> (fun ys2:31 -> ys2:31^140))
//│ def [rev:6^27 · rev:6^2]:20 = (fun a:34 -> (fun ys:35 -> ys:35^137))
//│ def [rev:6^27]:19 = (fun a:38 -> (fun ys:39 -> ys:39^106))
//│ def init:8 = [C 0 init:8^104]
//│ def init2:9 = [C 0 init2:9^153]
//│ def rev:6 = (fun a:10 -> (fun ys:11 -> case ys:11^109 of {
//│ 	C h1:12 t1:13 => ((rev:6^110 a:10^111) t1:13^113)
//│ 	| N => a:10^115}))
//│ def rev2:7 = (fun a2:14 -> (fun ys2:15 -> case ys2:15^93 of {
//│ 	C h12:16 t12:17 => ((rev2:7^94 a2:14^95) t12:17^97)
//│ 	| N => a2:14^99}))
//│ <<<<<<< after fusion <<<<<<<
