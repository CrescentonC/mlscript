:NewParser
:ParseOnly

:ns
// the `p · p` is never touched (checked) by the typer, so no path leads to it, and no recusive map from it
let p = C(p)
fun c(x) = if C(x) is
    C(a) then c(a)
c(p)
//│ |#let| |p| |#=| |C|(|p|)|↵|#fun| |c|(|x|)| |#=| |#if| |C|(|x|)| |is|→|C|(|a|)| |#then| |c|(|a|)|←|↵|c|(|p|)|
//│ Parsed: {let p = C (p,); fun c = x, => if C (x,) is ‹(C (a,)) then c (a,)›; c (p,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def p:6 = 2: [C 1: p:6]
//│ def c:7 = 9: (fun x:8 -> 8: case 4: [C 3: x:8] of {C a:9 -> 7: (5: c:7 6: a:9)})
//│ 12: (10: c:7 11: p:6)
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ C((p:6^1 ⋅ ɛ, 0'p)) <: 2'x
//│ 	[p:6^11 ⋅ ɛ] <: [c:7^10 ⋅ c:7^5 ⋅ ɛ]
//│ 	[p:6^11 ⋅ ɛ] <: [c:7^10 ⋅ ɛ]
//│ ------- defInstance -------
//│ ɛ ==> ɛ:
//│ 	4: [C x:8]  <-->  8: case [C x:8] of {C a:9 -> (c:7 a:9)}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ def p:6 = [C p:6]
//│ def c:7 = (fun x:8 -> case [C x:8] of {C a:9 -> (c:7 a:9)})
//│ def p'6'11_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:17 = [C p'6'11_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:18]
//│ def p'6'11_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:23 = "RECURSE_TOO_LONG"
//│ def p'6'11_p'6'1_p'6'1_p'6'1:15 = [C p'6'11_p'6'1_p'6'1_p'6'1_p'6'1:16]
//│ def p'6'11_p'6'1_p'6'1_p'6'1_p'6'1:16 = [C p'6'11_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:17]
//│ def c'7'10:10 = (fun x:8 -> 
//│ 	let a:9 = x:8 in (c'7'10_c'7'5:11 a:9))
//│ def p'6'11_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:20 = [C p'6'11_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:21]
//│ def p'6'11_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:22 = [C p'6'11_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:23]
//│ def p'6'11_p'6'1:13 = [C p'6'11_p'6'1_p'6'1:14]
//│ def p'6'11:12 = [C p'6'11_p'6'1:13]
//│ def p'6'11_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:21 = [C p'6'11_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:22]
//│ def p'6'11_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:18 = [C p'6'11_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:19]
//│ def c'7'10_c'7'5:11 = (fun x:8 -> 
//│ 	let a:9 = x:8 in (c'7'10_c'7'5:11 a:9))
//│ def p'6'11_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:19 = [C p'6'11_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:20]
//│ def p'6'11_p'6'1_p'6'1:14 = [C p'6'11_p'6'1_p'6'1_p'6'1:15]
//│ (c'7'10:10 p'6'11:12)
//│ <<<<<<<<<< Rewritten <<<<<<<<<<

// the `p · p` is never touched (checked) by the typer, so no path leads to it, and no recusive map from it
:ns
let rec p = C(p)
fun c(x) = if x is
    C(a) then a
fun main(y) = c(p)
main(0)
//│ |#let| |#rec| |p| |#=| |C|(|p|)|↵|#fun| |c|(|x|)| |#=| |#if| |x| |is|→|C|(|a|)| |#then| |a|←|↵|#fun| |main|(|y|)| |#=| |c|(|p|)|↵|main|(|0|)|
//│ Parsed: {let rec p = C (p,); fun c = x, => if x is ‹(C (a,)) then a›; fun main = y, => c (p,); main (0,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def p:6 = 2: [C 1: p:6]
//│ def c:7 = 6: (fun x:9 -> 5: case 3: x:9 of {C a:10 -> 4: a:10})
//│ def main:8 = 10: (fun y:11 -> 9: (7: c:7 8: p:6))
//│ 13: (11: main:8 12: 0)
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ ------- defInstance -------
//│ p:6^8 ⋅ ɛ ==> c:7^7 ⋅ ɛ:
//│ 	2: [C p:6]  <-->  5: case x:9 of {C a:10 -> a:10}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ def p:6 = [C p:6]
//│ def c:7 = (fun x:9 -> case x:9 of {C a:10 -> a:10})
//│ def main:8 = (fun y:11 -> (c:7 p:6))
//│ def main'8'11_p'6'8_p'6'1_p'6'1:16 = [C main'8'11_p'6'8_p'6'1_p'6'1_p'6'1:17]
//│ def main'8'11_p'6'8_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:20 = [C main'8'11_p'6'8_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:21]
//│ def main'8'11_p'6'8:14 = 
//│ 	let a:10 = main'8'11_p'6'8_p'6'1:15 in a:10
//│ def main'8'11_p'6'8_p'6'1_p'6'1_p'6'1:17 = [C main'8'11_p'6'8_p'6'1_p'6'1_p'6'1_p'6'1:18]
//│ def main'8'11_p'6'8_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:25 = "RECURSE_TOO_LONG"
//│ def main'8'11_p'6'8_p'6'1:15 = [C main'8'11_p'6'8_p'6'1_p'6'1:16]
//│ def main'8'11_p'6'8_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:24 = [C main'8'11_p'6'8_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:25]
//│ def main'8'11_p'6'8_p'6'1_p'6'1_p'6'1_p'6'1:18 = [C main'8'11_p'6'8_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:19]
//│ def main'8'11_p'6'8_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:22 = [C main'8'11_p'6'8_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:23]
//│ def main'8'11_p'6'8_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:19 = [C main'8'11_p'6'8_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:20]
//│ def main'8'11_c'7'7:13 = (fun x:9 -> x:9)
//│ def main'8'11_p'6'8_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:21 = [C main'8'11_p'6'8_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:22]
//│ def main'8'11_p'6'8_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:23 = [C main'8'11_p'6'8_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:24]
//│ def main'8'11:12 = (fun y:11 -> (main'8'11_c'7'7:13 main'8'11_p'6'8:14))
//│ (main'8'11:12 0)
//│ <<<<<<<<<< Rewritten <<<<<<<<<<



// NOTE: push in problem
:ns
fun map(f, ls) = if ls is
    C(h, t) then C(f(h), map(f, t))
    N then N
let l = C(K, l)
fun ff(x) = if x is
    K then T
map(ff, l)
//│ |#fun| |map|(|f|,| |ls|)| |#=| |#if| |ls| |is|→|C|(|h|,| |t|)| |#then| |C|(|f|(|h|)|,| |map|(|f|,| |t|)|)|↵|N| |#then| |N|←|↵|#let| |l| |#=| |C|(|K|,| |l|)|↵|#fun| |ff|(|x|)| |#=| |#if| |x| |is|→|K| |#then| |T|←|↵|map|(|ff|,| |l|)|
//│ Parsed: {fun map = f, ls, => if ls is ‹(C (h, t,)) then C (f (h,), map (f, t,),); (N) then N›; let l = C (K, l,); fun ff = x, => if x is ‹(K) then T›; map (ff, l,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def map:6 = 14: (fun f:9 -> 13: (fun ls:10 -> 12: case 1: ls:10 of {C h:11 t:12 -> 10: [C 4: (2: f:9 3: h:11) 9: (7: (5: map:6 6: f:9) 8: t:12)] | N -> 11: [N]}))
//│ def l:7 = 17: [C 15: [K] 16: l:7]
//│ def ff:8 = 21: (fun x:13 -> 20: case 18: x:13 of {K -> 19: [T]})
//│ 26: (24: (22: map:6 23: ff:8) 25: l:7)
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ C((ɛ, K), (l:7^16 ⋅ ɛ, 1'l)) <: 4'ls
//│ 	[l:7^25 ⋅ l:7^16 ⋅ l:7^16 ⋅ ɛ] <: [map:6^22 ⋅ map:6^5 ⋅ map:6^5 ⋅ ɛ]
//│ 	[l:7^25 ⋅ l:7^16 ⋅ ɛ] <: [map:6^22 ⋅ map:6^5 ⋅ ɛ]
//│ (ɛ, 11'x) => ((ɛ, 12'20_matchres)) <: 3'f
//│ 	[ff:8^23 ⋅ ɛ] <: [map:6^22 ⋅ map:6^5 ⋅ map:6^5 ⋅ ɛ]
//│ 	[ff:8^23 ⋅ ɛ] <: [map:6^22 ⋅ map:6^5 ⋅ ɛ]
//│ ------- defInstance -------
//│ l:7^25 ⋅ l:7^16 ⋅ ɛ ==> map:6^22 ⋅ map:6^5 ⋅ ɛ:
//│ 	17: [C [K] l:7]  <-->  12: case ls:10 of {C h:11 t:12 -> [C (f:9 h:11) ((map:6 f:9) t:12)] | N -> [N]}
//│ map:6^22 ⋅ map:6^5 ⋅ l:7^25 ⋅ ɛ ==> map:6^22 ⋅ ff:8^23 ⋅ ɛ:
//│ 	15: [K]  <-->  20: case x:13 of {K -> [T]}
//│ l:7^25 ⋅ l:7^16 ⋅ ɛ ==> ff:8^23 ⋅ ɛ:
//│ 	15: [K]  <-->  20: case x:13 of {K -> [T]}
//│ map:6^22 ⋅ l:7^25 ⋅ l:7^16 ⋅ ɛ ==> map:6^22 ⋅ map:6^5 ⋅ ff:8^23 ⋅ ɛ:
//│ 	15: [K]  <-->  20: case x:13 of {K -> [T]}
//│ l:7^25 ⋅ ɛ ==> ff:8^23 ⋅ ɛ:
//│ 	15: [K]  <-->  20: case x:13 of {K -> [T]}
//│ l:7^25 ⋅ ɛ ==> map:6^22 ⋅ ɛ:
//│ 	17: [C [K] l:7]  <-->  12: case ls:10 of {C h:11 t:12 -> [C (f:9 h:11) ((map:6 f:9) t:12)] | N -> [N]}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ def map:6 = (fun f:9 -> (fun ls:10 -> case ls:10 of {C h:11 t:12 -> [C (f:9 h:11) ((map:6 f:9) t:12)] | N -> [N]}))
//│ def l:7 = [C [K] l:7]
//│ def ff:8 = (fun x:13 -> case x:13 of {K -> [T]})
//│ def l'7'25_l'7'16:18 = 
//│ 	let h:11 = [T] in 
//│ 	let t:12 = l'7'25_l'7'16:18 in [C (f:9 h:11) ((map'6'22_map'6'5:17 f:9) t:12)]
//│ def ff'8'23:15 = (fun x:13 -> x:13)
//│ def l'7'25:16 = 
//│ 	let h:11 = [T] in 
//│ 	let t:12 = l'7'25_l'7'16:18 in [C (f:9 h:11) ((map'6'22_map'6'5:17 f:9) t:12)]
//│ def map'6'22_map'6'5:17 = (fun f:9 -> (fun ls:10 -> ls:10))
//│ def map'6'22:14 = (fun f:9 -> (fun ls:10 -> ls:10))
//│ ((map'6'22:14 ff'8'23:15) l'7'25:16)
//│ <<<<<<<<<< Rewritten <<<<<<<<<<

// NOTE: only first head is handled
:ns
_LUMBERHACK_ERROR
fun map(f, ls) = if ls is
    C(h, t) then C(f(h), map(f, t))
    N then N
fun ff(x) = if x is
    K then T
    KK then TT
    KKKK then TTTT
let l = C(K, C(KK, C(KKKK, N)))
map(ff, l)
//│ |_LUMBERHACK_ERROR|↵|#fun| |map|(|f|,| |ls|)| |#=| |#if| |ls| |is|→|C|(|h|,| |t|)| |#then| |C|(|f|(|h|)|,| |map|(|f|,| |t|)|)|↵|N| |#then| |N|←|↵|#fun| |ff|(|x|)| |#=| |#if| |x| |is|→|K| |#then| |T|↵|KK| |#then| |TT|↵|KKKK| |#then| |TTTT|←|↵|#let| |l| |#=| |C|(|K|,| |C|(|KK|,| |C|(|KKKK|,| |N|)|)|)|↵|map|(|ff|,| |l|)|
//│ Parsed: {_LUMBERHACK_ERROR; fun map = f, ls, => if ls is ‹(C (h, t,)) then C (f (h,), map (f, t,),); (N) then N›; fun ff = x, => if x is ‹(K) then T; (KK) then TT; (KKKK) then TTTT›; let l = C (K, C (KK, C (KKKK, N,),),); map (ff, l,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def map:6 = 14: (fun f:9 -> 13: (fun ls:10 -> 12: case 1: ls:10 of {C h:11 t:12 -> 10: [C 4: (2: f:9 3: h:11) 9: (7: (5: map:6 6: f:9) 8: t:12)] | N -> 11: [N]}))
//│ def ff:7 = 20: (fun x:13 -> 19: case 15: x:13 of {K -> 16: [T] | KK -> 17: [TT] | KKKK -> 18: [TTTT]})
//│ def l:8 = 27: [C 21: [K] 26: [C 22: [KK] 25: [C 23: [KKKK] 24: [N]]]]
//│ 32: (30: (28: map:6 29: ff:7) 31: l:8)
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ (ɛ, 11'x) => ((ɛ, 12'19_matchres)) <: 3'f
//│ 	[ff:7^29 ⋅ ɛ] <: [map:6^28 ⋅ map:6^5 ⋅ map:6^5 ⋅ ɛ]
//│ 	[ff:7^29 ⋅ ɛ] <: [map:6^28 ⋅ map:6^5 ⋅ ɛ]
//│ ------- defInstance -------
//│ map:6^28 ⋅ l:8^31 ⋅ ɛ ==> map:6^28 ⋅ map:6^5 ⋅ ff:7^29 ⋅ ɛ:
//│ 	22: [KK]  <-->  19: case x:13 of {K -> [T] | KK -> [TT] | KKKK -> [TTTT]}
//│ 	23: [KKKK]  <-->  19: case x:13 of {K -> [T] | KK -> [TT] | KKKK -> [TTTT]}
//│ l:8^31 ⋅ ɛ ==> map:6^28 ⋅ ɛ:
//│ 	27: [C [K] [C [KK] [C [KKKK] [N]]]]  <-->  12: case ls:10 of {C h:11 t:12 -> [C (f:9 h:11) ((map:6 f:9) t:12)] | N -> [N]}
//│ l:8^31 ⋅ ɛ ==> map:6^28 ⋅ map:6^5 ⋅ map:6^5 ⋅ ɛ:
//│ 	25: [C [KKKK] [N]]  <-->  12: case ls:10 of {C h:11 t:12 -> [C (f:9 h:11) ((map:6 f:9) t:12)] | N -> [N]}
//│ l:8^31 ⋅ ɛ ==> ff:7^29 ⋅ ɛ:
//│ 	21: [K]  <-->  19: case x:13 of {K -> [T] | KK -> [TT] | KKKK -> [TTTT]}
//│ 	22: [KK]  <-->  19: case x:13 of {K -> [T] | KK -> [TT] | KKKK -> [TTTT]}
//│ map:6^28 ⋅ l:8^31 ⋅ ɛ ==> map:6^28 ⋅ map:6^5 ⋅ map:6^5 ⋅ ff:7^29 ⋅ ɛ:
//│ 	23: [KKKK]  <-->  19: case x:13 of {K -> [T] | KK -> [TT] | KKKK -> [TTTT]}
//│ l:8^31 ⋅ ɛ ==> map:6^28 ⋅ map:6^5 ⋅ map:6^5 ⋅ map:6^5 ⋅ ɛ:
//│ 	24: [N]  <-->  12: case ls:10 of {C h:11 t:12 -> [C (f:9 h:11) ((map:6 f:9) t:12)] | N -> [N]}
//│ map:6^28 ⋅ map:6^5 ⋅ l:8^31 ⋅ ɛ ==> map:6^28 ⋅ ff:7^29 ⋅ ɛ:
//│ 	21: [K]  <-->  19: case x:13 of {K -> [T] | KK -> [TT] | KKKK -> [TTTT]}
//│ l:8^31 ⋅ ɛ ==> map:6^28 ⋅ map:6^5 ⋅ ɛ:
//│ 	26: [C [KK] [C [KKKK] [N]]]  <-->  12: case ls:10 of {C h:11 t:12 -> [C (f:9 h:11) ((map:6 f:9) t:12)] | N -> [N]}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ !!!!!!ERROR!!!!!!
//│ java.lang.Exception: Internal Error: 
//│ map:6^28 ⋅ l:8^31 ⋅ ɛ to `[KKKK]` 
//│ 	already has map:6^28 ⋅ map:6^5 ⋅ map:6^5 ⋅ ff:7^29 ⋅ ɛ to `case x:13 of {K -> [T] | KK -> [TT] | KKKK -> [TTTT]}` 
//│ 	but here comes another match map:6^28 ⋅ map:6^5 ⋅ ff:7^29 ⋅ ɛ to `case x:13 of {K -> [T] | KK -> [TT] | KKKK -> [TTTT]}`
//│ !!!!!!ERROR!!!!!!

:ns
_LUMBERHACK_ERROR
fun rev(l1, l2) = if l1 is
    C(h, t) then rev(t, C(h, l2))
    N then l2
fun rev1(l11, l22) = if l11 is
    C(h1, t1) then rev1(t1, C(h1, l22))
    N then l22
let p = C(K, N)
rev(rev1(p, N), N)
//│ |_LUMBERHACK_ERROR|↵|#fun| |rev|(|l1|,| |l2|)| |#=| |#if| |l1| |is|→|C|(|h|,| |t|)| |#then| |rev|(|t|,| |C|(|h|,| |l2|)|)|↵|N| |#then| |l2|←|↵|#fun| |rev1|(|l11|,| |l22|)| |#=| |#if| |l11| |is|→|C|(|h1|,| |t1|)| |#then| |rev1|(|t1|,| |C|(|h1|,| |l22|)|)|↵|N| |#then| |l22|←|↵|#let| |p| |#=| |C|(|K|,| |N|)|↵|rev|(|rev1|(|p|,| |N|)|,| |N|)|
//│ Parsed: {_LUMBERHACK_ERROR; fun rev = l1, l2, => if l1 is ‹(C (h, t,)) then rev (t, C (h, l2,),); (N) then l2›; fun rev1 = l11, l22, => if l11 is ‹(C (h1, t1,)) then rev1 (t1, C (h1, l22,),); (N) then l22›; let p = C (K, N,); rev (rev1 (p, N,), N,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def rev:6 = 12: (fun l1:9 -> 11: (fun l2:10 -> 10: case 1: l1:9 of {C h:11 t:12 -> 8: (4: (2: rev:6 3: t:12) 7: [C 5: h:11 6: l2:10]) | N -> 9: l2:10}))
//│ def rev1:7 = 24: (fun l11:13 -> 23: (fun l22:14 -> 22: case 13: l11:13 of {C h1:15 t1:16 -> 20: (16: (14: rev1:7 15: t1:16) 19: [C 17: h1:15 18: l22:14]) | N -> 21: l22:14}))
//│ def p:8 = 27: [C 25: [K] 26: [N]]
//│ 36: (34: (28: rev:6 33: (31: (29: rev1:7 30: p:8) 32: [N])) 35: [N])
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ N <: 15'20_callres
//│ 	[rev1:7^14 ⋅ rev1:7^14 ⋅ ɛ] <: [rev1:7^29 ⋅ ɛ]
//│ 	[rev1:7^14 ⋅ ɛ] <: [rev1:7^29 ⋅ ɛ]
//│ C((ɛ, 12'h1), (ɛ, 11'l22)) <: 3'l1
//│ 	[rev1:7^29 ⋅ ɛ] <: [rev1:7^14 ⋅ rev1:7^14 ⋅ rev:6^28 ⋅ rev:6^2 ⋅ rev:6^2 ⋅ ɛ]
//│ 	[rev1:7^29 ⋅ ɛ] <: [rev1:7^14 ⋅ rev1:7^14 ⋅ rev:6^28 ⋅ rev:6^2 ⋅ ɛ]
//│ C((ɛ, 12'h1), (ɛ, 11'l22)) <: 15'20_callres
//│ 	[rev1:7^14 ⋅ ɛ] <: [ɛ]
//│ 	[ɛ] <: [ɛ]
//│ N <: 8'8_callres
//│ 	[rev:6^2 ⋅ rev:6^2 ⋅ ɛ] <: [rev:6^28 ⋅ ɛ]
//│ 	[rev:6^2 ⋅ ɛ] <: [rev:6^28 ⋅ ɛ]
//│ C((ɛ, 5'h), (ɛ, 4'l2)) <: 8'8_callres
//│ 	[rev:6^2 ⋅ ɛ] <: [ɛ]
//│ 	[ɛ] <: [ɛ]
//│ ------- defInstance -------
//│ rev1:7^29 ⋅ ɛ ==> rev1:7^14 ⋅ rev:6^28 ⋅ rev:6^2 ⋅ ɛ:
//│ 	19: [C h1:15 l22:14]  <-->  10: case l1:9 of {C h:11 t:12 -> ((rev:6 t:12) [C h:11 l2:10]) | N -> l2:10}
//│ rev1:7^14 ⋅ ɛ ==> rev:6^28 ⋅ ɛ:
//│ 	32: [N]  <-->  10: case l1:9 of {C h:11 t:12 -> ((rev:6 t:12) [C h:11 l2:10]) | N -> l2:10}
//│ rev1:7^29 ⋅ ɛ ==> rev1:7^14 ⋅ rev1:7^14 ⋅ rev:6^28 ⋅ rev:6^2 ⋅ ɛ:
//│ 	19: [C h1:15 l22:14]  <-->  10: case l1:9 of {C h:11 t:12 -> ((rev:6 t:12) [C h:11 l2:10]) | N -> l2:10}
//│ p:8^30 ⋅ ɛ ==> rev1:7^29 ⋅ rev1:7^14 ⋅ ɛ:
//│ 	26: [N]  <-->  22: case l11:13 of {C h1:15 t1:16 -> ((rev1:7 t1:16) [C h1:15 l22:14]) | N -> l22:14}
//│ ɛ ==> rev1:7^14 ⋅ rev:6^28 ⋅ rev:6^2 ⋅ ɛ:
//│ 	32: [N]  <-->  10: case l1:9 of {C h:11 t:12 -> ((rev:6 t:12) [C h:11 l2:10]) | N -> l2:10}
//│ rev1:7^29 ⋅ ɛ ==> rev:6^28 ⋅ ɛ:
//│ 	19: [C h1:15 l22:14]  <-->  10: case l1:9 of {C h:11 t:12 -> ((rev:6 t:12) [C h:11 l2:10]) | N -> l2:10}
//│ ɛ ==> rev:6^28 ⋅ rev:6^2 ⋅ ɛ:
//│ 	32: [N]  <-->  10: case l1:9 of {C h:11 t:12 -> ((rev:6 t:12) [C h:11 l2:10]) | N -> l2:10}
//│ rev1:7^29 ⋅ ɛ ==> rev1:7^14 ⋅ rev:6^28 ⋅ ɛ:
//│ 	19: [C h1:15 l22:14]  <-->  10: case l1:9 of {C h:11 t:12 -> ((rev:6 t:12) [C h:11 l2:10]) | N -> l2:10}
//│ ɛ ==> rev:6^28 ⋅ ɛ:
//│ 	32: [N]  <-->  10: case l1:9 of {C h:11 t:12 -> ((rev:6 t:12) [C h:11 l2:10]) | N -> l2:10}
//│ p:8^30 ⋅ ɛ ==> rev1:7^29 ⋅ ɛ:
//│ 	27: [C [K] [N]]  <-->  22: case l11:13 of {C h1:15 t1:16 -> ((rev1:7 t1:16) [C h1:15 l22:14]) | N -> l22:14}
//│ ɛ ==> rev1:7^14 ⋅ rev1:7^14 ⋅ rev:6^28 ⋅ rev:6^2 ⋅ rev:6^2 ⋅ ɛ:
//│ 	32: [N]  <-->  10: case l1:9 of {C h:11 t:12 -> ((rev:6 t:12) [C h:11 l2:10]) | N -> l2:10}
//│ ɛ ==> rev1:7^14 ⋅ rev:6^28 ⋅ rev:6^2 ⋅ rev:6^2 ⋅ ɛ:
//│ 	32: [N]  <-->  10: case l1:9 of {C h:11 t:12 -> ((rev:6 t:12) [C h:11 l2:10]) | N -> l2:10}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ !!!!!!ERROR!!!!!!
//│ java.lang.Exception: Internal Error: 
//│ rev1:7^29 ⋅ ɛ to `[C h1:15 l22:14]` 
//│ 	already has rev1:7^14 ⋅ rev1:7^14 ⋅ rev:6^28 ⋅ rev:6^2 ⋅ ɛ to `case l1:9 of {C h:11 t:12 -> ((rev:6 t:12) [C h:11 l2:10]) | N -> l2:10}` 
//│ 	but here comes another match rev:6^28 ⋅ ɛ to `case l1:9 of {C h:11 t:12 -> ((rev:6 t:12) [C h:11 l2:10]) | N -> l2:10}`
//│ !!!!!!ERROR!!!!!!


// `id2` used twice
:ns
let p = C(C(C(id2(p))))
fun c(x) = if x is
    C(a) then if a is
        C(a) then c(a)
fun id2(yy) = yy
fun id(y) = id2(y)
c(id(p))
//│ |#let| |p| |#=| |C|(|C|(|C|(|id2|(|p|)|)|)|)|↵|#fun| |c|(|x|)| |#=| |#if| |x| |is|→|C|(|a|)| |#then| |#if| |a| |is|→|C|(|a|)| |#then| |c|(|a|)|←|←|↵|#fun| |id2|(|yy|)| |#=| |yy|↵|#fun| |id|(|y|)| |#=| |id2|(|y|)|↵|c|(|id|(|p|)|)|
//│ Parsed: {let p = C (C (C (id2 (p,),),),); fun c = x, => if x is ‹(C (a,)) then if a is ‹(C (a,)) then c (a,)››; fun id2 = yy, => yy; fun id = y, => id2 (y,); c (id (p,),)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def p:6 = 6: [C 5: [C 4: [C 3: (1: id2:8 2: p:6)]]]
//│ def c:7 = 14: (fun x:10 -> 13: case 7: x:10 of {C a:11 -> 12: case 8: a:11 of {C a:12 -> 11: (9: c:7 10: a:12)}})
//│ def id2:8 = 16: (fun yy:13 -> 15: yy:13)
//│ def id:9 = 20: (fun y:14 -> 19: (17: id2:8 18: y:14))
//│ 25: (21: c:7 24: (22: id:9 23: p:6))
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ C((ɛ, C((ɛ, C((ɛ, 4'3_callres)))))) <: 7'a
//│ 	[p:6^23 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ] <: [id:9^22 ⋅ id2:8^17 ⋅ id:9^22 ⋅ id2:8^17 ⋅ id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ]
//│ 	[id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ] <: [id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ]
//│ C((ɛ, C((ɛ, C((ɛ, 4'3_callres)))))) <: 6'a
//│ 	[id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ p:6^2 ⋅ p:6^2 ⋅ ɛ] <: [id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ]
//│ 	[p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ] <: [id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ ɛ]
//│ ------- defInstance -------
//│ p:6^23 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	5: [C [C (id2:8 p:6)]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ ɛ:
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ p:6^23 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	5: [C [C (id2:8 p:6)]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ p:6^23 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ p:6^2 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	5: [C [C (id2:8 p:6)]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	5: [C [C (id2:8 p:6)]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ p:6^2 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ p:6^2 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	5: [C [C (id2:8 p:6)]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	5: [C [C (id2:8 p:6)]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ ɛ ==> id2:8^1 ⋅ c:7^21 ⋅ ɛ:
//│ 	5: [C [C (id2:8 p:6)]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	5: [C [C (id2:8 p:6)]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ p:6^23 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ p:6^2 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	5: [C [C (id2:8 p:6)]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ p:6^2 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ ɛ ==> id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ ɛ:
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ p:6^23 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ p:6^2 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ p:6^23 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ p:6^23 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	5: [C [C (id2:8 p:6)]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ p:6^2 ⋅ ɛ ==> id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ p:6^2 ⋅ ɛ ==> id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	5: [C [C (id2:8 p:6)]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	5: [C [C (id2:8 p:6)]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ p:6^2 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	5: [C [C (id2:8 p:6)]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	5: [C [C (id2:8 p:6)]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	5: [C [C (id2:8 p:6)]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ p:6^23 ⋅ ɛ ==> c:7^21 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ ɛ ==> id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ p:6^23 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	5: [C [C (id2:8 p:6)]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ p:6^23 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ ɛ:
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ p:6^23 ⋅ p:6^2 ⋅ p:6^2 ⋅ ɛ ==> c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ p:6^2 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	5: [C [C (id2:8 p:6)]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ p:6^23 ⋅ ɛ ==> c:7^21 ⋅ ɛ:
//│ 	5: [C [C (id2:8 p:6)]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ p:6^23 ⋅ p:6^2 ⋅ p:6^2 ⋅ ɛ ==> c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	5: [C [C (id2:8 p:6)]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ p:6^2 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ p:6^23 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ p:6^2 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	5: [C [C (id2:8 p:6)]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ p:6^23 ⋅ p:6^2 ⋅ ɛ ==> c:7^21 ⋅ c:7^9 ⋅ ɛ:
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ p:6^23 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ p:6^23 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ p:6^2 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	5: [C [C (id2:8 p:6)]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ ɛ ==> id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	5: [C [C (id2:8 p:6)]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ p:6^2 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id:9^22 ⋅ id2:8^17 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	5: [C [C (id2:8 p:6)]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	6: [C [C [C (id2:8 p:6)]]]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ p:6^23 ⋅ p:6^2 ⋅ ɛ ==> c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  12: case a:11 of {C a:12 -> (c:7 a:12)}
//│ 	5: [C [C (id2:8 p:6)]]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ id:9^22 ⋅ id2:8^17 ⋅ p:6^2 ⋅ p:6^2 ⋅ id2:8^1 ⋅ p:6^23 ⋅ ɛ ==> id:9^22 ⋅ id2:8^17 ⋅ id2:8^1 ⋅ c:7^21 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id2:8 p:6)]  <-->  13: case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ def p:6 = [C [C [C (id2:8 p:6)]]]
//│ def c:7 = (fun x:10 -> case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c:7 a:12)}})
//│ def id2:8 = (fun yy:13 -> yy:13)
//│ def id:9 = (fun y:14 -> (id2:8 y:14))
//│ def c'7'21_c'7'9_c'7'9_c'7'9:23 = (fun x:10 -> x:10)
//│ def c'7'21_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:26 = (fun x:10 -> case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c'7'21_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:27 a:12)}})
//│ def c'7'21_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:29 = (fun x:10 -> case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c'7'21_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:30 a:12)}})
//│ def c'7'21_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:31 = (fun x:10 -> case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c'7'21_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:32 a:12)}})
//│ def id'9'22:16 = (fun y:14 -> (id'9'22_id2'8'17:17 y:14))
//│ def c'7'21_c'7'9_c'7'9:22 = (fun x:10 -> x:10)
//│ def p'6'23_p'6'2_id2'8'1:24 = (fun yy:13 -> yy:13)
//│ def p'6'23_p'6'2:21 = 
//│ 	let a:12 = 
//│ 		let a:11 = 
//│ 			let a:12 = (p'6'23_p'6'2_id2'8'1:24 p'6'23_p'6'2_p'6'2:25) in (c'7'21_c'7'9_c'7'9_c'7'9:23 a:12) 
//│ 		in a:11 
//│ 	in (c'7'21_c'7'9_c'7'9:22 a:12)
//│ def c'7'21_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:28 = (fun x:10 -> case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c'7'21_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:29 a:12)}})
//│ def c'7'21:15 = (fun x:10 -> x:10)
//│ def c'7'21_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:27 = (fun x:10 -> case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c'7'21_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:28 a:12)}})
//│ def c'7'21_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:30 = (fun x:10 -> case x:10 of {C a:11 -> case a:11 of {C a:12 -> (c'7'21_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:31 a:12)}})
//│ def p'6'23_p'6'2_p'6'2:25 = 
//│ 	let a:11 = 
//│ 		let a:12 = 
//│ 			let a:11 = (p'6'23_p'6'2_p'6'2_id2'8'1:33 p'6'23_p'6'2:21) in case a:11 of {C a:12 -> (c'7'21_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:26 a:12)} 
//│ 		in (c'7'21_c'7'9:19 a:12) 
//│ 	in a:11
//│ def id'9'22_id2'8'17:17 = (fun yy:13 -> yy:13)
//│ def c'7'21_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:32 = "RECURSE_TOO_LONG"
//│ def p'6'23_p'6'2_p'6'2_id2'8'1:33 = (fun yy:13 -> yy:13)
//│ def p'6'23:18 = 
//│ 	let a:11 = 
//│ 		let a:12 = 
//│ 			let a:11 = (p'6'23_id2'8'1:20 p'6'23_p'6'2:21) in a:11 
//│ 		in (c'7'21_c'7'9:19 a:12) 
//│ 	in a:11
//│ def p'6'23_id2'8'1:20 = (fun yy:13 -> yy:13)
//│ def c'7'21_c'7'9:19 = (fun x:10 -> x:10)
//│ (c'7'21:15 (id'9'22:16 p'6'23:18))
//│ <<<<<<<<<< Rewritten <<<<<<<<<<


// no polymorphism
:ns
_LUMBERHACK_ERROR
fun id(x) = x
let rec p1 = C(p1)
fun c1(a) = if a is
    C(i) then c1(i)
id(c1)(id(p1))
//│ |_LUMBERHACK_ERROR|↵|#fun| |id|(|x|)| |#=| |x|↵|#let| |#rec| |p1| |#=| |C|(|p1|)|↵|#fun| |c1|(|a|)| |#=| |#if| |a| |is|→|C|(|i|)| |#then| |c1|(|i|)|←|↵|id|(|c1|)|(|id|(|p1|)|)|
//│ Parsed: {_LUMBERHACK_ERROR; fun id = x, => x; let rec p1 = C (p1,); fun c1 = a, => if a is ‹(C (i,)) then c1 (i,)›; id (c1,) (id (p1,),)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def id:6 = 2: (fun x:9 -> 1: x:9)
//│ def p1:7 = 4: [C 3: p1:7]
//│ def c1:8 = 10: (fun a:10 -> 9: case 5: a:10 of {C i:11 -> 8: (6: c1:8 7: i:11)})
//│ 17: (13: (11: id:6 12: c1:8) 16: (14: id:6 15: p1:7))
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ !!!!!!ERROR!!!!!!
//│ java.lang.Exception: type error
//│ !!!!!!ERROR!!!!!!

_LUMBERHACK_ERROR
fun map(ls) = if ls is
    C(hh, tt) then C(
        (if hh is
            A then B
            AA then BB
        ),
        map(tt)
    )
    N then N
fun rev(a, lss) = if lss is
    C(h, t) then rev(C(h, a), t)
    N then a
// map(rev(N, C(A, C(AA, N))))
map(rev(N, primitive))
//│ |_LUMBERHACK_ERROR|↵|#fun| |map|(|ls|)| |#=| |#if| |ls| |is|→|C|(|hh|,| |tt|)| |#then| |C|(|→|(|#if| |hh| |is|→|A| |#then| |B|↵|AA| |#then| |BB|←|↵|)|,|↵|map|(|tt|)|←|↵|)|↵|N| |#then| |N|←|↵|#fun| |rev|(|a|,| |lss|)| |#=| |#if| |lss| |is|→|C|(|h|,| |t|)| |#then| |rev|(|C|(|h|,| |a|)|,| |t|)|↵|N| |#then| |a|←|↵|/* map(rev(N, C(A, C(AA, N))))*/|↵|map|(|rev|(|N|,| |primitive|)|)|
//│ Parsed: {_LUMBERHACK_ERROR; fun map = ls, => if ls is ‹(C (hh, tt,)) then C ('(' if hh is ‹(A) then B; (AA) then BB›, ')', map (tt,),); (N) then N›; fun rev = a, lss, => if lss is ‹(C (h, t,)) then rev (C (h, a,), t,); (N) then a›; map (rev (N, primitive,),)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def map:6 = 12: (fun ls:8 -> 11: case 1: ls:8 of {C hh:9 tt:10 -> 9: [C 5: case 2: hh:9 of {A -> 3: [B] | AA -> 4: [BB]} 8: (6: map:6 7: tt:10)] | N -> 10: [N]})
//│ def rev:7 = 24: (fun a:11 -> 23: (fun lss:12 -> 22: case 13: lss:12 of {C h:13 t:14 -> 20: (18: (14: rev:7 17: [C 15: h:13 16: a:11]) 19: t:14) | N -> 21: a:11}))
//│ 31: (25: map:6 30: (28: (26: rev:7 27: [N]) 29: primitive:3))
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ N <: 13'20_callres
//│ 	[rev:7^14 ⋅ rev:7^14 ⋅ ɛ] <: [rev:7^26 ⋅ ɛ]
//│ 	[rev:7^14 ⋅ ɛ] <: [rev:7^26 ⋅ ɛ]
//│ C((ɛ, 10'h), (ɛ, 8'a)) <: 13'20_callres
//│ 	[rev:7^14 ⋅ ɛ] <: [ɛ]
//│ 	[ɛ] <: [ɛ]
//│ C((ɛ, 10'h), (ɛ, 8'a)) <: 2'ls
//│ 	[rev:7^26 ⋅ ɛ] <: [rev:7^14 ⋅ rev:7^14 ⋅ map:6^25 ⋅ map:6^6 ⋅ map:6^6 ⋅ ɛ]
//│ 	[rev:7^26 ⋅ ɛ] <: [rev:7^14 ⋅ rev:7^14 ⋅ map:6^25 ⋅ map:6^6 ⋅ ɛ]
//│ ------- defInstance -------
//│ rev:7^14 ⋅ ɛ ==> map:6^25 ⋅ ɛ:
//│ 	27: [N]  <-->  11: case ls:8 of {C hh:9 tt:10 -> [C case hh:9 of {A -> [B] | AA -> [BB]} (map:6 tt:10)] | N -> [N]}
//│ ɛ ==> rev:7^14 ⋅ map:6^25 ⋅ map:6^6 ⋅ map:6^6 ⋅ ɛ:
//│ 	27: [N]  <-->  11: case ls:8 of {C hh:9 tt:10 -> [C case hh:9 of {A -> [B] | AA -> [BB]} (map:6 tt:10)] | N -> [N]}
//│ rev:7^26 ⋅ ɛ ==> rev:7^14 ⋅ rev:7^14 ⋅ map:6^25 ⋅ map:6^6 ⋅ ɛ:
//│ 	17: [C h:13 a:11]  <-->  11: case ls:8 of {C hh:9 tt:10 -> [C case hh:9 of {A -> [B] | AA -> [BB]} (map:6 tt:10)] | N -> [N]}
//│ ɛ ==> rev:7^14 ⋅ map:6^25 ⋅ map:6^6 ⋅ ɛ:
//│ 	27: [N]  <-->  11: case ls:8 of {C hh:9 tt:10 -> [C case hh:9 of {A -> [B] | AA -> [BB]} (map:6 tt:10)] | N -> [N]}
//│ ɛ ==> rev:7^14 ⋅ rev:7^14 ⋅ map:6^25 ⋅ map:6^6 ⋅ map:6^6 ⋅ ɛ:
//│ 	27: [N]  <-->  11: case ls:8 of {C hh:9 tt:10 -> [C case hh:9 of {A -> [B] | AA -> [BB]} (map:6 tt:10)] | N -> [N]}
//│ rev:7^26 ⋅ ɛ ==> map:6^25 ⋅ ɛ:
//│ 	17: [C h:13 a:11]  <-->  11: case ls:8 of {C hh:9 tt:10 -> [C case hh:9 of {A -> [B] | AA -> [BB]} (map:6 tt:10)] | N -> [N]}
//│ ɛ ==> map:6^25 ⋅ map:6^6 ⋅ ɛ:
//│ 	27: [N]  <-->  11: case ls:8 of {C hh:9 tt:10 -> [C case hh:9 of {A -> [B] | AA -> [BB]} (map:6 tt:10)] | N -> [N]}
//│ rev:7^26 ⋅ ɛ ==> rev:7^14 ⋅ map:6^25 ⋅ map:6^6 ⋅ ɛ:
//│ 	17: [C h:13 a:11]  <-->  11: case ls:8 of {C hh:9 tt:10 -> [C case hh:9 of {A -> [B] | AA -> [BB]} (map:6 tt:10)] | N -> [N]}
//│ rev:7^26 ⋅ ɛ ==> rev:7^14 ⋅ map:6^25 ⋅ ɛ:
//│ 	17: [C h:13 a:11]  <-->  11: case ls:8 of {C hh:9 tt:10 -> [C case hh:9 of {A -> [B] | AA -> [BB]} (map:6 tt:10)] | N -> [N]}
//│ ɛ ==> map:6^25 ⋅ ɛ:
//│ 	27: [N]  <-->  11: case ls:8 of {C hh:9 tt:10 -> [C case hh:9 of {A -> [B] | AA -> [BB]} (map:6 tt:10)] | N -> [N]}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ !!!!!!ERROR!!!!!!
//│ java.lang.Exception: Internal Error: 
//│ ɛ to `[N]` 
//│ 	already has map:6^25 ⋅ map:6^6 ⋅ ɛ to `case ls:8 of {C hh:9 tt:10 -> [C case hh:9 of {A -> [B] | AA -> [BB]} (map:6 tt:10)] | N -> [N]}` 
//│ 	but here comes another match rev:7^14 ⋅ map:6^25 ⋅ map:6^6 ⋅ map:6^6 ⋅ ɛ to `case ls:8 of {C hh:9 tt:10 -> [C case hh:9 of {A -> [B] | AA -> [BB]} (map:6 tt:10)] | N -> [N]}`
//│ !!!!!!ERROR!!!!!!

:ns
_LUMBERHACK_ERROR
let p = Pair(A, B)
fun c(x) = if x is
    Pair(a, b) then c(Pair(b, a))
c(p)
//│ |_LUMBERHACK_ERROR|↵|#let| |p| |#=| |Pair|(|A|,| |B|)|↵|#fun| |c|(|x|)| |#=| |#if| |x| |is|→|Pair|(|a|,| |b|)| |#then| |c|(|Pair|(|b|,| |a|)|)|←|↵|c|(|p|)|
//│ Parsed: {_LUMBERHACK_ERROR; let p = Pair (A, B,); fun c = x, => if x is ‹(Pair (a, b,)) then c (Pair (b, a,),)›; c (p,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def p:6 = 3: [Pair 1: [A] 2: [B]]
//│ def c:7 = 11: (fun x:8 -> 10: case 4: x:8 of {Pair a:9 b:10 -> 9: (5: c:7 8: [Pair 6: b:10 7: a:9])})
//│ 14: (12: c:7 13: p:6)
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ B <: 4'b
//│ 	[p:6^13 ⋅ ɛ] <: [c:7^12 ⋅ c:7^5 ⋅ c:7^5 ⋅ ɛ]
//│ 	[p:6^13 ⋅ ɛ] <: [c:7^12 ⋅ ɛ]
//│ A <: 3'a
//│ 	[p:6^13 ⋅ ɛ] <: [c:7^12 ⋅ c:7^5 ⋅ c:7^5 ⋅ ɛ]
//│ 	[p:6^13 ⋅ ɛ] <: [c:7^12 ⋅ ɛ]
//│ ------- defInstance -------
//│ ɛ ==> c:7^5 ⋅ ɛ:
//│ 	8: [Pair b:10 a:9]  <-->  10: case x:8 of {Pair a:9 b:10 -> (c:7 [Pair b:10 a:9])}
//│ p:6^13 ⋅ ɛ ==> c:7^12 ⋅ ɛ:
//│ 	3: [Pair [A] [B]]  <-->  10: case x:8 of {Pair a:9 b:10 -> (c:7 [Pair b:10 a:9])}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ !!!!!!ERROR!!!!!!
//│ java.lang.StackOverflowError
//│ !!!!!!ERROR!!!!!!


// pushing in of auxiliary parameters
// FIXME: weird recursive
:ns
fun last(x, ys) = if ys is
    N then x
    C(h, t) then last(h, t)
fun lastDrive(xs) = if xs is
    N then None
    C(hh, tt) then Some(last(hh, tt))
lastDrive(C(1, C(2, N)))
//│ |#fun| |last|(|x|,| |ys|)| |#=| |#if| |ys| |is|→|N| |#then| |x|↵|C|(|h|,| |t|)| |#then| |last|(|h|,| |t|)|←|↵|#fun| |lastDrive|(|xs|)| |#=| |#if| |xs| |is|→|N| |#then| |None|↵|C|(|hh|,| |tt|)| |#then| |Some|(|last|(|hh|,| |tt|)|)|←|↵|lastDrive|(|C|(|1|,| |C|(|2|,| |N|)|)|)|
//│ Parsed: {fun last = x, ys, => if ys is ‹(N) then x; (C (h, t,)) then last (h, t,)›; fun lastDrive = xs, => if xs is ‹(N) then None; (C (hh, tt,)) then Some (last (hh, tt,),)›; lastDrive (C (1, C (2, N,),),)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def last:6 = 10: (fun x:8 -> 9: (fun ys:9 -> 8: case 1: ys:9 of {N -> 2: x:8 | C h:10 t:11 -> 7: (5: (3: last:6 4: h:10) 6: t:11)}))
//│ def lastDrive:7 = 20: (fun xs:12 -> 19: case 11: xs:12 of {N -> 12: [None] | C hh:13 tt:14 -> 18: [Some 17: (15: (13: last:6 14: hh:13) 16: tt:14)]})
//│ 27: (21: lastDrive:7 26: [C 22: 1 25: [C 23: 2 24: [N]]])
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ Int <: 7'7_callres
//│ 	[last:6^3 ⋅ ɛ] <: [lastDrive:7^21 ⋅ last:6^13 ⋅ ɛ]
//│ 	[last:6^3 ⋅ ɛ] <: [lastDrive:7^21 ⋅ last:6^13 ⋅ ɛ]
//│ ------- defInstance -------
//│ ɛ ==> lastDrive:7^21 ⋅ ɛ:
//│ 	26: [C 1 [C 2 [N]]]  <-->  19: case xs:12 of {N -> [None] | C hh:13 tt:14 -> [Some ((last:6 hh:13) tt:14)]}
//│ ɛ ==> lastDrive:7^21 ⋅ last:6^13 ⋅ ɛ:
//│ 	25: [C 2 [N]]  <-->  8: case ys:9 of {N -> x:8 | C h:10 t:11 -> ((last:6 h:10) t:11)}
//│ ɛ ==> lastDrive:7^21 ⋅ last:6^13 ⋅ last:6^3 ⋅ ɛ:
//│ 	24: [N]  <-->  8: case ys:9 of {N -> x:8 | C h:10 t:11 -> ((last:6 h:10) t:11)}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ def last:6 = (fun x:8 -> (fun ys:9 -> case ys:9 of {N -> x:8 | C h:10 t:11 -> ((last:6 h:10) t:11)}))
//│ def lastDrive:7 = (fun xs:12 -> case xs:12 of {N -> [None] | C hh:13 tt:14 -> [Some ((last:6 hh:13) tt:14)]})
//│ def lastDrive'7'21_last'6'13:16 = (fun x:8 -> (fun ys:9 -> ys:9))
//│ def lastDrive'7'21:15 = (fun xs:12 -> xs:12)
//│ def lastDrive'7'21_last'6'13_last'6'3:17 = (fun x:8 -> (fun ys:9 -> ys:9))
//│ (lastDrive'7'21:15 
//│ 	let hh:13 = 1 in 
//│ 	let tt:14 = 
//│ 		let h:10 = 2 in 
//│ 		let t:11 = x:8 in ((lastDrive'7'21_last'6'13_last'6'3:17 h:10) t:11) 
//│ 	in [Some ((lastDrive'7'21_last'6'13:16 hh:13) tt:14)])
//│ <<<<<<<<<< Rewritten <<<<<<<<<<

:ns
fun inter(xs, ys) = if xs is
    N then ys
    C(h, t) then C(h, inter(ys, t))
inter(C(1, C(2, C(3, N))), C(9, C(8, C(7, N))))
//│ |#fun| |inter|(|xs|,| |ys|)| |#=| |#if| |xs| |is|→|N| |#then| |ys|↵|C|(|h|,| |t|)| |#then| |C|(|h|,| |inter|(|ys|,| |t|)|)|←|↵|inter|(|C|(|1|,| |C|(|2|,| |C|(|3|,| |N|)|)|)|,| |C|(|9|,| |C|(|8|,| |C|(|7|,| |N|)|)|)|)|
//│ Parsed: {fun inter = xs, ys, => if xs is ‹(N) then ys; (C (h, t,)) then C (h, inter (ys, t,),)›; inter (C (1, C (2, C (3, N,),),), C (9, C (8, C (7, N,),),),)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def inter:6 = 12: (fun xs:7 -> 11: (fun ys:8 -> 10: case 1: xs:7 of {N -> 2: ys:8 | C h:9 t:10 -> 9: [C 3: h:9 8: (6: (4: inter:6 5: ys:8) 7: t:10)]}))
//│ 29: (21: (13: inter:6 20: [C 14: 1 19: [C 15: 2 18: [C 16: 3 17: [N]]]]) 28: [C 22: 9 27: [C 23: 8 26: [C 24: 7 25: [N]]]])
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ ------- defInstance -------
//│ ɛ ==> inter:6^13 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ ɛ:
//│ 	17: [N]  <-->  10: case xs:7 of {N -> ys:8 | C h:9 t:10 -> [C h:9 ((inter:6 ys:8) t:10)]}
//│ ɛ ==> inter:6^13 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ ɛ:
//│ 	18: [C 3 [N]]  <-->  10: case xs:7 of {N -> ys:8 | C h:9 t:10 -> [C h:9 ((inter:6 ys:8) t:10)]}
//│ ɛ ==> inter:6^13 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ ɛ:
//│ 	25: [N]  <-->  10: case xs:7 of {N -> ys:8 | C h:9 t:10 -> [C h:9 ((inter:6 ys:8) t:10)]}
//│ ɛ ==> inter:6^13 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ ɛ:
//│ 	19: [C 2 [C 3 [N]]]  <-->  10: case xs:7 of {N -> ys:8 | C h:9 t:10 -> [C h:9 ((inter:6 ys:8) t:10)]}
//│ ɛ ==> inter:6^13 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ ɛ:
//│ 	26: [C 7 [N]]  <-->  10: case xs:7 of {N -> ys:8 | C h:9 t:10 -> [C h:9 ((inter:6 ys:8) t:10)]}
//│ ɛ ==> inter:6^13 ⋅ inter:6^4 ⋅ ɛ:
//│ 	28: [C 9 [C 8 [C 7 [N]]]]  <-->  10: case xs:7 of {N -> ys:8 | C h:9 t:10 -> [C h:9 ((inter:6 ys:8) t:10)]}
//│ ɛ ==> inter:6^13 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ inter:6^4 ⋅ ɛ:
//│ 	27: [C 8 [C 7 [N]]]  <-->  10: case xs:7 of {N -> ys:8 | C h:9 t:10 -> [C h:9 ((inter:6 ys:8) t:10)]}
//│ ɛ ==> inter:6^13 ⋅ ɛ:
//│ 	20: [C 1 [C 2 [C 3 [N]]]]  <-->  10: case xs:7 of {N -> ys:8 | C h:9 t:10 -> [C h:9 ((inter:6 ys:8) t:10)]}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ def inter:6 = (fun xs:7 -> (fun ys:8 -> case xs:7 of {N -> ys:8 | C h:9 t:10 -> [C h:9 ((inter:6 ys:8) t:10)]}))
//│ def inter'6'13_inter'6'4_inter'6'4_inter'6'4:13 = (fun xs:7 -> (fun ys:8 -> xs:7))
//│ def inter'6'13_inter'6'4_inter'6'4_inter'6'4_inter'6'4_inter'6'4:14 = (fun xs:7 -> (fun ys:8 -> xs:7))
//│ def inter'6'13_inter'6'4_inter'6'4_inter'6'4_inter'6'4:16 = (fun xs:7 -> (fun ys:8 -> xs:7))
//│ def inter'6'13_inter'6'4_inter'6'4:15 = (fun xs:7 -> (fun ys:8 -> xs:7))
//│ def inter'6'13_inter'6'4:12 = (fun xs:7 -> (fun ys:8 -> xs:7))
//│ def inter'6'13:11 = (fun xs:7 -> (fun ys:8 -> xs:7))
//│ def inter'6'13_inter'6'4_inter'6'4_inter'6'4_inter'6'4_inter'6'4_inter'6'4:17 = (fun xs:7 -> (fun ys:8 -> xs:7))
//│ ((inter'6'13:11 
//│ 	let h:9 = 1 in 
//│ 	let t:10 = 
//│ 		let h:9 = 2 in 
//│ 		let t:10 = 
//│ 			let h:9 = 3 in 
//│ 			let t:10 = ys:8 in [C h:9 ((inter'6'13_inter'6'4_inter'6'4_inter'6'4_inter'6'4_inter'6'4:14 ys:8) t:10)] 
//│ 		in [C h:9 ((inter'6'13_inter'6'4_inter'6'4_inter'6'4:13 ys:8) t:10)] 
//│ 	in [C h:9 ((inter'6'13_inter'6'4:12 ys:8) t:10)]) 
//│ 	let h:9 = 9 in 
//│ 	let t:10 = 
//│ 		let h:9 = 8 in 
//│ 		let t:10 = 
//│ 			let h:9 = 7 in 
//│ 			let t:10 = ys:8 in [C h:9 ((inter'6'13_inter'6'4_inter'6'4_inter'6'4_inter'6'4_inter'6'4_inter'6'4:17 ys:8) t:10)] 
//│ 		in [C h:9 ((inter'6'13_inter'6'4_inter'6'4_inter'6'4_inter'6'4:16 ys:8) t:10)] 
//│ 	in [C h:9 ((inter'6'13_inter'6'4_inter'6'4:15 ys:8) t:10)])
//│ <<<<<<<<<< Rewritten <<<<<<<<<<

:ns
_LUMBERHACK_ERROR
let add = primitive
fun idxSum(ls) = if ls is
    N then acc => 0
    C(h, t) then acc => add(acc, idxSum(t)(add(acc, 1)))
fun rev(lss, a) = if lss is
    N then a
    C(hh, tt) then rev(tt, C(hh, a))
idxSum(rev(primitive, N))(0)
//│ |_LUMBERHACK_ERROR|↵|#let| |add| |#=| |primitive|↵|#fun| |idxSum|(|ls|)| |#=| |#if| |ls| |is|→|N| |#then| |acc| |=>| |0|↵|C|(|h|,| |t|)| |#then| |acc| |=>| |add|(|acc|,| |idxSum|(|t|)|(|add|(|acc|,| |1|)|)|)|←|↵|#fun| |rev|(|lss|,| |a|)| |#=| |#if| |lss| |is|→|N| |#then| |a|↵|C|(|hh|,| |tt|)| |#then| |rev|(|tt|,| |C|(|hh|,| |a|)|)|←|↵|idxSum|(|rev|(|primitive|,| |N|)|)|(|0|)|
//│ Parsed: {_LUMBERHACK_ERROR; let add = primitive; fun idxSum = ls, => if ls is ‹(N) then acc, => 0; (C (h, t,)) then acc, => add (acc, idxSum (t,) (add (acc, 1,),),)›; fun rev = lss, a, => if lss is ‹(N) then a; (C (hh, tt,)) then rev (tt, C (hh, a,),)›; idxSum (rev (primitive, N,),) (0,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def add:4 = 1: primitive:3
//│ def idxSum:7 = 20: (fun ls:9 -> 19: case 2: ls:9 of {N -> 4: (fun acc:10 -> 3: 0) | C h:11 t:12 -> 18: (fun acc:13 -> 17: (7: (5: add:4 6: acc:13) 16: (10: (8: idxSum:7 9: t:12) 15: (13: (11: add:4 12: acc:13) 14: 1))))})
//│ def rev:8 = 32: (fun lss:14 -> 31: (fun a:15 -> 30: case 21: lss:14 of {N -> 22: a:15 | C hh:16 tt:17 -> 29: (25: (23: rev:8 24: tt:17) 28: [C 26: hh:16 27: a:15])}))
//│ 41: (39: (33: idxSum:7 38: (36: (34: rev:8 35: primitive:3) 37: [N])) 40: 0)
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ N <: 20'29_callres
//│ 	[rev:8^23 ⋅ rev:8^23 ⋅ ɛ] <: [rev:8^34 ⋅ ɛ]
//│ 	[rev:8^23 ⋅ ɛ] <: [rev:8^34 ⋅ ɛ]
//│ C((ɛ, 17'hh), (ɛ, 16'a)) <: 20'29_callres
//│ 	[rev:8^23 ⋅ ɛ] <: [ɛ]
//│ 	[ɛ] <: [ɛ]
//│ C((ɛ, 17'hh), (ɛ, 16'a)) <: 3'ls
//│ 	[rev:8^34 ⋅ ɛ] <: [rev:8^23 ⋅ rev:8^23 ⋅ idxSum:7^33 ⋅ idxSum:7^8 ⋅ idxSum:7^8 ⋅ ɛ]
//│ 	[rev:8^34 ⋅ ɛ] <: [rev:8^23 ⋅ rev:8^23 ⋅ idxSum:7^33 ⋅ idxSum:7^8 ⋅ ɛ]
//│ ------- defInstance -------
//│ ɛ ==> rev:8^23 ⋅ idxSum:7^33 ⋅ idxSum:7^8 ⋅ ɛ:
//│ 	37: [N]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ rev:8^34 ⋅ ɛ ==> rev:8^23 ⋅ rev:8^23 ⋅ idxSum:7^33 ⋅ idxSum:7^8 ⋅ ɛ:
//│ 	28: [C hh:16 a:15]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ rev:8^34 ⋅ ɛ ==> rev:8^23 ⋅ idxSum:7^33 ⋅ idxSum:7^8 ⋅ ɛ:
//│ 	28: [C hh:16 a:15]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ rev:8^34 ⋅ ɛ ==> idxSum:7^33 ⋅ ɛ:
//│ 	28: [C hh:16 a:15]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ rev:8^23 ⋅ ɛ ==> idxSum:7^33 ⋅ ɛ:
//│ 	37: [N]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ ɛ ==> idxSum:7^33 ⋅ ɛ:
//│ 	37: [N]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ rev:8^34 ⋅ ɛ ==> rev:8^23 ⋅ idxSum:7^33 ⋅ ɛ:
//│ 	28: [C hh:16 a:15]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ ɛ ==> idxSum:7^33 ⋅ idxSum:7^8 ⋅ ɛ:
//│ 	37: [N]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ ɛ ==> rev:8^23 ⋅ idxSum:7^33 ⋅ idxSum:7^8 ⋅ idxSum:7^8 ⋅ ɛ:
//│ 	37: [N]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ ɛ ==> rev:8^23 ⋅ rev:8^23 ⋅ idxSum:7^33 ⋅ idxSum:7^8 ⋅ idxSum:7^8 ⋅ ɛ:
//│ 	37: [N]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ !!!!!!ERROR!!!!!!
//│ java.lang.Exception: Internal Error: 
//│ ɛ to `[N]` 
//│ 	already has rev:8^23 ⋅ idxSum:7^33 ⋅ idxSum:7^8 ⋅ ɛ to `case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}` 
//│ 	but here comes another match idxSum:7^33 ⋅ ɛ to `case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}`
//│ !!!!!!ERROR!!!!!!


// scope extrusion
:ns
fun inter(xs) = if xs is
    N then ys => ys
    C(h0, t0) then ys => if ys is
        N then N2
        C(h1, t1) then C2(add(h0,h1), inter(t0, t1))
let l1 = C(1, C(2, C(1, C(2, N))))
// let rec l2 = N
let rec l2 = C(11, N)
inter(l1, l2)
//│ |#fun| |inter|(|xs|)| |#=| |#if| |xs| |is|→|N| |#then| |ys| |=>| |ys|↵|C|(|h0|,| |t0|)| |#then| |ys| |=>| |#if| |ys| |is|→|N| |#then| |N2|↵|C|(|h1|,| |t1|)| |#then| |C2|(|add|(|h0|,|h1|)|,| |inter|(|t0|,| |t1|)|)|←|←|↵|#let| |l1| |#=| |C|(|1|,| |C|(|2|,| |C|(|1|,| |C|(|2|,| |N|)|)|)|)|↵|/* let rec l2 = N*/|↵|#let| |#rec| |l2| |#=| |C|(|11|,| |N|)|↵|inter|(|l1|,| |l2|)|
//│ Parsed: {fun inter = xs, => if xs is ‹(N) then ys, => ys; (C (h0, t0,)) then ys, => if ys is ‹(N) then N2; (C (h1, t1,)) then C2 (add (h0, h1,), inter (t0, t1,),)››; let l1 = C (1, C (2, C (1, C (2, N,),),),); let rec l2 = C (11, N,); inter (l1, l2,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def inter:6 = 20: (fun xs:9 -> 19: case 1: xs:9 of {N -> 3: (fun ys:10 -> 2: ys:10) | C h0:11 t0:12 -> 18: (fun ys:13 -> 17: case 4: ys:13 of {N -> 5: [N2] | C h1:14 t1:15 -> 16: [C2 10: (8: (6: add:4 7: h0:11) 9: h1:14) 15: (13: (11: inter:6 12: t0:12) 14: t1:15)]})})
//│ def l1:7 = 29: [C 21: 1 28: [C 22: 2 27: [C 23: 1 26: [C 24: 2 25: [N]]]]]
//│ def l2:8 = 32: [C 30: 11 31: [N]]
//│ 37: (35: (33: inter:6 34: l1:7) 36: l2:8)
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ ------- defInstance -------
//│ l1:7^34 ⋅ ɛ ==> inter:6^33 ⋅ inter:6^11 ⋅ inter:6^11 ⋅ ɛ:
//│ 	27: [C 1 [C 2 [N]]]  <-->  19: case xs:9 of {N -> (fun ys:10 -> ys:10) | C h0:11 t0:12 -> (fun ys:13 -> case ys:13 of {N -> [N2] | C h1:14 t1:15 -> [C2 ((add:4 h0:11) h1:14) ((inter:6 t0:12) t1:15)]})}
//│ l2:8^36 ⋅ ɛ ==> inter:6^33 ⋅ ɛ:
//│ 	32: [C 11 [N]]  <-->  17: case ys:13 of {N -> [N2] | C h1:14 t1:15 -> [C2 ((add:4 h0:11) h1:14) ((inter:6 t0:12) t1:15)]}
//│ l1:7^34 ⋅ ɛ ==> inter:6^33 ⋅ inter:6^11 ⋅ ɛ:
//│ 	28: [C 2 [C 1 [C 2 [N]]]]  <-->  19: case xs:9 of {N -> (fun ys:10 -> ys:10) | C h0:11 t0:12 -> (fun ys:13 -> case ys:13 of {N -> [N2] | C h1:14 t1:15 -> [C2 ((add:4 h0:11) h1:14) ((inter:6 t0:12) t1:15)]})}
//│ l1:7^34 ⋅ ɛ ==> inter:6^33 ⋅ ɛ:
//│ 	29: [C 1 [C 2 [C 1 [C 2 [N]]]]]  <-->  19: case xs:9 of {N -> (fun ys:10 -> ys:10) | C h0:11 t0:12 -> (fun ys:13 -> case ys:13 of {N -> [N2] | C h1:14 t1:15 -> [C2 ((add:4 h0:11) h1:14) ((inter:6 t0:12) t1:15)]})}
//│ l1:7^34 ⋅ ɛ ==> inter:6^33 ⋅ inter:6^11 ⋅ inter:6^11 ⋅ inter:6^11 ⋅ inter:6^11 ⋅ ɛ:
//│ 	25: [N]  <-->  19: case xs:9 of {N -> (fun ys:10 -> ys:10) | C h0:11 t0:12 -> (fun ys:13 -> case ys:13 of {N -> [N2] | C h1:14 t1:15 -> [C2 ((add:4 h0:11) h1:14) ((inter:6 t0:12) t1:15)]})}
//│ l2:8^36 ⋅ ɛ ==> inter:6^33 ⋅ inter:6^11 ⋅ ɛ:
//│ 	31: [N]  <-->  17: case ys:13 of {N -> [N2] | C h1:14 t1:15 -> [C2 ((add:4 h0:11) h1:14) ((inter:6 t0:12) t1:15)]}
//│ l1:7^34 ⋅ ɛ ==> inter:6^33 ⋅ inter:6^11 ⋅ inter:6^11 ⋅ inter:6^11 ⋅ ɛ:
//│ 	26: [C 2 [N]]  <-->  19: case xs:9 of {N -> (fun ys:10 -> ys:10) | C h0:11 t0:12 -> (fun ys:13 -> case ys:13 of {N -> [N2] | C h1:14 t1:15 -> [C2 ((add:4 h0:11) h1:14) ((inter:6 t0:12) t1:15)]})}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ def inter:6 = (fun xs:9 -> case xs:9 of {N -> (fun ys:10 -> ys:10) | C h0:11 t0:12 -> (fun ys:13 -> case ys:13 of {N -> [N2] | C h1:14 t1:15 -> [C2 ((add:4 h0:11) h1:14) ((inter:6 t0:12) t1:15)]})})
//│ def l1:7 = [C 1 [C 2 [C 1 [C 2 [N]]]]]
//│ def l2:8 = [C 11 [N]]
//│ def inter'6'33:16 = (fun xs:9 -> xs:9)
//│ def inter'6'33_inter'6'11_inter'6'11_inter'6'11:18 = (fun xs:9 -> xs:9)
//│ def l1'7'34:17 = 
//│ 	let h0:11 = 1 in 
//│ 	let t0:12 = 
//│ 		let h0:11 = 2 in 
//│ 		let t0:12 = 
//│ 			let h0:11 = 1 in 
//│ 			let t0:12 = 
//│ 				let h0:11 = 2 in 
//│ 				let t0:12 = (fun ys:10 -> ys:10) in (fun ys:13 -> case ys:13 of {N -> [N2] | C h1:14 t1:15 -> [C2 ((add:4 h0:11) h1:14) ((inter'6'33_inter'6'11_inter'6'11_inter'6'11_inter'6'11:19 t0:12) t1:15)]}) 
//│ 			in (fun ys:13 -> case ys:13 of {N -> [N2] | C h1:14 t1:15 -> [C2 ((add:4 h0:11) h1:14) ((inter'6'33_inter'6'11_inter'6'11_inter'6'11:18 t0:12) t1:15)]}) 
//│ 		in (fun ys:13 -> ys:13) 
//│ 	in (fun ys:13 -> ys:13)
//│ def inter'6'33_inter'6'11_inter'6'11_inter'6'11_inter'6'11:19 = (fun xs:9 -> xs:9)
//│ def l2'8'36:20 = 
//│ 	let h1:14 = 11 in 
//│ 	let t1:15 = [N2] in [C2 ((add:4 h0:11) h1:14) ((inter'6'33_inter'6'11:21 t0:12) t1:15)]
//│ def inter'6'33_inter'6'11:21 = (fun xs:9 -> xs:9)
//│ ((inter'6'33:16 l1'7'34:17) l2'8'36:20)
//│ <<<<<<<<<< Rewritten <<<<<<<<<<


:ns
let rec p = C(C(C(id(p))))
fun c(x) = if x is
    C(a) then if a is
        C(b) then c(b)
fun id2(z) = z
fun id(y) = id2(y)
fun id3(d) = d
c(id3(p))
//│ |#let| |#rec| |p| |#=| |C|(|C|(|C|(|id|(|p|)|)|)|)|↵|#fun| |c|(|x|)| |#=| |#if| |x| |is|→|C|(|a|)| |#then| |#if| |a| |is|→|C|(|b|)| |#then| |c|(|b|)|←|←|↵|#fun| |id2|(|z|)| |#=| |z|↵|#fun| |id|(|y|)| |#=| |id2|(|y|)|↵|#fun| |id3|(|d|)| |#=| |d|↵|c|(|id3|(|p|)|)|
//│ Parsed: {let rec p = C (C (C (id (p,),),),); fun c = x, => if x is ‹(C (a,)) then if a is ‹(C (b,)) then c (b,)››; fun id2 = z, => z; fun id = y, => id2 (y,); fun id3 = d, => d; c (id3 (p,),)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def p:6 = 6: [C 5: [C 4: [C 3: (1: id:9 2: p:6)]]]
//│ def c:7 = 14: (fun x:11 -> 13: case 7: x:11 of {C a:12 -> 12: case 8: a:12 of {C b:13 -> 11: (9: c:7 10: b:13)}})
//│ def id2:8 = 16: (fun z:14 -> 15: z:14)
//│ def id:9 = 20: (fun y:15 -> 19: (17: id2:8 18: y:15))
//│ def id3:10 = 22: (fun d:16 -> 21: d:16)
//│ 27: (23: c:7 26: (24: id3:10 25: p:6))
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ C((ɛ, C((ɛ, C((ɛ, 5'3_callres)))))) <: 7'a
//│ 	[p:6^25 ⋅ p:6^2 ⋅ p:6^2 ⋅ p:6^2 ⋅ ɛ] <: [c:7^23 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ]
//│ 	[p:6^25 ⋅ p:6^2 ⋅ ɛ] <: [c:7^23 ⋅ c:7^9 ⋅ ɛ]
//│ ------- defInstance -------
//│ p:6^25 ⋅ p:6^2 ⋅ ɛ ==> c:7^23 ⋅ c:7^9 ⋅ ɛ:
//│ 	6: [C [C [C (id:9 p:6)]]]  <-->  12: case a:12 of {C b:13 -> (c:7 b:13)}
//│ p:6^25 ⋅ ɛ ==> c:7^23 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id:9 p:6)]  <-->  13: case x:11 of {C a:12 -> case a:12 of {C b:13 -> (c:7 b:13)}}
//│ p:6^25 ⋅ p:6^2 ⋅ ɛ ==> c:7^23 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id:9 p:6)]  <-->  12: case a:12 of {C b:13 -> (c:7 b:13)}
//│ 	5: [C [C (id:9 p:6)]]  <-->  13: case x:11 of {C a:12 -> case a:12 of {C b:13 -> (c:7 b:13)}}
//│ p:6^25 ⋅ ɛ ==> c:7^23 ⋅ ɛ:
//│ 	5: [C [C (id:9 p:6)]]  <-->  12: case a:12 of {C b:13 -> (c:7 b:13)}
//│ 	6: [C [C [C (id:9 p:6)]]]  <-->  13: case x:11 of {C a:12 -> case a:12 of {C b:13 -> (c:7 b:13)}}
//│ p:6^25 ⋅ p:6^2 ⋅ p:6^2 ⋅ ɛ ==> c:7^23 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	5: [C [C (id:9 p:6)]]  <-->  12: case a:12 of {C b:13 -> (c:7 b:13)}
//│ 	6: [C [C [C (id:9 p:6)]]]  <-->  13: case x:11 of {C a:12 -> case a:12 of {C b:13 -> (c:7 b:13)}}
//│ p:6^25 ⋅ p:6^2 ⋅ p:6^2 ⋅ ɛ ==> c:7^23 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ c:7^9 ⋅ ɛ:
//│ 	4: [C (id:9 p:6)]  <-->  13: case x:11 of {C a:12 -> case a:12 of {C b:13 -> (c:7 b:13)}}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ def p:6 = [C [C [C (id:9 p:6)]]]
//│ def c:7 = (fun x:11 -> case x:11 of {C a:12 -> case a:12 of {C b:13 -> (c:7 b:13)}})
//│ def id2:8 = (fun z:14 -> z:14)
//│ def id:9 = (fun y:15 -> (id2:8 y:15))
//│ def id3:10 = (fun d:16 -> d:16)
//│ def c'7'23_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:35 = "RECURSE_TOO_LONG"
//│ def c'7'23_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:33 = (fun x:11 -> case x:11 of {C a:12 -> case a:12 of {C b:13 -> (c'7'23_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:34 b:13)}})
//│ def p'6'25_id'9'1:21 = (fun y:15 -> (p'6'25_id'9'1_id2'8'17:22 y:15))
//│ def c'7'23_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:34 = (fun x:11 -> case x:11 of {C a:12 -> case a:12 of {C b:13 -> (c'7'23_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:35 b:13)}})
//│ def p'6'25_p'6'2_id'9'1:26 = (fun y:15 -> (p'6'25_p'6'2_id'9'1_id2'8'17:27 y:15))
//│ def p'6'25_p'6'2_p'6'2_id'9'1:36 = (fun y:15 -> (p'6'25_p'6'2_p'6'2_id'9'1_id2'8'17:37 y:15))
//│ def p'6'25_p'6'2_p'6'2:28 = 
//│ 	let a:12 = 
//│ 		let b:13 = 
//│ 			let a:12 = (p'6'25_p'6'2_p'6'2_id'9'1:36 p'6'25_p'6'2:23) in case a:12 of {C b:13 -> (c'7'23_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:29 b:13)} 
//│ 		in (c'7'23_c'7'9:20 b:13) 
//│ 	in a:12
//│ def c'7'23_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:31 = (fun x:11 -> case x:11 of {C a:12 -> case a:12 of {C b:13 -> (c'7'23_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:32 b:13)}})
//│ def c'7'23_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:32 = (fun x:11 -> case x:11 of {C a:12 -> case a:12 of {C b:13 -> (c'7'23_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:33 b:13)}})
//│ def p'6'25_id'9'1_id2'8'17:22 = (fun z:14 -> z:14)
//│ def id3'10'24:18 = (fun d:16 -> d:16)
//│ def c'7'23_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:30 = (fun x:11 -> case x:11 of {C a:12 -> case a:12 of {C b:13 -> (c'7'23_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:31 b:13)}})
//│ def c'7'23_c'7'9_c'7'9:24 = (fun x:11 -> x:11)
//│ def c'7'23_c'7'9_c'7'9_c'7'9:25 = (fun x:11 -> x:11)
//│ def c'7'23:17 = (fun x:11 -> x:11)
//│ def c'7'23_c'7'9:20 = (fun x:11 -> x:11)
//│ def p'6'25_p'6'2:23 = 
//│ 	let b:13 = 
//│ 		let a:12 = 
//│ 			let b:13 = (p'6'25_p'6'2_id'9'1:26 p'6'25_p'6'2_p'6'2:28) in (c'7'23_c'7'9_c'7'9_c'7'9:25 b:13) 
//│ 		in a:12 
//│ 	in (c'7'23_c'7'9_c'7'9:24 b:13)
//│ def c'7'23_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:29 = (fun x:11 -> case x:11 of {C a:12 -> case a:12 of {C b:13 -> (c'7'23_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9_c'7'9:30 b:13)}})
//│ def p'6'25_p'6'2_id'9'1_id2'8'17:27 = (fun z:14 -> z:14)
//│ def p'6'25_p'6'2_p'6'2_id'9'1_id2'8'17:37 = (fun z:14 -> z:14)
//│ def p'6'25:19 = 
//│ 	let a:12 = 
//│ 		let b:13 = 
//│ 			let a:12 = (p'6'25_id'9'1:21 p'6'25_p'6'2:23) in a:12 
//│ 		in (c'7'23_c'7'9:20 b:13) 
//│ 	in a:12
//│ (c'7'23:17 (id3'10'24:18 p'6'25:19))
//│ <<<<<<<<<< Rewritten <<<<<<<<<<

:ns
fun id(k) = k
fun id1(x) = id(x)
fun id2(y) = y
fun id3(z) = z
let rec p = C(C(C(id7(C(C(id1(p)))))))
fun c(xx) = if xx is
    C(a) then c(a)
fun id4(k) = k
fun id5(j) = j
fun id6(l) = l
fun id7(i) = i
id6(id4)(c)(id5(id2)(id3(p)))
//│ |#fun| |id|(|k|)| |#=| |k|↵|#fun| |id1|(|x|)| |#=| |id|(|x|)|↵|#fun| |id2|(|y|)| |#=| |y|↵|#fun| |id3|(|z|)| |#=| |z|↵|#let| |#rec| |p| |#=| |C|(|C|(|C|(|id7|(|C|(|C|(|id1|(|p|)|)|)|)|)|)|)|↵|#fun| |c|(|xx|)| |#=| |#if| |xx| |is|→|C|(|a|)| |#then| |c|(|a|)|←|↵|#fun| |id4|(|k|)| |#=| |k|↵|#fun| |id5|(|j|)| |#=| |j|↵|#fun| |id6|(|l|)| |#=| |l|↵|#fun| |id7|(|i|)| |#=| |i|↵|id6|(|id4|)|(|c|)|(|id5|(|id2|)|(|id3|(|p|)|)|)|
//│ Parsed: {fun id = k, => k; fun id1 = x, => id (x,); fun id2 = y, => y; fun id3 = z, => z; let rec p = C (C (C (id7 (C (C (id1 (p,),),),),),),); fun c = xx, => if xx is ‹(C (a,)) then c (a,)›; fun id4 = k, => k; fun id5 = j, => j; fun id6 = l, => l; fun id7 = i, => i; id6 (id4,) (c,) (id5 (id2,) (id3 (p,),),)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def id:6 = 2: (fun k:16 -> 1: k:16)
//│ def id1:7 = 6: (fun x:17 -> 5: (3: id:6 4: x:17))
//│ def id2:8 = 8: (fun y:18 -> 7: y:18)
//│ def id3:9 = 10: (fun z:19 -> 9: z:19)
//│ def p:10 = 20: [C 19: [C 18: [C 17: (11: id7:15 16: [C 15: [C 14: (12: id1:7 13: p:10)]])]]]
//│ def c:11 = 26: (fun xx:20 -> 25: case 21: xx:20 of {C a:21 -> 24: (22: c:11 23: a:21)})
//│ def id4:12 = 28: (fun k:22 -> 27: k:22)
//│ def id5:13 = 30: (fun j:23 -> 29: j:23)
//│ def id6:14 = 32: (fun l:24 -> 31: l:24)
//│ def id7:15 = 34: (fun i:25 -> 33: i:25)
//│ 47: (39: (37: (35: id6:14 36: id4:12) 38: c:11) 46: (42: (40: id5:13 41: id2:8) 45: (43: id3:9 44: p:10)))
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ C((ɛ, C((ɛ, C((ɛ, 16'17_callres)))))) <: 18'a
//│ 	[p:10^44 ⋅ p:10^13 ⋅ p:10^13 ⋅ ɛ] <: [c:11^38 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ ɛ]
//│ 	[p:10^44 ⋅ p:10^13 ⋅ ɛ] <: [c:11^38 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ ɛ]
//│ ------- defInstance -------
//│ p:10^44 ⋅ p:10^13 ⋅ ɛ ==> c:11^38 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ ɛ:
//│ 	15: [C (id1:7 p:10)]  <-->  25: case xx:20 of {C a:21 -> (c:11 a:21)}
//│ p:10^44 ⋅ p:10^13 ⋅ ɛ ==> c:11^38 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ ɛ:
//│ 	20: [C [C [C (id7:15 [C [C (id1:7 p:10)]])]]]  <-->  25: case xx:20 of {C a:21 -> (c:11 a:21)}
//│ p:10^44 ⋅ ɛ ==> c:11^38 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ ɛ:
//│ 	16: [C [C (id1:7 p:10)]]  <-->  25: case xx:20 of {C a:21 -> (c:11 a:21)}
//│ p:10^44 ⋅ p:10^13 ⋅ ɛ ==> c:11^38 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ ɛ:
//│ 	18: [C (id7:15 [C [C (id1:7 p:10)]])]  <-->  25: case xx:20 of {C a:21 -> (c:11 a:21)}
//│ p:10^44 ⋅ p:10^13 ⋅ ɛ ==> c:11^38 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ ɛ:
//│ 	19: [C [C (id7:15 [C [C (id1:7 p:10)]])]]  <-->  25: case xx:20 of {C a:21 -> (c:11 a:21)}
//│ p:10^44 ⋅ ɛ ==> c:11^38 ⋅ ɛ:
//│ 	20: [C [C [C (id7:15 [C [C (id1:7 p:10)]])]]]  <-->  25: case xx:20 of {C a:21 -> (c:11 a:21)}
//│ p:10^44 ⋅ ɛ ==> c:11^38 ⋅ c:11^22 ⋅ c:11^22 ⋅ ɛ:
//│ 	18: [C (id7:15 [C [C (id1:7 p:10)]])]  <-->  25: case xx:20 of {C a:21 -> (c:11 a:21)}
//│ p:10^44 ⋅ p:10^13 ⋅ ɛ ==> c:11^38 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ ɛ:
//│ 	16: [C [C (id1:7 p:10)]]  <-->  25: case xx:20 of {C a:21 -> (c:11 a:21)}
//│ p:10^44 ⋅ ɛ ==> c:11^38 ⋅ c:11^22 ⋅ ɛ:
//│ 	19: [C [C (id7:15 [C [C (id1:7 p:10)]])]]  <-->  25: case xx:20 of {C a:21 -> (c:11 a:21)}
//│ p:10^44 ⋅ ɛ ==> c:11^38 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ c:11^22 ⋅ ɛ:
//│ 	15: [C (id1:7 p:10)]  <-->  25: case xx:20 of {C a:21 -> (c:11 a:21)}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ def id:6 = (fun k:16 -> k:16)
//│ def id1:7 = (fun x:17 -> (id:6 x:17))
//│ def id2:8 = (fun y:18 -> y:18)
//│ def id3:9 = (fun z:19 -> z:19)
//│ def p:10 = [C [C [C (id7:15 [C [C (id1:7 p:10)]])]]]
//│ def c:11 = (fun xx:20 -> case xx:20 of {C a:21 -> (c:11 a:21)})
//│ def id4:12 = (fun k:22 -> k:22)
//│ def id5:13 = (fun j:23 -> j:23)
//│ def id6:14 = (fun l:24 -> l:24)
//│ def id7:15 = (fun i:25 -> i:25)
//│ def p'10'44_id1'7'12_id'6'3:40 = (fun k:16 -> k:16)
//│ def id5'13'40:29 = (fun j:23 -> j:23)
//│ def c'11'38_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22:42 = (fun xx:20 -> xx:20)
//│ def id4'12'36:27 = (fun k:22 -> k:22)
//│ def c'11'38_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22:44 = (fun xx:20 -> xx:20)
//│ def c'11'38_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22:43 = (fun xx:20 -> xx:20)
//│ def p'10'44_p'10'13_id1'7'12_id'6'3:49 = (fun k:16 -> k:16)
//│ def p'10'44:32 = 
//│ 	let a:21 = 
//│ 		let a:21 = 
//│ 			let a:21 = (p'10'44_id7'15'11:36 
//│ 				let a:21 = 
//│ 					let a:21 = (p'10'44_id1'7'12:39 p'10'44_p'10'13:41) in (c'11'38_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22:38 a:21) 
//│ 				in (c'11'38_c'11'22_c'11'22_c'11'22_c'11'22:37 a:21)) 
//│ 			in (c'11'38_c'11'22_c'11'22_c'11'22:35 a:21) 
//│ 		in (c'11'38_c'11'22_c'11'22:34 a:21) 
//│ 	in (c'11'38_c'11'22:33 a:21)
//│ def p'10'44_p'10'13_id7'15'11:45 = (fun i:25 -> i:25)
//│ def c'11'38_c'11'22_c'11'22:34 = (fun xx:20 -> xx:20)
//│ def p'10'44_p'10'13_id1'7'12:48 = (fun x:17 -> (p'10'44_p'10'13_id1'7'12_id'6'3:49 x:17))
//│ def id2'8'41:30 = (fun y:18 -> y:18)
//│ def p'10'44_id7'15'11:36 = (fun i:25 -> i:25)
//│ def c'11'38:28 = (fun xx:20 -> xx:20)
//│ def p'10'44_p'10'13:41 = 
//│ 	let a:21 = 
//│ 		let a:21 = 
//│ 			let a:21 = (p'10'44_p'10'13_id7'15'11:45 
//│ 				let a:21 = 
//│ 					let a:21 = (p'10'44_p'10'13_id1'7'12:48 p'10'44_p'10'13:41) in (c'11'38_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22:46 a:21) 
//│ 				in (c'11'38_c'11'22_c'11'22_c'11'22_c'11'22:37 a:21)) 
//│ 			in (c'11'38_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22:44 a:21) 
//│ 		in (c'11'38_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22:43 a:21) 
//│ 	in (c'11'38_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22:42 a:21)
//│ def c'11'38_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22:38 = (fun xx:20 -> xx:20)
//│ def c'11'38_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22:47 = "RECURSE_TOO_LONG"
//│ def p'10'44_id1'7'12:39 = (fun x:17 -> (p'10'44_id1'7'12_id'6'3:40 x:17))
//│ def id6'14'35:26 = (fun l:24 -> l:24)
//│ def c'11'38_c'11'22_c'11'22_c'11'22:35 = (fun xx:20 -> xx:20)
//│ def id3'9'43:31 = (fun z:19 -> z:19)
//│ def c'11'38_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22:46 = (fun xx:20 -> case xx:20 of {C a:21 -> (c'11'38_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22_c'11'22:47 a:21)})
//│ def c'11'38_c'11'22:33 = (fun xx:20 -> xx:20)
//│ def c'11'38_c'11'22_c'11'22_c'11'22_c'11'22:37 = (fun xx:20 -> xx:20)
//│ (((id6'14'35:26 id4'12'36:27) c'11'38:28) ((id5'13'40:29 id2'8'41:30) (id3'9'43:31 p'10'44:32)))
//│ <<<<<<<<<< Rewritten <<<<<<<<<<
