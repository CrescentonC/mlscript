:NewParser
:ParseOnly


// NOTE: the `p` inside `C(p)` is untouched
// TODO don't rewrite dead code
let p = C(p)
fun c(x) = if C(x) is
    C(a) then a
c(p)
//│ |#let| |p| |#=| |C|(|p|)|↵|#fun| |c|(|x|)| |#=| |#if| |C|(|x|)| |is|→|C|(|a|)| |#then| |a|←|↵|c|(|p|)|
//│ Parsed: {let p = C (p,); fun c = x, => if C (x,) is ‹(C (a,)) then a›; c (p,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def p:6 = 2: [C 1: p:6]
//│ def c:7 = 7: (fun x:8 -> 6: case 4: [C 3: x:8] of {C a:9 -> 5: a:9})
//│ 10: (8: c:7 9: p:6)
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ ------- defInstance -------
//│ ɛ ==> ɛ:
//│ 	4: [C x:8]  <-->  6: case [C x:8] of {C a:9 -> a:9}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ def p:6 = [C p:6]
//│ def c:7 = (fun x:8 -> case [C x:8] of {C a:9 -> a:9})
//│ def p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:21 = [C p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:22]
//│ def p'6'9_p'6'1_p'6'1:13 = [C p'6'9_p'6'1_p'6'1_p'6'1:14]
//│ def p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:19 = [C p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:20]
//│ def p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:22 = "RECURSE_TOO_LONG"
//│ def c'7'8:10 = (fun x:8 -> 
//│ 	let a:9 = x:8 in a:9)
//│ def p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:20 = [C p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:21]
//│ def p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:18 = [C p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:19]
//│ def p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:17 = [C p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:18]
//│ def p'6'9_p'6'1:12 = [C p'6'9_p'6'1_p'6'1:13]
//│ def p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:16 = [C p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:17]
//│ def p'6'9_p'6'1_p'6'1_p'6'1:14 = [C p'6'9_p'6'1_p'6'1_p'6'1_p'6'1:15]
//│ def p'6'9:11 = [C p'6'9_p'6'1:12]
//│ def p'6'9_p'6'1_p'6'1_p'6'1_p'6'1:15 = [C p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:16]
//│ (c'7'8:10 p'6'9:11)
//│ <<<<<<<<<< Rewritten <<<<<<<<<<
//│ >>>>>>>>>> Simplify >>>>>>>>>>
//│ def p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:21 = [C p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:22]
//│ def p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:16 = [C p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:17]
//│ def p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:19 = [C p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:20]
//│ def p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:18 = [C p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:19]
//│ def p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:22 = "RECURSE_TOO_LONG"
//│ def p'6'9_p'6'1:12 = [C p'6'9_p'6'1_p'6'1:13]
//│ def p'6'9_p'6'1_p'6'1_p'6'1_p'6'1:15 = [C p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:16]
//│ def p'6'9_p'6'1_p'6'1:13 = [C p'6'9_p'6'1_p'6'1_p'6'1:14]
//│ def p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:17 = [C p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:18]
//│ def p'6'9_p'6'1_p'6'1_p'6'1:14 = [C p'6'9_p'6'1_p'6'1_p'6'1_p'6'1:15]
//│ def c'7'8:10 = (fun x:8 -> 
//│ 	let a:9 = x:8 in a:9)
//│ def p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:20 = [C p'6'9_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1_p'6'1:21]
//│ def p'6'9:11 = [C p'6'9_p'6'1:12]
//│ (c'7'8:10 p'6'9:11)
//│ <<<<<<<<<< Simplify <<<<<<<<<<


// NOTE: how to produce a finite rewrtten program?
_LUMBERHACK_ERROR
let p = Pair(A, B)
fun c(x) = if x is
    Pair(a, b) then c(Pair(b, a))
c(p)
//│ |_LUMBERHACK_ERROR|↵|#let| |p| |#=| |Pair|(|A|,| |B|)|↵|#fun| |c|(|x|)| |#=| |#if| |x| |is|→|Pair|(|a|,| |b|)| |#then| |c|(|Pair|(|b|,| |a|)|)|←|↵|c|(|p|)|
//│ Parsed: {_LUMBERHACK_ERROR; let p = Pair (A, B,); fun c = x, => if x is ‹(Pair (a, b,)) then c (Pair (b, a,),)›; c (p,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def p:6 = 3: [Pair 1: [A] 2: [B]]
//│ def c:7 = 11: (fun x:8 -> 10: case 4: x:8 of {Pair a:9 b:10 -> 9: (5: c:7 8: [Pair 6: b:10 7: a:9])})
//│ 14: (12: c:7 13: p:6)
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ B <: 4'b
//│ 	[p:6^13 ⋅ ɛ] <: [c:7^12 ⋅ c:7^5 ⋅ c:7^5 ⋅ ɛ]
//│ 	[p:6^13 ⋅ ɛ] <: [c:7^12 ⋅ ɛ]
//│ A <: 3'a
//│ 	[p:6^13 ⋅ ɛ] <: [c:7^12 ⋅ c:7^5 ⋅ c:7^5 ⋅ ɛ]
//│ 	[p:6^13 ⋅ ɛ] <: [c:7^12 ⋅ ɛ]
//│ ------- defInstance -------
//│ ɛ ==> c:7^5 ⋅ ɛ:
//│ 	8: [Pair b:10 a:9]  <-->  10: case x:8 of {Pair a:9 b:10 -> (c:7 [Pair b:10 a:9])}
//│ p:6^13 ⋅ ɛ ==> c:7^12 ⋅ ɛ:
//│ 	3: [Pair [A] [B]]  <-->  10: case x:8 of {Pair a:9 b:10 -> (c:7 [Pair b:10 a:9])}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ !!!!!!ERROR!!!!!!
//│ java.lang.StackOverflowError
//│ !!!!!!ERROR!!!!!!

// Just a more valid/reasonable version of the above
// TODO support nested patterns as in `Pair(0)`
// TODO get a recursive knot even when using `primitive` (we get it without)
_LUMBERHACK_ERROR
let p = Wrap(3)
fun c(x) = if x is
    N then 0
    Wrap(a) then c(Wrap(primitive(a)))
c(p)
//│ |_LUMBERHACK_ERROR|↵|#let| |p| |#=| |Wrap|(|3|)|↵|#fun| |c|(|x|)| |#=| |#if| |x| |is|→|N| |#then| |0|↵|Wrap|(|a|)| |#then| |c|(|Wrap|(|primitive|(|a|)|)|)|←|↵|c|(|p|)|
//│ Parsed: {_LUMBERHACK_ERROR; let p = Wrap (3,); fun c = x, => if x is ‹(N) then 0; (Wrap (a,)) then c (Wrap (primitive (a,),),)›; c (p,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def p:6 = 2: [Wrap 1: 3]
//│ def c:7 = 12: (fun x:8 -> 11: case 3: x:8 of {N -> 4: 0 | Wrap a:9 -> 10: (5: c:7 9: [Wrap 8: (6: primitive:3 7: a:9)])})
//│ 15: (13: c:7 14: p:6)
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ Int <: 5'10_callres
//│ 	[c:7^5 ⋅ c:7^5 ⋅ ɛ] <: [ɛ]
//│ 	[c:7^5 ⋅ ɛ] <: [ɛ]
//│ ------- defInstance -------
//│ ɛ ==> c:7^5 ⋅ ɛ:
//│ 	9: [Wrap (primitive:3 a:9)]  <-->  11: case x:8 of {N -> 0 | Wrap a:9 -> (c:7 [Wrap (primitive:3 a:9)])}
//│ p:6^14 ⋅ ɛ ==> c:7^13 ⋅ ɛ:
//│ 	2: [Wrap 3]  <-->  11: case x:8 of {N -> 0 | Wrap a:9 -> (c:7 [Wrap (primitive:3 a:9)])}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ !!!!!!ERROR!!!!!!
//│ java.lang.StackOverflowError
//│ !!!!!!ERROR!!!!!!

fun c(x) = if primitive(x) is
    True then 0
    False then c(primitive(x))
c(0)
//│ |#fun| |c|(|x|)| |#=| |#if| |primitive|(|x|)| |is|→|True| |#then| |0|↵|False| |#then| |c|(|primitive|(|x|)|)|←|↵|c|(|0|)|
//│ Parsed: {fun c = x, => if primitive (x,) is ‹(True) then 0; (False) then c (primitive (x,),)›; c (0,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def c:6 = 11: (fun x:7 -> 10: case 3: (1: primitive:3 2: x:7) of {True -> 4: 0 | False -> 9: (5: c:6 8: (6: primitive:3 7: x:7))})
//│ 14: (12: c:6 13: 0)
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ Int <: 4'9_callres
//│ 	[c:6^5 ⋅ c:6^5 ⋅ ɛ] <: [ɛ]
//│ 	[c:6^5 ⋅ ɛ] <: [ɛ]
//│ ------- defInstance -------
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ def c:6 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c:6 (primitive:3 x:7))})
//│ def c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:18 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:19 (primitive:3 x:7))})
//│ def c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:19 = "RECURSE_TOO_LONG"
//│ def c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:17 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:18 (primitive:3 x:7))})
//│ def c'6'12_c'6'5_c'6'5:10 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5:11 (primitive:3 x:7))})
//│ def c'6'12_c'6'5_c'6'5_c'6'5:11 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5_c'6'5:12 (primitive:3 x:7))})
//│ def c'6'12_c'6'5:9 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5:10 (primitive:3 x:7))})
//│ def c'6'12_c'6'5_c'6'5_c'6'5_c'6'5:12 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:13 (primitive:3 x:7))})
//│ def c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:14 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:15 (primitive:3 x:7))})
//│ def c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:13 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:14 (primitive:3 x:7))})
//│ def c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:15 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:16 (primitive:3 x:7))})
//│ def c'6'12:8 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5:9 (primitive:3 x:7))})
//│ def c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:16 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:17 (primitive:3 x:7))})
//│ (c'6'12:8 0)
//│ <<<<<<<<<< Rewritten <<<<<<<<<<
//│ >>>>>>>>>> Simplify >>>>>>>>>>
//│ def c'6'12_c'6'5_c'6'5_c'6'5:11 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5_c'6'5:12 (primitive:3 x:7))})
//│ def c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:13 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:14 (primitive:3 x:7))})
//│ def c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:18 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:19 (primitive:3 x:7))})
//│ def c'6'12:8 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5:9 (primitive:3 x:7))})
//│ def c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:16 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:17 (primitive:3 x:7))})
//│ def c'6'12_c'6'5:9 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5:10 (primitive:3 x:7))})
//│ def c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:19 = "RECURSE_TOO_LONG"
//│ def c'6'12_c'6'5_c'6'5_c'6'5_c'6'5:12 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:13 (primitive:3 x:7))})
//│ def c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:14 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:15 (primitive:3 x:7))})
//│ def c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:15 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:16 (primitive:3 x:7))})
//│ def c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:17 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5_c'6'5:18 (primitive:3 x:7))})
//│ def c'6'12_c'6'5_c'6'5:10 = (fun x:7 -> case (primitive:3 x:7) of {True -> 0 | False -> (c'6'12_c'6'5_c'6'5_c'6'5:11 (primitive:3 x:7))})
//│ (c'6'12:8 0)
//│ <<<<<<<<<< Simplify <<<<<<<<<<


// NOTE: only the first two element is handled
_LUMBERHACK_ERROR
fun map(f, ls) = if ls is
    C(h, t) then C(f(h), map(f, t))
    N then N
fun ff(x) = if x is
    K then T
    KK then TT
    KKKK then TTTT
let l = C(K, C(KK, C(KKKK, N)))
map(ff, l)
//│ |_LUMBERHACK_ERROR|↵|#fun| |map|(|f|,| |ls|)| |#=| |#if| |ls| |is|→|C|(|h|,| |t|)| |#then| |C|(|f|(|h|)|,| |map|(|f|,| |t|)|)|↵|N| |#then| |N|←|↵|#fun| |ff|(|x|)| |#=| |#if| |x| |is|→|K| |#then| |T|↵|KK| |#then| |TT|↵|KKKK| |#then| |TTTT|←|↵|#let| |l| |#=| |C|(|K|,| |C|(|KK|,| |C|(|KKKK|,| |N|)|)|)|↵|map|(|ff|,| |l|)|
//│ Parsed: {_LUMBERHACK_ERROR; fun map = f, ls, => if ls is ‹(C (h, t,)) then C (f (h,), map (f, t,),); (N) then N›; fun ff = x, => if x is ‹(K) then T; (KK) then TT; (KKKK) then TTTT›; let l = C (K, C (KK, C (KKKK, N,),),); map (ff, l,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def map:6 = 14: (fun f:9 -> 13: (fun ls:10 -> 12: case 1: ls:10 of {C h:11 t:12 -> 10: [C 4: (2: f:9 3: h:11) 9: (7: (5: map:6 6: f:9) 8: t:12)] | N -> 11: [N]}))
//│ def ff:7 = 20: (fun x:13 -> 19: case 15: x:13 of {K -> 16: [T] | KK -> 17: [TT] | KKKK -> 18: [TTTT]})
//│ def l:8 = 27: [C 21: [K] 26: [C 22: [KK] 25: [C 23: [KKKK] 24: [N]]]]
//│ 32: (30: (28: map:6 29: ff:7) 31: l:8)
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ (ɛ, 11'x) => ((ɛ, 12'19_matchres)) <: 3'f
//│ 	[ff:7^29 ⋅ ɛ] <: [map:6^28 ⋅ map:6^5 ⋅ map:6^5 ⋅ ɛ]
//│ 	[ff:7^29 ⋅ ɛ] <: [map:6^28 ⋅ map:6^5 ⋅ ɛ]
//│ ------- defInstance -------
//│ map:6^28 ⋅ l:8^31 ⋅ ɛ ==> map:6^28 ⋅ map:6^5 ⋅ ff:7^29 ⋅ ɛ:
//│ 	22: [KK]  <-->  19: case x:13 of {K -> [T] | KK -> [TT] | KKKK -> [TTTT]}
//│ 	23: [KKKK]  <-->  19: case x:13 of {K -> [T] | KK -> [TT] | KKKK -> [TTTT]}
//│ l:8^31 ⋅ ɛ ==> map:6^28 ⋅ ɛ:
//│ 	27: [C [K] [C [KK] [C [KKKK] [N]]]]  <-->  12: case ls:10 of {C h:11 t:12 -> [C (f:9 h:11) ((map:6 f:9) t:12)] | N -> [N]}
//│ l:8^31 ⋅ ɛ ==> map:6^28 ⋅ map:6^5 ⋅ map:6^5 ⋅ ɛ:
//│ 	25: [C [KKKK] [N]]  <-->  12: case ls:10 of {C h:11 t:12 -> [C (f:9 h:11) ((map:6 f:9) t:12)] | N -> [N]}
//│ l:8^31 ⋅ ɛ ==> ff:7^29 ⋅ ɛ:
//│ 	21: [K]  <-->  19: case x:13 of {K -> [T] | KK -> [TT] | KKKK -> [TTTT]}
//│ 	22: [KK]  <-->  19: case x:13 of {K -> [T] | KK -> [TT] | KKKK -> [TTTT]}
//│ map:6^28 ⋅ l:8^31 ⋅ ɛ ==> map:6^28 ⋅ map:6^5 ⋅ map:6^5 ⋅ ff:7^29 ⋅ ɛ:
//│ 	23: [KKKK]  <-->  19: case x:13 of {K -> [T] | KK -> [TT] | KKKK -> [TTTT]}
//│ l:8^31 ⋅ ɛ ==> map:6^28 ⋅ map:6^5 ⋅ map:6^5 ⋅ map:6^5 ⋅ ɛ:
//│ 	24: [N]  <-->  12: case ls:10 of {C h:11 t:12 -> [C (f:9 h:11) ((map:6 f:9) t:12)] | N -> [N]}
//│ map:6^28 ⋅ map:6^5 ⋅ l:8^31 ⋅ ɛ ==> map:6^28 ⋅ ff:7^29 ⋅ ɛ:
//│ 	21: [K]  <-->  19: case x:13 of {K -> [T] | KK -> [TT] | KKKK -> [TTTT]}
//│ l:8^31 ⋅ ɛ ==> map:6^28 ⋅ map:6^5 ⋅ ɛ:
//│ 	26: [C [KK] [C [KKKK] [N]]]  <-->  12: case ls:10 of {C h:11 t:12 -> [C (f:9 h:11) ((map:6 f:9) t:12)] | N -> [N]}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ def map:6 = (fun f:9 -> (fun ls:10 -> case ls:10 of {C h:11 t:12 -> [C (f:9 h:11) ((map:6 f:9) t:12)] | N -> [N]}))
//│ def ff:7 = (fun x:13 -> case x:13 of {K -> [T] | KK -> [TT] | KKKK -> [TTTT]})
//│ def l:8 = [C [K] [C [KK] [C [KKKK] [N]]]]
//│ def map'6'28:14 = (fun f:9 -> (fun ls:10 -> ls:10))
//│ def map'6'28_map'6'5:17 = (fun f:9 -> (fun ls:10 -> ls:10))
//│ def map'6'28_map'6'5_map'6'5_map'6'5:18 = (fun f:9 -> (fun ls:10 -> ls:10))
//│ def ff'7'29:15 = (fun x:13 -> x:13)
//│ def l'8'31:16 = 
//│ 	let h:11 = [T] in 
//│ 	let t:12 = 
//│ 		let h:11 = [TT] in 
//│ 		let t:12 = 
//│ 			let h:11 = [KKKK] in 
//│ 			let t:12 = [N] in [C (f:9 h:11) ((map'6'28_map'6'5_map'6'5_map'6'5:18 f:9) t:12)] 
//│ 		in [C (f:9 h:11) ((map'6'28_map'6'5:17 f:9) t:12)] 
//│ 	in [C (f:9 h:11) ((map'6'28_map'6'5:17 f:9) t:12)]
//│ ((map'6'28:14 ff'7'29:15) l'8'31:16)
//│ <<<<<<<<<< Rewritten <<<<<<<<<<
//│ >>>>>>>>>> Simplify >>>>>>>>>>
//│ def l'8'31:16 = 
//│ 	let h:11 = [T] in 
//│ 	let t:12 = 
//│ 		let h:11 = [TT] in 
//│ 		let t:12 = 
//│ 			let h:11 = [KKKK] in 
//│ 			let t:12 = [N] in [C (f:9 h:11) ((map'6'28_map'6'5_map'6'5_map'6'5:18 f:9) t:12)] 
//│ 		in [C (f:9 h:11) ((map'6'28_map'6'5:17 f:9) t:12)] 
//│ 	in [C (f:9 h:11) ((map'6'28_map'6'5:17 f:9) t:12)]
//│ def map'6'28_map'6'5:17 = (fun f:9 -> (fun ls:10 -> ls:10))
//│ def ff'7'29:15 = (fun x:13 -> x:13)
//│ def map'6'28:14 = (fun f:9 -> (fun ls:10 -> ls:10))
//│ def map'6'28_map'6'5_map'6'5_map'6'5:18 = (fun f:9 -> (fun ls:10 -> ls:10))
//│ ((map'6'28:14 ff'7'29:15) l'8'31:16)
//│ <<<<<<<<<< Simplify <<<<<<<<<<


// NOTE: some program not be able to write?
_LUMBERHACK_ERROR
fun last(ls) = if ls is
    C(h, t) then if t is
        N then Some(h)
        C(hh, tt) then last(t)
        // C(hh, tt) then last(C(hh, tt))
    N then None
let p = C(1, C(2, N))
last(p)
//│ |_LUMBERHACK_ERROR|↵|#fun| |last|(|ls|)| |#=| |#if| |ls| |is|→|C|(|h|,| |t|)| |#then| |#if| |t| |is|→|N| |#then| |Some|(|h|)|↵|C|(|hh|,| |tt|)| |#then| |last|(|t|)|↵|/* C(hh, tt) then last(C(hh, tt))*/|←|↵|N| |#then| |None|←|↵|#let| |p| |#=| |C|(|1|,| |C|(|2|,| |N|)|)|↵|last|(|p|)|
//│ Parsed: {_LUMBERHACK_ERROR; fun last = ls, => if ls is ‹(C (h, t,)) then if t is ‹(N) then Some (h,); (C (hh, tt,)) then last (t,)›; (N) then None›; let p = C (1, C (2, N,),); last (p,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def last:6 = 11: (fun ls:8 -> 10: case 1: ls:8 of {C h:9 t:10 -> 8: case 2: t:10 of {N -> 4: [Some 3: h:9] | C hh:11 tt:12 -> 7: (5: last:6 6: t:10)} | N -> 9: [None]})
//│ def p:7 = 16: [C 12: 1 15: [C 13: 2 14: [N]]]
//│ 19: (17: last:6 18: p:7)
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ Some((ɛ, 3'h)) <: 7'7_callres
//│ 	[last:6^5 ⋅ last:6^5 ⋅ ɛ] <: [ɛ]
//│ 	[last:6^5 ⋅ ɛ] <: [ɛ]
//│ None <: 7'7_callres
//│ 	[last:6^5 ⋅ last:6^5 ⋅ ɛ] <: [ɛ]
//│ 	[last:6^5 ⋅ ɛ] <: [ɛ]
//│ ------- defInstance -------
//│ p:7^18 ⋅ ɛ ==> last:6^17 ⋅ last:6^5 ⋅ last:6^5 ⋅ ɛ:
//│ 	14: [N]  <-->  10: case ls:8 of {C h:9 t:10 -> case t:10 of {N -> [Some h:9] | C hh:11 tt:12 -> (last:6 t:10)} | N -> [None]}
//│ p:7^18 ⋅ ɛ ==> last:6^17 ⋅ last:6^5 ⋅ ɛ:
//│ 	14: [N]  <-->  8: case t:10 of {N -> [Some h:9] | C hh:11 tt:12 -> (last:6 t:10)}
//│ 	15: [C 2 [N]]  <-->  10: case ls:8 of {C h:9 t:10 -> case t:10 of {N -> [Some h:9] | C hh:11 tt:12 -> (last:6 t:10)} | N -> [None]}
//│ p:7^18 ⋅ ɛ ==> last:6^17 ⋅ ɛ:
//│ 	15: [C 2 [N]]  <-->  8: case t:10 of {N -> [Some h:9] | C hh:11 tt:12 -> (last:6 t:10)}
//│ 	16: [C 1 [C 2 [N]]]  <-->  10: case ls:8 of {C h:9 t:10 -> case t:10 of {N -> [Some h:9] | C hh:11 tt:12 -> (last:6 t:10)} | N -> [None]}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ !!!!!!ERROR!!!!!!
//│ java.lang.Exception: Internal Error: 
//│ p:7^18 ⋅ ɛ to `[N]` 
//│ 	already has last:6^17 ⋅ last:6^5 ⋅ last:6^5 ⋅ ɛ to `case ls:8 of {C h:9 t:10 -> case t:10 of {N -> [Some h:9] | C hh:11 tt:12 -> (last:6 t:10)} | N -> [None]}` 
//│ 	but here comes another match last:6^17 ⋅ last:6^5 ⋅ ɛ to `case t:10 of {N -> [Some h:9] | C hh:11 tt:12 -> (last:6 t:10)}`
//│ !!!!!!ERROR!!!!!!

_LUMBERHACK_ERROR
let add = primitive
fun idxSum(ls) = if ls is
    N then acc => 0
    C(h, t) then acc => add(acc, idxSum(t)(add(acc, 1)))
fun rev(lss, a) = if lss is
    N then a
    C(hh, tt) then rev(tt, C(hh, a))
idxSum(rev(primitive, N))(0)
//│ |_LUMBERHACK_ERROR|↵|#let| |add| |#=| |primitive|↵|#fun| |idxSum|(|ls|)| |#=| |#if| |ls| |is|→|N| |#then| |acc| |=>| |0|↵|C|(|h|,| |t|)| |#then| |acc| |=>| |add|(|acc|,| |idxSum|(|t|)|(|add|(|acc|,| |1|)|)|)|←|↵|#fun| |rev|(|lss|,| |a|)| |#=| |#if| |lss| |is|→|N| |#then| |a|↵|C|(|hh|,| |tt|)| |#then| |rev|(|tt|,| |C|(|hh|,| |a|)|)|←|↵|idxSum|(|rev|(|primitive|,| |N|)|)|(|0|)|
//│ Parsed: {_LUMBERHACK_ERROR; let add = primitive; fun idxSum = ls, => if ls is ‹(N) then acc, => 0; (C (h, t,)) then acc, => add (acc, idxSum (t,) (add (acc, 1,),),)›; fun rev = lss, a, => if lss is ‹(N) then a; (C (hh, tt,)) then rev (tt, C (hh, a,),)›; idxSum (rev (primitive, N,),) (0,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def add:4 = 1: primitive:3
//│ def idxSum:7 = 20: (fun ls:9 -> 19: case 2: ls:9 of {N -> 4: (fun acc:10 -> 3: 0) | C h:11 t:12 -> 18: (fun acc:13 -> 17: (7: (5: add:4 6: acc:13) 16: (10: (8: idxSum:7 9: t:12) 15: (13: (11: add:4 12: acc:13) 14: 1))))})
//│ def rev:8 = 32: (fun lss:14 -> 31: (fun a:15 -> 30: case 21: lss:14 of {N -> 22: a:15 | C hh:16 tt:17 -> 29: (25: (23: rev:8 24: tt:17) 28: [C 26: hh:16 27: a:15])}))
//│ 41: (39: (33: idxSum:7 38: (36: (34: rev:8 35: primitive:3) 37: [N])) 40: 0)
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ N <: 20'29_callres
//│ 	[rev:8^23 ⋅ rev:8^23 ⋅ ɛ] <: [rev:8^34 ⋅ ɛ]
//│ 	[rev:8^23 ⋅ ɛ] <: [rev:8^34 ⋅ ɛ]
//│ C((ɛ, 17'hh), (ɛ, 16'a)) <: 20'29_callres
//│ 	[rev:8^23 ⋅ ɛ] <: [ɛ]
//│ 	[ɛ] <: [ɛ]
//│ C((ɛ, 17'hh), (ɛ, 16'a)) <: 3'ls
//│ 	[rev:8^34 ⋅ ɛ] <: [rev:8^23 ⋅ rev:8^23 ⋅ idxSum:7^33 ⋅ idxSum:7^8 ⋅ idxSum:7^8 ⋅ ɛ]
//│ 	[rev:8^34 ⋅ ɛ] <: [rev:8^23 ⋅ rev:8^23 ⋅ idxSum:7^33 ⋅ idxSum:7^8 ⋅ ɛ]
//│ ------- defInstance -------
//│ ɛ ==> rev:8^23 ⋅ idxSum:7^33 ⋅ idxSum:7^8 ⋅ ɛ:
//│ 	37: [N]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ rev:8^34 ⋅ ɛ ==> rev:8^23 ⋅ rev:8^23 ⋅ idxSum:7^33 ⋅ idxSum:7^8 ⋅ ɛ:
//│ 	28: [C hh:16 a:15]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ rev:8^34 ⋅ ɛ ==> rev:8^23 ⋅ idxSum:7^33 ⋅ idxSum:7^8 ⋅ ɛ:
//│ 	28: [C hh:16 a:15]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ rev:8^34 ⋅ ɛ ==> idxSum:7^33 ⋅ ɛ:
//│ 	28: [C hh:16 a:15]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ rev:8^23 ⋅ ɛ ==> idxSum:7^33 ⋅ ɛ:
//│ 	37: [N]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ ɛ ==> idxSum:7^33 ⋅ ɛ:
//│ 	37: [N]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ rev:8^34 ⋅ ɛ ==> rev:8^23 ⋅ idxSum:7^33 ⋅ ɛ:
//│ 	28: [C hh:16 a:15]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ ɛ ==> idxSum:7^33 ⋅ idxSum:7^8 ⋅ ɛ:
//│ 	37: [N]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ ɛ ==> rev:8^23 ⋅ idxSum:7^33 ⋅ idxSum:7^8 ⋅ idxSum:7^8 ⋅ ɛ:
//│ 	37: [N]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ ɛ ==> rev:8^23 ⋅ rev:8^23 ⋅ idxSum:7^33 ⋅ idxSum:7^8 ⋅ idxSum:7^8 ⋅ ɛ:
//│ 	37: [N]  <-->  19: case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ def add:4 = primitive:3
//│ def idxSum:7 = (fun ls:9 -> case ls:9 of {N -> (fun acc:10 -> 0) | C h:11 t:12 -> (fun acc:13 -> ((add:4 acc:13) ((idxSum:7 t:12) ((add:4 acc:13) 1))))})
//│ def rev:8 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev:8 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34:19 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23:20 tt:17) 
//│ 	let h:11 = hh:16 in 
//│ 	let t:12 = a:15 in (fun acc:13 -> ((add:4 acc:13) ((idxSum'7'33_idxSum'7'8:31 t:12) ((add:4 acc:13) 1)))))}))
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23:23 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:24 tt:17) [C hh:16 a:15])}))
//│ def idxSum'7'33:18 = (fun ls:9 -> ls:9)
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:28 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:29 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:29 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:30 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23:22 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23:23 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34_rev'8'23_rev'8'23:21 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23:22 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:25 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:26 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:26 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:27 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:24 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:25 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:30 = "RECURSE_TOO_LONG"
//│ def idxSum'7'33_idxSum'7'8:31 = (fun ls:9 -> ls:9)
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:27 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:28 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34_rev'8'23:20 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23:21 tt:17) [C hh:16 a:15])}))
//│ ((idxSum'7'33:18 ((rev'8'34:19 primitive:3) (fun acc:10 -> 0))) 0)
//│ <<<<<<<<<< Rewritten <<<<<<<<<<
//│ >>>>>>>>>> Simplify >>>>>>>>>>
//│ def rev'8'34_rev'8'23:20 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23:21 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:24 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:25 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:29 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:30 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23:22 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23:23 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34:19 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23:20 tt:17) 
//│ 	let h:11 = hh:16 in 
//│ 	let t:12 = a:15 in (fun acc:13 -> ((add:4 acc:13) (t:12 ((add:4 acc:13) 1)))))}))
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:28 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:29 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23:23 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:24 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:26 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:27 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:25 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:26 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34_rev'8'23_rev'8'23:21 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23:22 tt:17) [C hh:16 a:15])}))
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:27 = (fun lss:14 -> (fun a:15 -> case lss:14 of {N -> a:15 | C hh:16 tt:17 -> ((rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:28 tt:17) [C hh:16 a:15])}))
//│ def idxSum'7'33_idxSum'7'8:31 = (fun ls:9 -> ls:9)
//│ def rev'8'34_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23_rev'8'23:30 = "RECURSE_TOO_LONG"
//│ def idxSum'7'33:18 = (fun ls:9 -> ls:9)
//│ (((rev'8'34:19 primitive:3) (fun acc:10 -> 0)) 0)
//│ <<<<<<<<<< Simplify <<<<<<<<<<


fun minuss(a) = if a is
    S(aa) then b => if b is
        S(bb) then minuss(aa, bb)
        Z then aa
    Z then n => Z
let fst = S(S(Z))
let snd = Z
minuss(fst)(snd)
//│ |#fun| |minuss|(|a|)| |#=| |#if| |a| |is|→|S|(|aa|)| |#then| |b| |=>| |#if| |b| |is|→|S|(|bb|)| |#then| |minuss|(|aa|,| |bb|)|↵|Z| |#then| |aa|←|↵|Z| |#then| |n| |=>| |Z|←|↵|#let| |fst| |#=| |S|(|S|(|Z|)|)|↵|#let| |snd| |#=| |Z|↵|minuss|(|fst|)|(|snd|)|
//│ Parsed: {fun minuss = a, => if a is ‹(S (aa,)) then b, => if b is ‹(S (bb,)) then minuss (aa, bb,); (Z) then aa›; (Z) then n, => Z›; let fst = S (S (Z,),); let snd = Z; minuss (fst,) (snd,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def minuss:6 = 14: (fun a:9 -> 13: case 1: a:9 of {S aa:10 -> 10: (fun b:11 -> 9: case 2: b:11 of {S bb:12 -> 7: (5: (3: minuss:6 4: aa:10) 6: bb:12) | Z -> 8: aa:10}) | Z -> 12: (fun n:13 -> 11: [Z])})
//│ def fst:7 = 17: [S 16: [S 15: [Z]]]
//│ def snd:8 = 18: [Z]
//│ 23: (21: (19: minuss:6 20: fst:7) 22: snd:8)
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ S((ɛ, Z)) <: 8'7_callres
//│ 	[minuss:6^3 ⋅ minuss:6^3 ⋅ fst:7^20 ⋅ ɛ] <: [minuss:6^19 ⋅ ɛ]
//│ 	[minuss:6^3 ⋅ fst:7^20 ⋅ ɛ] <: [minuss:6^19 ⋅ ɛ]
//│ Z <: 8'7_callres
//│ 	[minuss:6^3 ⋅ fst:7^20 ⋅ ɛ] <: [minuss:6^19 ⋅ ɛ]
//│ 	[minuss:6^3 ⋅ ɛ] <: [ɛ]
//│ ------- defInstance -------
//│ fst:7^20 ⋅ ɛ ==> minuss:6^19 ⋅ ɛ:
//│ 	17: [S [S [Z]]]  <-->  13: case a:9 of {S aa:10 -> (fun b:11 -> case b:11 of {S bb:12 -> ((minuss:6 aa:10) bb:12) | Z -> aa:10}) | Z -> (fun n:13 -> [Z])}
//│ fst:7^20 ⋅ ɛ ==> minuss:6^19 ⋅ minuss:6^3 ⋅ minuss:6^3 ⋅ ɛ:
//│ 	15: [Z]  <-->  13: case a:9 of {S aa:10 -> (fun b:11 -> case b:11 of {S bb:12 -> ((minuss:6 aa:10) bb:12) | Z -> aa:10}) | Z -> (fun n:13 -> [Z])}
//│ snd:8^22 ⋅ ɛ ==> minuss:6^19 ⋅ ɛ:
//│ 	18: [Z]  <-->  9: case b:11 of {S bb:12 -> ((minuss:6 aa:10) bb:12) | Z -> aa:10}
//│ fst:7^20 ⋅ ɛ ==> minuss:6^19 ⋅ minuss:6^3 ⋅ ɛ:
//│ 	16: [S [Z]]  <-->  13: case a:9 of {S aa:10 -> (fun b:11 -> case b:11 of {S bb:12 -> ((minuss:6 aa:10) bb:12) | Z -> aa:10}) | Z -> (fun n:13 -> [Z])}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ def minuss:6 = (fun a:9 -> case a:9 of {S aa:10 -> (fun b:11 -> case b:11 of {S bb:12 -> ((minuss:6 aa:10) bb:12) | Z -> aa:10}) | Z -> (fun n:13 -> [Z])})
//│ def fst:7 = [S [S [Z]]]
//│ def snd:8 = [Z]
//│ def minuss'6'19:14 = (fun a:9 -> a:9)
//│ def minuss'6'19_minuss'6'3_minuss'6'3:16 = (fun a:9 -> a:9)
//│ def fst'7'20:15 = 
//│ 	let aa:10 = 
//│ 		let aa:10 = (fun n:13 -> [Z]) in (fun b:11 -> case b:11 of {S bb:12 -> ((minuss'6'19_minuss'6'3_minuss'6'3:16 aa:10) bb:12) | Z -> aa:10}) 
//│ 	in (fun b:11 -> b:11)
//│ def snd'8'22:17 = aa:10
//│ ((minuss'6'19:14 fst'7'20:15) snd'8'22:17)
//│ <<<<<<<<<< Rewritten <<<<<<<<<<
//│ >>>>>>>>>> Simplify >>>>>>>>>>
//│ def minuss'6'19:14 = (fun a:9 -> a:9)
//│ def minuss'6'19_minuss'6'3_minuss'6'3:16 = (fun a:9 -> a:9)
//│ def fst'7'20:15 = 
//│ 	let aa:10 = 
//│ 		let aa:10 = (fun n:13 -> [Z]) in (fun b:11 -> case b:11 of {S bb:12 -> (aa:10 bb:12) | Z -> aa:10}) 
//│ 	in (fun b:11 -> b:11)
//│ def snd'8'22:17 = aa:10
//│ (fst'7'20:15 snd'8'22:17)
//│ <<<<<<<<<< Simplify <<<<<<<<<<

// FIXME: weird recursive
fun minuss(a) = if a is
    S(aa) then b => checkb(b)(aa)
    Z then n => Z
fun checkb(b) = if b is
    S(bb) then aaa => minuss(aaa, bb)
    Z then aaa => aaa
let fst = S(S(Z))
let snd = Z
minuss(fst)(snd)
//│ |#fun| |minuss|(|a|)| |#=| |#if| |a| |is|→|S|(|aa|)| |#then| |b| |=>| |checkb|(|b|)|(|aa|)|↵|Z| |#then| |n| |=>| |Z|←|↵|#fun| |checkb|(|b|)| |#=| |#if| |b| |is|→|S|(|bb|)| |#then| |aaa| |=>| |minuss|(|aaa|,| |bb|)|↵|Z| |#then| |aaa| |=>| |aaa|←|↵|#let| |fst| |#=| |S|(|S|(|Z|)|)|↵|#let| |snd| |#=| |Z|↵|minuss|(|fst|)|(|snd|)|
//│ Parsed: {fun minuss = a, => if a is ‹(S (aa,)) then b, => checkb (b,) (aa,); (Z) then n, => Z›; fun checkb = b, => if b is ‹(S (bb,)) then aaa, => minuss (aaa, bb,); (Z) then aaa, => aaa›; let fst = S (S (Z,),); let snd = Z; minuss (fst,) (snd,)}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ def minuss:6 = 11: (fun a:10 -> 10: case 1: a:10 of {S aa:11 -> 7: (fun b:12 -> 6: (4: (2: checkb:7 3: b:12) 5: aa:11)) | Z -> 9: (fun n:13 -> 8: [Z])})
//│ def checkb:7 = 22: (fun b:14 -> 21: case 12: b:14 of {S bb:15 -> 18: (fun aaa:16 -> 17: (15: (13: minuss:6 14: aaa:16) 16: bb:15)) | Z -> 20: (fun aaa:17 -> 19: aaa:17)})
//│ def fst:8 = 25: [S 24: [S 23: [Z]]]
//│ def snd:9 = 26: [Z]
//│ 31: (29: (27: minuss:6 28: fst:8) 30: snd:9)
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ ------- recursive -------
//│ S((ɛ, Z)) <: 8'6_callres
//│ 	[checkb:7^2 ⋅ minuss:6^13 ⋅ fst:8^28 ⋅ ɛ] <: [minuss:6^27 ⋅ ɛ]
//│ 	[fst:8^28 ⋅ ɛ] <: [minuss:6^27 ⋅ ɛ]
//│ Z <: 8'6_callres
//│ 	[checkb:7^2 ⋅ minuss:6^13 ⋅ checkb:7^2 ⋅ minuss:6^13 ⋅ ɛ] <: [ɛ]
//│ 	[fst:8^28 ⋅ ɛ] <: [minuss:6^27 ⋅ checkb:7^2 ⋅ minuss:6^13 ⋅ ɛ]
//│ ------- defInstance -------
//│ fst:8^28 ⋅ ɛ ==> minuss:6^27 ⋅ checkb:7^2 ⋅ minuss:6^13 ⋅ ɛ:
//│ 	24: [S [Z]]  <-->  10: case a:10 of {S aa:11 -> (fun b:12 -> ((checkb:7 b:12) aa:11)) | Z -> (fun n:13 -> [Z])}
//│ snd:9^30 ⋅ ɛ ==> minuss:6^27 ⋅ checkb:7^2 ⋅ ɛ:
//│ 	26: [Z]  <-->  21: case b:14 of {S bb:15 -> (fun aaa:16 -> ((minuss:6 aaa:16) bb:15)) | Z -> (fun aaa:17 -> aaa:17)}
//│ fst:8^28 ⋅ ɛ ==> minuss:6^27 ⋅ checkb:7^2 ⋅ minuss:6^13 ⋅ checkb:7^2 ⋅ minuss:6^13 ⋅ ɛ:
//│ 	23: [Z]  <-->  10: case a:10 of {S aa:11 -> (fun b:12 -> ((checkb:7 b:12) aa:11)) | Z -> (fun n:13 -> [Z])}
//│ fst:8^28 ⋅ ɛ ==> minuss:6^27 ⋅ ɛ:
//│ 	25: [S [S [Z]]]  <-->  10: case a:10 of {S aa:11 -> (fun b:12 -> ((checkb:7 b:12) aa:11)) | Z -> (fun n:13 -> [Z])}
//│ 
//│ >>>>>>>>>> Rewritten >>>>>>>>>>
//│ def minuss:6 = (fun a:10 -> case a:10 of {S aa:11 -> (fun b:12 -> ((checkb:7 b:12) aa:11)) | Z -> (fun n:13 -> [Z])})
//│ def checkb:7 = (fun b:14 -> case b:14 of {S bb:15 -> (fun aaa:16 -> ((minuss:6 aaa:16) bb:15)) | Z -> (fun aaa:17 -> aaa:17)})
//│ def fst:8 = [S [S [Z]]]
//│ def snd:9 = [Z]
//│ def minuss'6'27_checkb'7'2_minuss'6'13_checkb'7'2:21 = (fun b:14 -> case b:14 of {S bb:15 -> (fun aaa:16 -> ((minuss'6'27_checkb'7'2_minuss'6'13_checkb'7'2_minuss'6'13:22 aaa:16) bb:15)) | Z -> (fun aaa:17 -> aaa:17)})
//│ def fst'8'28:19 = 
//│ 	let aa:11 = 
//│ 		let aa:11 = (fun n:13 -> [Z]) in (fun b:12 -> ((minuss'6'27_checkb'7'2_minuss'6'13_checkb'7'2:21 b:12) aa:11)) 
//│ 	in (fun b:12 -> ((minuss'6'27_checkb'7'2:20 b:12) aa:11))
//│ def minuss'6'27_checkb'7'2_minuss'6'13:18 = (fun a:10 -> a:10)
//│ def minuss'6'27_checkb'7'2_minuss'6'13_checkb'7'2_minuss'6'13:22 = (fun a:10 -> a:10)
//│ def snd'9'30:23 = (fun aaa:17 -> aaa:17)
//│ def minuss'6'27_checkb'7'2:20 = (fun b:14 -> b:14)
//│ ((minuss'6'27_checkb'7'2_minuss'6'13:18 fst'8'28:19) snd'9'30:23)
//│ <<<<<<<<<< Rewritten <<<<<<<<<<
//│ >>>>>>>>>> Simplify >>>>>>>>>>
//│ def minuss'6'27_checkb'7'2:20 = (fun b:14 -> b:14)
//│ def snd'9'30:23 = (fun aaa:17 -> aaa:17)
//│ def minuss'6'27_checkb'7'2_minuss'6'13_checkb'7'2:21 = (fun b:14 -> case b:14 of {S bb:15 -> (fun aaa:16 -> (aaa:16 bb:15)) | Z -> (fun aaa:17 -> aaa:17)})
//│ def minuss'6'27_checkb'7'2_minuss'6'13:18 = (fun a:10 -> a:10)
//│ def minuss'6'27_checkb'7'2_minuss'6'13_checkb'7'2_minuss'6'13:22 = (fun a:10 -> a:10)
//│ def fst'8'28:19 = 
//│ 	let aa:11 = 
//│ 		let aa:11 = (fun n:13 -> [Z]) in (fun b:12 -> ((minuss'6'27_checkb'7'2_minuss'6'13_checkb'7'2:21 b:12) aa:11)) 
//│ 	in (fun b:12 -> (b:12 aa:11))
//│ (fst'8'28:19 snd'9'30:23)
//│ <<<<<<<<<< Simplify <<<<<<<<<<
