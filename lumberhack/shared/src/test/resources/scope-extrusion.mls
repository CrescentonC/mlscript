:NewParser
:ParseOnly

_LUMBERHACK_EVAL
if C(A, B(D)) is
  C(a, bd) then if bd is
    B(d) then if a is
      A then OK
//│ |_LUMBERHACK_EVAL|↵|#if| |C|(|A|,| |B|(|D|)|)| |is|→|C|(|a|,| |bd|)| |#then| |#if| |bd| |is|→|B|(|d|)| |#then| |#if| |a| |is|→|A| |#then| |OK|←|←|←|
//│ Parsed: {_LUMBERHACK_EVAL; if C (A, B (D,),) is ‹(C (a, bd,)) then if bd is ‹(B (d,)) then if a is ‹(A) then OK›››}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ case [C [A] [B [D]]] of {
//│ 	C a⁰ bd⁰ => case bd⁰ of {
//│ 		B d⁰ => case a⁰ of {
//│ 			A  => [OK]}}}
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ >>>>>>>>>> Original Eval Res >>>>>>>>>>
//│ [OK]
//│ <<<<<<<<<< Original Eval Res <<<<<<<<<<
//│ 
//│ >>>>>>> expansion >>>>>>>
//│ 
//│ <<<<<<< expansion <<<<<<<
//│ 
//│ >>>>>>> expanded program >>>>>>>
//│ case [C [A] [B [D]]] of {
//│ 	C a¹ bd¹ => case bd¹ of {
//│ 		B d¹ => case a¹ of {
//│ 			A  => [OK]}}}
//│ 
//│ <<<<<<< expanded program <<<<<<<
//│ 
//│ >>>>>>> fusion matches >>>>>>>
//│ [A]: 11 --->
//│ 	case a¹ of {A  => [OK]}: 18
//│ [B [D]]: 13 --->
//│ 	case bd¹ of {B d¹ => case a¹ of {A  => [OK]}}: 19
//│ [C [A] [B [D]]]: 14 --->
//│ 	case [C [A] [B [D]]] of {C a¹ bd¹ => case bd¹ of {B d¹ => case a¹ of {A  => [OK]}}}: 20
//│ ------------------
//│ case a¹ of {A  => [OK]}: 18 --->
//│ 	[A]: 11
//│ case bd¹ of {B d¹ => case a¹ of {A  => [OK]}}: 19 --->
//│ 	[B [D]]: 13
//│ case [C [A] [B [D]]] of {C a¹ bd¹ => case bd¹ of {B d¹ => case a¹ of {A  => [OK]}}}: 20 --->
//│ 	[C [A] [B [D]]]: 14
//│ <<<<<<< fusion matches <<<<<<<
//│ 
//│ >>>>>>> new fusion strategy >>>>>>>
//│ [A]: 11 --->
//│ 	case a¹ of {A  => [OK]}: 18
//│ [B [D]]: 13 --->
//│ 	case bd¹ of {B d¹ => case a¹ of {A  => [OK]}}: 19
//│ [C [A] [B [D]]]: 14 --->
//│ 	case [C [A] [B [D]]] of {C a¹ bd¹ => case bd¹ of {B d¹ => case a¹ of {A  => [OK]}}}: 20
//│ ------------------
//│ case a¹ of {A  => [OK]}: 18 --->
//│ 	[A]: 11
//│ case bd¹ of {B d¹ => case a¹ of {A  => [OK]}}: 19 --->
//│ 	[B [D]]: 13
//│ case [C [A] [B [D]]] of {C a¹ bd¹ => case bd¹ of {B d¹ => case a¹ of {A  => [OK]}}}: 20 --->
//│ 	[C [A] [B [D]]]: 14
//│ <<<<<<< new fusion strategy <<<<<<<
//│ 
//│ >>>>>>> after fusion >>>>>>>
//│ 
//│ 	let a² = [OK]
//│ 	in let bd² = 	
//│ 		let d² = [D]
//│ 		in (fun a³ -> a³)
//│ 	in bd²(a²)
//│ 
//│ <<<<<<< after fusion <<<<<<<
//│ 
//│ >>>>>>> evaluate >>>>>>>
//│ [OK]
//│ <<<<<<< evaluate <<<<<<<


if C(A, B(D)) is
  C(a, bd) then if bd is
    B(d) then (a => if a is
      A then OK
    )(a)
//│ |#if| |C|(|A|,| |B|(|D|)|)| |is|→|C|(|a|,| |bd|)| |#then| |#if| |bd| |is|→|B|(|d|)| |#then| |(|a| |=>| |#if| |a| |is|→|A| |#then| |OK|←|↵|)|(|a|)|←|←|
//│ Parsed: {if C (A, B (D,),) is ‹(C (a, bd,)) then if bd is ‹(B (d,)) then '(' a, => if a is ‹(A) then OK›, ')' (a,)››}
//│ >>>>>>>>>> Original >>>>>>>>>>
//│ case [C [A] [B [D]]] of {
//│ 	C a⁰ bd⁰ => case bd⁰ of {
//│ 		B d⁰ => (fun a¹ -> case a¹ of {
//│ 			A  => [OK]})(a⁰)}}
//│ <<<<<<<<<< Original <<<<<<<<<<
//│ 
//│ >>>>>>> expansion >>>>>>>
//│ 
//│ <<<<<<< expansion <<<<<<<
//│ 
//│ >>>>>>> expanded program >>>>>>>
//│ case [C [A] [B [D]]] of {
//│ 	C a² bd¹ => case bd¹ of {
//│ 		B d¹ => (fun a³ -> case a³ of {
//│ 			A  => [OK]})(a²)}}
//│ 
//│ <<<<<<< expanded program <<<<<<<
//│ 
//│ >>>>>>> fusion matches >>>>>>>
//│ [A]: 14 --->
//│ 	case a³ of {A  => [OK]}: 21
//│ [B [D]]: 16 --->
//│ 	case bd¹ of {B d¹ => (fun a³ -> case a³ of {A  => [OK]})(a²)}: 25
//│ [C [A] [B [D]]]: 17 --->
//│ 	case [C [A] [B [D]]] of {C a² bd¹ => case bd¹ of {B d¹ => (fun a³ -> case a³ of {A  => [OK]})(a²)}}: 26
//│ ------------------
//│ case a³ of {A  => [OK]}: 21 --->
//│ 	[A]: 14
//│ case bd¹ of {B d¹ => (fun a³ -> case a³ of {A  => [OK]})(a²)}: 25 --->
//│ 	[B [D]]: 16
//│ case [C [A] [B [D]]] of {C a² bd¹ => case bd¹ of {B d¹ => (fun a³ -> case a³ of {A  => [OK]})(a²)}}: 26 --->
//│ 	[C [A] [B [D]]]: 17
//│ <<<<<<< fusion matches <<<<<<<
//│ 
//│ >>>>>>> new fusion strategy >>>>>>>
//│ [A]: 14 --->
//│ 	case a³ of {A  => [OK]}: 21
//│ [B [D]]: 16 --->
//│ 	case bd¹ of {B d¹ => (fun a³ -> case a³ of {A  => [OK]})(a²)}: 25
//│ [C [A] [B [D]]]: 17 --->
//│ 	case [C [A] [B [D]]] of {C a² bd¹ => case bd¹ of {B d¹ => (fun a³ -> case a³ of {A  => [OK]})(a²)}}: 26
//│ ------------------
//│ case a³ of {A  => [OK]}: 21 --->
//│ 	[A]: 14
//│ case bd¹ of {B d¹ => (fun a³ -> case a³ of {A  => [OK]})(a²)}: 25 --->
//│ 	[B [D]]: 16
//│ case [C [A] [B [D]]] of {C a² bd¹ => case bd¹ of {B d¹ => (fun a³ -> case a³ of {A  => [OK]})(a²)}}: 26 --->
//│ 	[C [A] [B [D]]]: 17
//│ <<<<<<< new fusion strategy <<<<<<<
//│ 
//│ >>>>>>> after fusion >>>>>>>
//│ 
//│ 	let a⁴ = [OK]
//│ 	in let bd² = 	
//│ 		let d² = [D]
//│ 		in (fun a⁵ -> (fun a⁶ -> a⁶)(a⁵))
//│ 	in bd²(a⁴)
//│ 
//│ <<<<<<< after fusion <<<<<<<
